From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:00:14 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:00:14 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20552 - rob - hydra/jobs
Message-ID: <201002020900.o1290EYS026808@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:00:13 +0000 (Tue, 02 Feb 2010)
New Revision: 20552

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20552&view=rev

Added:
   hydra/jobs/strategoxt-packages.nix

Log:
start of strategoxt-packages channel

Changes:

Added: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	                        (rev 0)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:00:13 UTC (rev 20552)
@@ -0,0 +1,27 @@
+{ nixpkgs
+, aterm
+, sdf2Bundle
+, strategoxtTarball
+, strategoxtUtilsTarball
+, javaFrontTarball
+, dryadTarball
+} :
+
+let
+  baseline = {
+    inherit aterm sdf2Bundle strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
+  };
+  builder = import ../build.nix { pkgsDefault = pkgs ; inherit baseline; } ;
+
+  specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
+  jobs = {
+    inherit aterm sdf2Bundle;
+
+    strategoxt      = { strategoxtTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.strategoxt sysPkgs) ;
+    strategoxtUtils = { strategoxtUtilsTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
+    javaFront       = { javaFrontTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.javaFront sysPkgs) ;
+    dryad           = { dryadTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.dryad sysPkgs) ;
+
+  };
+in jobs
+



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:05:14 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:05:14 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20553 - rob - hydra/jobs
Message-ID: <201002020905.o1295EQk027131@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:05:14 +0000 (Tue, 02 Feb 2010)
New Revision: 20553

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20553&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:


Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:00:13 UTC (rev 20552)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:05:14 UTC (rev 20553)
@@ -11,7 +11,7 @@
   baseline = {
     inherit aterm sdf2Bundle strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };
-  builder = import ../build.nix { pkgsDefault = pkgs ; inherit baseline; } ;
+  builder = import ../build.nix { pkgsDefault = (import nixpkgs) {} ; inherit baseline; } ;
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:05:38 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:05:38 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20554 - rob - hydra/jobs
Message-ID: <201002020905.o1295cSD027192@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:05:38 +0000 (Tue, 02 Feb 2010)
New Revision: 20554

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20554&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
forgot hydraConfig

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:05:14 UTC (rev 20553)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:05:38 UTC (rev 20554)
@@ -1,4 +1,5 @@
 { nixpkgs
+, hydraConfig
 , aterm
 , sdf2Bundle
 , strategoxtTarball



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:06:31 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:06:31 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20555 - rob - hydra/jobs
Message-ID: <201002020906.o1296Vmm027217@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:06:31 +0000 (Tue, 02 Feb 2010)
New Revision: 20555

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20555&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
systemPkgs

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:05:38 UTC (rev 20554)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:06:31 UTC (rev 20555)
@@ -13,6 +13,7 @@
     inherit aterm sdf2Bundle strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };
   builder = import ../build.nix { pkgsDefault = (import nixpkgs) {} ; inherit baseline; } ;
+  systemPkgs = system: (import nixpkgs) {inherit system;};
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:07:23 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:07:23 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20556 - rob - hydra/jobs
Message-ID: <201002020907.o1297NvN027267@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:07:23 +0000 (Tue, 02 Feb 2010)
New Revision: 20556

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20556&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use right tarball name

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:06:31 UTC (rev 20555)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:07:23 UTC (rev 20556)
@@ -19,10 +19,10 @@
   jobs = {
     inherit aterm sdf2Bundle;
 
-    strategoxt      = { strategoxtTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.strategoxt sysPkgs) ;
-    strategoxtUtils = { strategoxtUtilsTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
-    javaFront       = { javaFrontTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.javaFront sysPkgs) ;
-    dryad           = { dryadTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball tarball sysPkgs (specs.dryad sysPkgs) ;
+    strategoxt      = { strategoxtTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
+    strategoxtUtils = { strategoxtUtilsTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
+    javaFront       = { javaFrontTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball javaFrontTarball sysPkgs (specs.javaFront sysPkgs) ;
+    dryad           = { dryadTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball dryadTarball sysPkgs (specs.dryad sysPkgs) ;
 
   };
 in jobs



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:14:54 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:14:54 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20557 - rob - hydra/jobs
Message-ID: <201002020914.o129Es8x027314@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:14:54 +0000 (Tue, 02 Feb 2010)
New Revision: 20557

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20557&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use right tarball name

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:07:23 UTC (rev 20556)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:14:54 UTC (rev 20557)
@@ -1,7 +1,5 @@
 { nixpkgs
 , hydraConfig
-, aterm
-, sdf2Bundle
 , strategoxtTarball
 , strategoxtUtilsTarball
 , javaFrontTarball
@@ -9,15 +7,21 @@
 } :
 
 let
+  pkgsDefault =  (import nixpkgs) {} ;
+  systemPkgs = system: (import nixpkgs) {inherit system;};
+
   baseline = {
-    inherit aterm sdf2Bundle strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
+    atermTarball = pkgsDefault.strategoPackages018.aterm.src ;
+    sdf2BundleTarball = pkgsDefault.strategoPackages018.sdf.src ;
+
+    inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };
-  builder = import ../build.nix { pkgsDefault = (import nixpkgs) {} ; inherit baseline; } ;
-  systemPkgs = system: (import nixpkgs) {inherit system;};
+  builder = import ../build.nix { inherit baseline pkgsDefault; } ;
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {
-    inherit aterm sdf2Bundle;
+    aterm           = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.aterm.src strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
+    sdf2Bundle      = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.sdf.src sysPkgs (specs.strategoxt sysPkgs) ;
 
     strategoxt      = { strategoxtTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
     strategoxtUtils = { strategoxtUtilsTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:20:48 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:20:48 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20558 - rob - hydra/jobs
Message-ID: <201002020920.o129KmS7027382@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:20:48 +0000 (Tue, 02 Feb 2010)
New Revision: 20558

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20558&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use right tarball name

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:14:54 UTC (rev 20557)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:20:48 UTC (rev 20558)
@@ -23,10 +23,10 @@
     aterm           = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.aterm.src strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
     sdf2Bundle      = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.sdf.src sysPkgs (specs.strategoxt sysPkgs) ;
 
-    strategoxt      = { strategoxtTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
-    strategoxtUtils = { strategoxtUtilsTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
-    javaFront       = { javaFrontTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball javaFrontTarball sysPkgs (specs.javaFront sysPkgs) ;
-    dryad           = { dryadTarball, system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball dryadTarball sysPkgs (specs.dryad sysPkgs) ;
+    strategoxt      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
+    strategoxtUtils = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
+    javaFront       = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball javaFrontTarball sysPkgs (specs.javaFront sysPkgs) ;
+    dryad           = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball dryadTarball sysPkgs (specs.dryad sysPkgs) ;
 
   };
 in jobs



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:43:23 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:43:23 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20559 - rob - hydra/jobs
Message-ID: <201002020943.o129hNnC027587@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:43:23 +0000 (Tue, 02 Feb 2010)
New Revision: 20559

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20559&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:


Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:20:48 UTC (rev 20558)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:43:23 UTC (rev 20559)
@@ -1,27 +1,27 @@
-{ nixpkgs
-, hydraConfig
-, strategoxtTarball
-, strategoxtUtilsTarball
-, javaFrontTarball
-, dryadTarball
+{ nixpkgs ? ../../nixpkgs
+, hydraConfig ? ../../hydraconfig
+, strategoxtTarball ? { outPath = ./strategoxt-0.17.tar.gz;}
+, strategoxtUtilsTarball ? { outPath = ./strategoxt-utils-0.17.tar.gz ;}
+, javaFrontTarball ? { outPath = ./java-front-0.9.tar.gz; }
+, dryadTarball ? { outPath = ./dryad-0.2pre18756.tar.gz; }
 } :
 
 let
-  pkgsDefault =  (import nixpkgs) {} ;
-  systemPkgs = system: (import nixpkgs) {inherit system;};
+  pkgsDefault = import nixpkgs {} ;
+  systemPkgs = system: import nixpkgs {inherit system;};
 
-  baseline = {
+  baseline = pkgs: {
     atermTarball = pkgsDefault.strategoPackages018.aterm.src ;
     sdf2BundleTarball = pkgsDefault.strategoPackages018.sdf.src ;
 
     inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };
-  builder = import ../build.nix { inherit baseline pkgsDefault; } ;
+  builder = import ../build.nix { inherit baseline pkgsDefault nixpkgs; } ;
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {
-    aterm           = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.aterm.src strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
-    sdf2Bundle      = { system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball pkgsDefault.strategoPackages018.sdf.src sysPkgs (specs.strategoxt sysPkgs) ;
+    aterm           = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball (baseline sysPkgs).atermTarball sysPkgs (specs.aterm sysPkgs) ;
+    sdf2Bundle      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball (baseline sysPkgs).sdf2BundleTarball sysPkgs (specs.sdf2Bundle sysPkgs) ;
 
     strategoxt      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
     strategoxtUtils = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:47:10 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:47:10 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20560 - rob - hydra/jobs
Message-ID: <201002020947.o129lAEQ027656@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:47:09 +0000 (Tue, 02 Feb 2010)
New Revision: 20560

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20560&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use aterm and sdf from nixpkgs

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:43:23 UTC (rev 20559)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:47:09 UTC (rev 20560)
@@ -11,8 +11,8 @@
   systemPkgs = system: import nixpkgs {inherit system;};
 
   baseline = pkgs: {
-    atermTarball = pkgsDefault.strategoPackages018.aterm.src ;
-    sdf2BundleTarball = pkgsDefault.strategoPackages018.sdf.src ;
+    atermTarball = pkgs.strategoPackages018.aterm ;
+    sdf2BundleTarball = pkgs.strategoPackages018.sdf ;
 
     inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };
@@ -20,8 +20,8 @@
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {
-    aterm           = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball (baseline sysPkgs).atermTarball sysPkgs (specs.aterm sysPkgs) ;
-    sdf2Bundle      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball (baseline sysPkgs).sdf2BundleTarball sysPkgs (specs.sdf2Bundle sysPkgs) ;
+    aterm           = {system ? "i686-linux"}: (baseline sysPkgs).aterm ;
+    sdf2Bundle      = {system ? "i686-linux"}: (baseline sysPkgs).sdf2Bundle ;
 
     strategoxt      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
     strategoxtUtils = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:49:45 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:49:45 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20561 - rob - hydra/jobs
Message-ID: <201002020949.o129njlF027676@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:49:45 +0000 (Tue, 02 Feb 2010)
New Revision: 20561

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20561&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use aterm and sdf from nixpkgs

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:47:09 UTC (rev 20560)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:49:45 UTC (rev 20561)
@@ -20,8 +20,8 @@
 
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = {
-    aterm           = {system ? "i686-linux"}: (baseline sysPkgs).aterm ;
-    sdf2Bundle      = {system ? "i686-linux"}: (baseline sysPkgs).sdf2Bundle ;
+    aterm           = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in (baseline sysPkgs).aterm ;
+    sdf2Bundle      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in (baseline sysPkgs).sdf2Bundle ;
 
     strategoxt      = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtTarball sysPkgs (specs.strategoxt sysPkgs) ;
     strategoxtUtils = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:50:34 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:50:34 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20562 - rob - hydra/jobs
Message-ID: <201002020950.o129oYZt027730@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:50:34 +0000 (Tue, 02 Feb 2010)
New Revision: 20562

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20562&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
use aterm and sdf from nixpkgs

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 09:49:45 UTC (rev 20561)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 09:50:34 UTC (rev 20562)
@@ -11,8 +11,8 @@
   systemPkgs = system: import nixpkgs {inherit system;};
 
   baseline = pkgs: {
-    atermTarball = pkgs.strategoPackages018.aterm ;
-    sdf2BundleTarball = pkgs.strategoPackages018.sdf ;
+    aterm = pkgs.strategoPackages018.aterm ;
+    sdf2Bundle = pkgs.strategoPackages018.sdf ;
 
     inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
   };



From R.B.Vermaas at tudelft.nl  Tue Feb  2 10:52:56 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 09:52:56 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20563 - rob -
	hydra/strategoxt
Message-ID: <201002020952.o129quEJ027751@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 09:52:56 +0000 (Tue, 02 Feb 2010)
New Revision: 20563

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20563&view=rev

Modified:
   hydra/strategoxt/packages.nix

Log:
add getopt to strategoxt deps

Changes:

Modified: hydra/strategoxt/packages.nix
===================================================================
--- hydra/strategoxt/packages.nix	2010-02-02 09:50:34 UTC (rev 20562)
+++ hydra/strategoxt/packages.nix	2010-02-02 09:52:56 UTC (rev 20563)
@@ -47,7 +47,7 @@
         trunk = https://svn.strategoxt.org/repos/StrategoXT/strategoxt/trunk;
       };
 
-      buildInputs = [pkgs.pkgconfig];
+      buildInputs = [pkgs.pkgconfig pkgs.getopt];
       requires = [aterm sdf2Bundle];
       rpmBuildSupported = true;
       systemSupported = systemSupport pkgs { cygwin = false; bsd = false; darwin = true; mingw = false; };



From R.B.Vermaas at tudelft.nl  Tue Feb  2 11:11:57 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 10:11:57 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20564 - rob - in hydra:
	. strategoxt
Message-ID: <201002021011.o12ABvQ1028172@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 10:11:57 +0000 (Tue, 02 Feb 2010)
New Revision: 20564

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20564&view=rev

Modified:
   hydra/build.nix
   hydra/strategoxt/packages.nix

Log:
supportSystem check

Changes:

Modified: hydra/build.nix
===================================================================
--- hydra/build.nix	2010-02-02 09:52:56 UTC (rev 20563)
+++ hydra/build.nix	2010-02-02 10:11:57 UTC (rev 20564)
@@ -49,6 +49,8 @@
    * Build spec as a dependency using pkgs (not as a NixBuild).
    */
   easyBuild = pkgs : spec :
+    if (spec pkgs).systemSupported then null
+    else
     let baseline = inputs.baseline pkgs ;
     in 
     if builtins.hasAttr (spec pkgs).attrPrefix inputs then
@@ -66,6 +68,8 @@
    * Build spec using pkgs from a given tarball.
    */
   easyNixBuildFromTarball =  tarball : pkgs : specpkgs : 
+    if !specpkgs.systemSupported then null
+    else
     pkgs.releaseTools.nixBuild (
       (if specpkgs ? customEnv then specpkgs.customEnv else {}) // {
       name = specpkgs.packageName;

Modified: hydra/strategoxt/packages.nix
===================================================================
--- hydra/strategoxt/packages.nix	2010-02-02 09:52:56 UTC (rev 20563)
+++ hydra/strategoxt/packages.nix	2010-02-02 10:11:57 UTC (rev 20564)
@@ -1499,11 +1499,13 @@
          if pkgs.stdenv.system == "i686-linux" then linux
     else if pkgs.stdenv.system == "x86_64-linux" then linux && arch64
     else if pkgs.stdenv.system == "i686-freebsd" then bsd
+    else if pkgs.stdenv.system == "i686-openbsd" then bsd
     else if isMinGW pkgs then mingw
     else if pkgs.stdenv.system == "i686-cygwin" then cygwin
     else if pkgs.stdenv.system == "powerpc-darwin" then darwin && powerpc
     else if pkgs.stdenv.system == "powerpc-linux" then linux && powerpc
     else if pkgs.stdenv.system == "i686-darwin" then darwin
+    else if pkgs.stdenv.system == "x86_64-darwin" then darwin
     else false;
 
   /**



From R.B.Vermaas at tudelft.nl  Tue Feb  2 11:13:26 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 10:13:26 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20565 - rob - hydra
Message-ID: <201002021013.o12ADQuH028306@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 10:13:26 +0000 (Tue, 02 Feb 2010)
New Revision: 20565

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20565&view=rev

Modified:
   hydra/build.nix

Log:
revert previous change

Changes:

Modified: hydra/build.nix
===================================================================
--- hydra/build.nix	2010-02-02 10:11:57 UTC (rev 20564)
+++ hydra/build.nix	2010-02-02 10:13:26 UTC (rev 20565)
@@ -49,8 +49,6 @@
    * Build spec as a dependency using pkgs (not as a NixBuild).
    */
   easyBuild = pkgs : spec :
-    if (spec pkgs).systemSupported then null
-    else
     let baseline = inputs.baseline pkgs ;
     in 
     if builtins.hasAttr (spec pkgs).attrPrefix inputs then
@@ -68,8 +66,6 @@
    * Build spec using pkgs from a given tarball.
    */
   easyNixBuildFromTarball =  tarball : pkgs : specpkgs : 
-    if !specpkgs.systemSupported then null
-    else
     pkgs.releaseTools.nixBuild (
       (if specpkgs ? customEnv then specpkgs.customEnv else {}) // {
       name = specpkgs.packageName;



From R.B.Vermaas at tudelft.nl  Tue Feb  2 12:56:54 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 02 Feb 2010 11:56:54 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20566 - rob - hydra/jobs
Message-ID: <201002021156.o12BusgI029727@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-02 11:56:54 +0000 (Tue, 02 Feb 2010)
New Revision: 20566

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20566&view=rev

Modified:
   hydra/jobs/strategoxt-packages.nix

Log:
add strc-java to strategoxt-packages

Changes:

Modified: hydra/jobs/strategoxt-packages.nix
===================================================================
--- hydra/jobs/strategoxt-packages.nix	2010-02-02 10:13:26 UTC (rev 20565)
+++ hydra/jobs/strategoxt-packages.nix	2010-02-02 11:56:54 UTC (rev 20566)
@@ -4,6 +4,7 @@
 , strategoxtUtilsTarball ? { outPath = ./strategoxt-utils-0.17.tar.gz ;}
 , javaFrontTarball ? { outPath = ./java-front-0.9.tar.gz; }
 , dryadTarball ? { outPath = ./dryad-0.2pre18756.tar.gz; }
+, strcJavaTarball
 } :
 
 let
@@ -14,7 +15,7 @@
     aterm = pkgs.strategoPackages018.aterm ;
     sdf2Bundle = pkgs.strategoPackages018.sdf ;
 
-    inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball;
+    inherit strategoxtTarball strategoxtUtilsTarball javaFrontTarball dryadTarball strcJavaTarball;
   };
   builder = import ../build.nix { inherit baseline pkgsDefault nixpkgs; } ;
 
@@ -27,6 +28,7 @@
     strategoxtUtils = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strategoxtUtilsTarball sysPkgs (specs.strategoxtUtils sysPkgs) ;
     javaFront       = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball javaFrontTarball sysPkgs (specs.javaFront sysPkgs) ;
     dryad           = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball dryadTarball sysPkgs (specs.dryad sysPkgs) ;
+    strcJava        = {system ? "i686-linux"}: let sysPkgs = systemPkgs system ; in builder.easyNixBuildFromTarball strcJavaTarball sysPkgs (specs.strcJava sysPkgs) ;
 
   };
 in jobs



From R.B.Vermaas at tudelft.nl  Wed Feb  3 14:56:17 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 03 Feb 2010 13:56:17 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20567 - rob - hydra/jobs
Message-ID: <201002031356.o13DuHLq018790@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-03 13:56:17 +0000 (Wed, 03 Feb 2010)
New Revision: 20567

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20567&view=rev

Modified:
   hydra/jobs/aster.nix

Log:
asterJava

Changes:

Modified: hydra/jobs/aster.nix
===================================================================
--- hydra/jobs/aster.nix	2010-02-02 11:56:54 UTC (rev 20566)
+++ hydra/jobs/aster.nix	2010-02-03 13:56:17 UTC (rev 20567)
@@ -18,6 +18,35 @@
       } ; 
    
       spec = specs.aster ; 
+
+      extraJobs = builder : {
+        asterJava = { system ? "x86_64-linux" }:
+          let pkgs = (import nixpkgs { inherit system; });
+          in
+            pkgs.stdenv.mkDerivation (
+              (if (spec pkgs) ? svnCustomEnv then (spec pkgs).svnCustomEnv else {}) // rec {
+                name = "aster-java" ;
+                src = asterCheckout;
+
+                inherit officialRelease;
+                preConfigure = ''
+                  ./bootstrap
+                '';
+                buildPhase = ''
+                  make
+                  make -C trans java/aster.jar
+                '';
+                installPhase = ''
+                  ensureDir $out/nix-support
+                  ensureDir $out/jar
+                  cp trans/java/aster.jar $out/jar
+                  echo "file jar $out/jar/aster.jar" > $out/nix-support/hydra-build-products
+                '';
+
+                buildInputs =
+                  [pkgs.jdk] ++ (spec pkgs).svnBuildInputs ++ (map (spec2: builder.easyBuild pkgs spec2) (spec pkgs).svnRequires);
+            });
+        };
     } ;
 
 in jobs



From R.B.Vermaas at tudelft.nl  Wed Feb  3 14:57:27 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 03 Feb 2010 13:57:27 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20568 - rob - hydra/jobs
Message-ID: <201002031357.o13DvRcF018805@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-03 13:57:27 +0000 (Wed, 03 Feb 2010)
New Revision: 20568

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20568&view=rev

Modified:
   hydra/jobs/aster.nix

Log:
asterJava typo

Changes:

Modified: hydra/jobs/aster.nix
===================================================================
--- hydra/jobs/aster.nix	2010-02-03 13:56:17 UTC (rev 20567)
+++ hydra/jobs/aster.nix	2010-02-03 13:57:27 UTC (rev 20568)
@@ -8,7 +8,7 @@
 let
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = 
-    import (hydraConfig + "/job.nix" ) { 
+    import (hydraConfig + "/job.nix" ) rec { 
       inputs = { 
         inherit officialRelease ; 
         inherit asterCheckout ;



From R.B.Vermaas at tudelft.nl  Wed Feb  3 14:58:18 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 03 Feb 2010 13:58:18 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20569 - rob - hydra/jobs
Message-ID: <201002031358.o13DwIaV018820@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-03 13:58:18 +0000 (Wed, 03 Feb 2010)
New Revision: 20569

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20569&view=rev

Modified:
   hydra/jobs/aster.nix

Log:
asterJava: only build on default system

Changes:

Modified: hydra/jobs/aster.nix
===================================================================
--- hydra/jobs/aster.nix	2010-02-03 13:57:27 UTC (rev 20568)
+++ hydra/jobs/aster.nix	2010-02-03 13:58:18 UTC (rev 20569)
@@ -20,8 +20,8 @@
       spec = specs.aster ; 
 
       extraJobs = builder : {
-        asterJava = { system ? "x86_64-linux" }:
-          let pkgs = (import nixpkgs { inherit system; });
+        asterJava = 
+          let pkgs = (import nixpkgs { });
           in
             pkgs.stdenv.mkDerivation (
               (if (spec pkgs) ? svnCustomEnv then (spec pkgs).svnCustomEnv else {}) // rec {



From R.B.Vermaas at tudelft.nl  Wed Feb  3 15:50:21 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 03 Feb 2010 14:50:21 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20570 - rob - hydra/jobs
Message-ID: <201002031450.o13EoLMd019539@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-03 14:50:20 +0000 (Wed, 03 Feb 2010)
New Revision: 20570

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20570&view=rev

Modified:
   hydra/jobs/aster.nix

Log:
pass latest strc-java build to asterJava job

Changes:

Modified: hydra/jobs/aster.nix
===================================================================
--- hydra/jobs/aster.nix	2010-02-03 13:58:18 UTC (rev 20569)
+++ hydra/jobs/aster.nix	2010-02-03 14:50:20 UTC (rev 20570)
@@ -20,7 +20,7 @@
       spec = specs.aster ; 
 
       extraJobs = builder : {
-        asterJava = 
+        asterJava = { strcJava }: 
           let pkgs = (import nixpkgs { });
           in
             pkgs.stdenv.mkDerivation (
@@ -44,7 +44,7 @@
                 '';
 
                 buildInputs =
-                  [pkgs.jdk] ++ (spec pkgs).svnBuildInputs ++ (map (spec2: builder.easyBuild pkgs spec2) (spec pkgs).svnRequires);
+                  [strcJava pkgs.jdk] ++ (spec pkgs).svnBuildInputs ++ (map (spec2: builder.easyBuild pkgs spec2) (spec pkgs).svnRequires);
             });
         };
     } ;



From L.C.L.Kats at tudelft.nl  Wed Feb  3 17:24:59 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 03 Feb 2010 16:24:59 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20571 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002031624.o13GOx0C020872@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-03 16:24:59 +0000 (Wed, 03 Feb 2010)
New Revision: 20571

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20571&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:
Look mom, no which!

Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-03 14:50:20 UTC (rev 20570)
+++ strc-java/trunk/tools/strj-jar	2010-02-03 16:24:59 UTC (rev 20571)
@@ -14,7 +14,7 @@
 TEMPDIR=$TEMP/strj-jar-`date +'%N'`
 
 if which strj-jar &>/dev/null; then
-  CLASSPATH=$(cd $(dirname $(which strj-jar))/..; pwd)/share/strc-java/strategoxt.jar
+  CLASSPATH=`dirname "$(cd ${0%/*}/.. && echo $PWD/${0##*/})"`/share/strc-java/strategoxt.jar
 fi
 
 ## PARAMETERS



From L.C.L.Kats at tudelft.nl  Thu Feb  4 13:28:08 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Thu, 04 Feb 2010 12:28:08 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20572 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services
Message-ID: <201002041228.o14CS8rR005103@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-04 12:28:08 +0000 (Thu, 04 Feb 2010)
New Revision: 20572

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20572&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java

Log:
Fixed a content proposal caching problem reported by Rob.

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-03 16:24:59 UTC (rev 20571)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-04 12:28:08 UTC (rev 20572)
@@ -87,6 +87,8 @@
 	
 	private String lastDocument;
 	
+	private int lastOffset;
+	
 	private AstNode currentCompletionNode;
 	
 	private String currentCompletionPrefix;
@@ -311,27 +313,30 @@
 	 */
 	private RootAstNode tryReusePreviousAst(int offset, String document) {
 		if (offset == 0) return null;
-		if (lastCompletionNode != null && lastDocument.length() == document.length() - 1) {
+		if (lastCompletionNode != null && lastDocument.length() == document.length() - 1 && lastOffset == offset - 1) {
 			// Reuse document, ignoring latest typed character
 			String newCharacter = document.substring(offset - 1, offset);
 			String previousDocument = lastDocument.substring(0, offset - 1) + newCharacter + lastDocument.substring(offset - 1);
 			if (document.equals(previousDocument))
-				return reusePreviousAst(document, lastCompletionPrefix + newCharacter);
-		} else if (lastCompletionNode != null && lastCompletionPrefix.length() > 0 && lastDocument.length() == document.length() + 1) {
+				return reusePreviousAst(offset, document, lastCompletionPrefix + newCharacter);
+		} else if (lastCompletionNode != null && lastCompletionPrefix.length() > 0
+				&& lastDocument.length() == document.length() + 1 && lastOffset == offset + 1) {
 			// Reuse document, ignoring previously typed character
 			String previousDocument = lastDocument.substring(0, offset) + lastDocument.substring(offset + 1);
 			if (document.equals(previousDocument))
-				return reusePreviousAst(document, lastCompletionPrefix.substring(0, lastCompletionPrefix.length() - 1));
-		} else if (lastCompletionNode != null && lastDocument.equals(document)) {
-			return reusePreviousAst(document, lastCompletionPrefix);
+				return reusePreviousAst(offset, document, lastCompletionPrefix.substring(0, lastCompletionPrefix.length() - 1));
+		} else if (lastCompletionNode != null && lastDocument.equals(document) && offset == lastOffset) {
+			return reusePreviousAst(offset, document, lastCompletionPrefix);
 		}
 		lastDocument = document;
+		lastOffset = offset;
 		return null;
 	}
 
-	private RootAstNode reusePreviousAst(String document, String prefix) {
+	private RootAstNode reusePreviousAst(int offset, String document, String prefix) {
 		currentCompletionPrefix = prefix;
 		lastDocument = document;
+		lastOffset = offset;
 		String prefixInAst = sanitizePrefix(currentCompletionPrefix);
 		if (prefixInAst == null)
 			return null;



From L.C.L.Kats at tudelft.nl  Thu Feb  4 16:13:45 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Thu, 04 Feb 2010 15:13:45 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20573 - LennartKats -
	strc-java/trunk/java
Message-ID: <201002041513.o14FDjG7007137@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-04 15:13:45 +0000 (Thu, 04 Feb 2010)
New Revision: 20573

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20573&view=rev

Modified:
   strc-java/trunk/java/Makefile.am

Log:
mkdir bin

Changes:

Modified: strc-java/trunk/java/Makefile.am
===================================================================
--- strc-java/trunk/java/Makefile.am	2010-02-04 12:28:08 UTC (rev 20572)
+++ strc-java/trunk/java/Makefile.am	2010-02-04 15:13:45 UTC (rev 20573)
@@ -176,6 +176,9 @@
 		exit 1 ;\
 	fi
 
+bin :
+	mkdir bin
+
 lib/org/strategoxt/stratego_gpp/Main.java : $(STRATEGOXT)/share/libstratego-gpp.ctree ../trans/strj runtime/org/strategoxt/lang/compat/override/gpp_performance/Main.java
 	$(STRJ) -I $(STRATEGOXT)/share -I $(STRATEGOXT)/share/sdf/gpp -i $< -o $@ $(STRJFLAGS) -p org.strategoxt.stratego_gpp -la stratego-lib -la stratego-lib -la stratego-sglr -la org.strategoxt.lang.compat.override.gpp_performance
 



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:08:01 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:08:01 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20574 - rob - hydra/jobs
Message-ID: <201002050808.o15881ag020788@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:08:01 +0000 (Fri, 05 Feb 2010)
New Revision: 20574

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20574&view=rev

Added:
   hydra/jobs/strategoxt-bootstrap.nix

Log:
seperate file for bootstrap

Changes:

Copied: hydra/jobs/strategoxt-bootstrap.nix (from rev 20558, hydra/jobs/strategoxt.nix)
===================================================================
--- hydra/jobs/strategoxt-bootstrap.nix	                        (rev 0)
+++ hydra/jobs/strategoxt-bootstrap.nix	2010-02-05 08:08:01 UTC (rev 20574)
@@ -0,0 +1,109 @@
+{ nixpkgs ? ../../nixpkgs
+, officialRelease ? false
+, strategoxtCheckout ? {outPath = ../../strategoxt ; rev = 1234;}
+, system ? "i686-linux"
+}:
+
+let
+  pkgs = import nixpkgs { system = "i686-linux" ; };
+
+  strategoxtBaseline =
+    pkgs.stdenv.mkDerivation {
+      name = "strategoxt-baseline";
+      src = pkgs.fetchurl {
+              url = "http://hydra.nixos.org/build/124117/download/1/strategoxt-0.18pre20227.tar.gz";
+              sha256 = "c2c7a68f76c6dfaf470ed9f7bad71cddebb620b709f20b01231c3a6fd93d8150";
+            };
+
+      buildInputs = defaultBuildInputs pkgs ;
+    };
+
+  aterm = pkgs : pkgs.aterm ;
+  sdf2Bundle = pkgs : pkgs.strategoPackages017.sdf ;
+
+  defaultBuildInputs = pkgs :
+    [ pkgs.pkgconfig
+      (aterm pkgs)
+      (sdf2Bundle pkgs)
+      pkgs.getopt
+    ];
+
+  defaultSvnBuildInputs = pkgs :
+    [ pkgs.autoconf
+      pkgs.automake110x
+      pkgs.libtool
+      pkgs.subversion
+    ] ++ defaultBuildInputs pkgs;
+
+  makeStrategoXTTarball = { name, baseline, useTempPrefix ? false }:  
+    pkgs.releaseTools.makeSourceTarball {
+      name = name;
+
+      src = strategoxtCheckout;
+
+      configureFlags = " --with-strategoxt=${baseline} --enable-werror";
+
+      buildInputs = defaultSvnBuildInputs pkgs ;
+
+      doCheck = false;
+      dontInstall = false;
+      tarballs = "*.tar.gz";
+
+      inherit officialRelease;
+      inherit useTempPrefix;
+    };
+
+  svn_tarball_run1 = 
+    makeStrategoXTTarball {
+      name = "strategoxt-tarball1" ;
+      baseline = strategoxtBaseline ;
+    } ;
+
+  svn_tarball_run2 = 
+    makeStrategoXTTarball {
+      name = "strategoxt-tarball2" ;
+      baseline = svn_tarball_run1 ;
+    } ;
+
+  systemPkgs = import nixpkgs {inherit system;};
+
+  jobs = {
+
+    tarball = 
+      makeStrategoXTTarball {
+        name = "strategoxt-tarball";
+        baseline = svn_tarball_run2;
+        useTempPrefix = true;
+      };
+
+    build =
+      { tarball ? jobs.tarball
+      }:
+ 
+      with systemPkgs ;
+
+      releaseTools.nixBuild {
+        name = "strategoxt";
+        src = tarball;
+        buildInputs = defaultBuildInputs systemPkgs ;
+
+        configureFlags = if system == "i686-cygwin" then ["--disable-debug" "--enable-werror"] else ["--enable-werror"] ;
+        CFLAGS = if system == "i686-cygwin" then "-O0" else "" ;
+
+        preConfigure = if system == "i686-cygwin" then ''
+          export PATH=$PATH:${aterm systemPkgs}/lib:${sdf2Bundle systemPkgs}/lib:${aterm systemPkgs}/bin:${sdf2Bundle systemPkgs}/bin:$out/lib:$out/bin:.
+        '' else '''' ; 
+
+        doCheck = true ;
+        cygwinConfigureEnableShared = true;
+
+        phases = "unpackPhase patchPhase configurePhase buildPhase installPhase checkPhase fixupPhase distPhase finalPhase";
+  
+      } ;
+
+    aterm = aterm systemPkgs ;
+    sdf2Bundle = sdf2Bundle systemPkgs ;
+  } ;
+
+in jobs
+



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:10:24 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:10:24 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20575 - rob - hydra/jobs
Message-ID: <201002050810.o158AOEZ020820@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:10:24 +0000 (Fri, 05 Feb 2010)
New Revision: 20575

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20575&view=rev

Modified:
   hydra/jobs/strategoxt-bootstrap.nix

Log:
remove aterm and sdf

Changes:

Modified: hydra/jobs/strategoxt-bootstrap.nix
===================================================================
--- hydra/jobs/strategoxt-bootstrap.nix	2010-02-05 08:08:01 UTC (rev 20574)
+++ hydra/jobs/strategoxt-bootstrap.nix	2010-02-05 08:10:24 UTC (rev 20575)
@@ -100,9 +100,6 @@
         phases = "unpackPhase patchPhase configurePhase buildPhase installPhase checkPhase fixupPhase distPhase finalPhase";
   
       } ;
-
-    aterm = aterm systemPkgs ;
-    sdf2Bundle = sdf2Bundle systemPkgs ;
   } ;
 
 in jobs



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:11:20 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:11:20 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20576 - rob - hydra/jobs
Message-ID: <201002050811.o158BKQ9020828@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:11:20 +0000 (Fri, 05 Feb 2010)
New Revision: 20576

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20576&view=rev

Modified:
   hydra/jobs/strategoxt-bootstrap.nix

Log:
remove build job for strategoxt-bootstrap

Changes:

Modified: hydra/jobs/strategoxt-bootstrap.nix
===================================================================
--- hydra/jobs/strategoxt-bootstrap.nix	2010-02-05 08:10:24 UTC (rev 20575)
+++ hydra/jobs/strategoxt-bootstrap.nix	2010-02-05 08:11:20 UTC (rev 20576)
@@ -68,39 +68,13 @@
   systemPkgs = import nixpkgs {inherit system;};
 
   jobs = {
-
     tarball = 
       makeStrategoXTTarball {
         name = "strategoxt-tarball";
         baseline = svn_tarball_run2;
         useTempPrefix = true;
       };
+  };
 
-    build =
-      { tarball ? jobs.tarball
-      }:
- 
-      with systemPkgs ;
-
-      releaseTools.nixBuild {
-        name = "strategoxt";
-        src = tarball;
-        buildInputs = defaultBuildInputs systemPkgs ;
-
-        configureFlags = if system == "i686-cygwin" then ["--disable-debug" "--enable-werror"] else ["--enable-werror"] ;
-        CFLAGS = if system == "i686-cygwin" then "-O0" else "" ;
-
-        preConfigure = if system == "i686-cygwin" then ''
-          export PATH=$PATH:${aterm systemPkgs}/lib:${sdf2Bundle systemPkgs}/lib:${aterm systemPkgs}/bin:${sdf2Bundle systemPkgs}/bin:$out/lib:$out/bin:.
-        '' else '''' ; 
-
-        doCheck = true ;
-        cygwinConfigureEnableShared = true;
-
-        phases = "unpackPhase patchPhase configurePhase buildPhase installPhase checkPhase fixupPhase distPhase finalPhase";
-  
-      } ;
-  } ;
-
 in jobs
 



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:23:04 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:23:04 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20577 - rob - hydra/jobs
Message-ID: <201002050823.o158N4hq020901@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:23:04 +0000 (Fri, 05 Feb 2010)
New Revision: 20577

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20577&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
new strategoxt job

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-05 08:11:20 UTC (rev 20576)
+++ hydra/jobs/strategoxt.nix	2010-02-05 08:23:04 UTC (rev 20577)
@@ -1,109 +1,25 @@
 { nixpkgs ? ../../nixpkgs
 , officialRelease ? false
-, strategoxtCheckout ? {outPath = ../../strategoxt ; rev = 1234;}
-, system ? "i686-linux"
-}:
+, hydraConfig ? ../. 
+, strategoxtTarball
+} :
 
 let
-  pkgs = import nixpkgs { system = "i686-linux" ; };
-
-  strategoxtBaseline =
-    pkgs.stdenv.mkDerivation {
-      name = "strategoxt-baseline";
-      src = pkgs.fetchurl {
-              url = "http://hydra.nixos.org/build/124117/download/1/strategoxt-0.18pre20227.tar.gz";
-              sha256 = "c2c7a68f76c6dfaf470ed9f7bad71cddebb620b709f20b01231c3a6fd93d8150";
-            };
-
-      buildInputs = defaultBuildInputs pkgs ;
-    };
-
-  aterm = pkgs : pkgs.aterm ;
-  sdf2Bundle = pkgs : pkgs.strategoPackages017.sdf ;
-
-  defaultBuildInputs = pkgs :
-    [ pkgs.pkgconfig
-      (aterm pkgs)
-      (sdf2Bundle pkgs)
-      pkgs.getopt
-    ];
-
-  defaultSvnBuildInputs = pkgs :
-    [ pkgs.autoconf
-      pkgs.automake110x
-      pkgs.libtool
-      pkgs.subversion
-    ] ++ defaultBuildInputs pkgs;
-
-  makeStrategoXTTarball = { name, baseline, useTempPrefix ? false }:  
-    pkgs.releaseTools.makeSourceTarball {
-      name = name;
-
-      src = strategoxtCheckout;
-
-      configureFlags = " --with-strategoxt=${baseline} --enable-werror";
-
-      buildInputs = defaultSvnBuildInputs pkgs ;
-
-      doCheck = false;
-      dontInstall = false;
-      tarballs = "*.tar.gz";
-
-      inherit officialRelease;
-      inherit useTempPrefix;
-    };
-
-  svn_tarball_run1 = 
-    makeStrategoXTTarball {
-      name = "strategoxt-tarball1" ;
-      baseline = strategoxtBaseline ;
+  specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
+  jobs = 
+    import (hydraConfig + "/job.nix" ) { 
+      inputs = { 
+        inherit officialRelease ; 
+        inherit strategoxtTarball ;
+        inherit hydraConfig ;
+        baselineNix = "${hydraConfig}/baseline.nix" ;
+        inherit nixpkgs;
+        makeDebs = false;
+        makeRPMs = false;
+      } ; 
+   
+      spec = specs.strategoxt ; 
     } ;
 
-  svn_tarball_run2 = 
-    makeStrategoXTTarball {
-      name = "strategoxt-tarball2" ;
-      baseline = svn_tarball_run1 ;
-    } ;
-
-  systemPkgs = import nixpkgs {inherit system;};
-
-  jobs = {
-
-    tarball = 
-      makeStrategoXTTarball {
-        name = "strategoxt-tarball";
-        baseline = svn_tarball_run2;
-        useTempPrefix = true;
-      };
-
-    build =
-      { tarball ? jobs.tarball
-      }:
- 
-      with systemPkgs ;
-
-      releaseTools.nixBuild {
-        name = "strategoxt";
-        src = tarball;
-        buildInputs = defaultBuildInputs systemPkgs ;
-
-        configureFlags = if system == "i686-cygwin" then ["--disable-debug" "--enable-werror"] else ["--enable-werror"] ;
-        CFLAGS = if system == "i686-cygwin" then "-O0" else "" ;
-
-        preConfigure = if system == "i686-cygwin" then ''
-          export PATH=$PATH:${aterm systemPkgs}/lib:${sdf2Bundle systemPkgs}/lib:${aterm systemPkgs}/bin:${sdf2Bundle systemPkgs}/bin:$out/lib:$out/bin:.
-        '' else '''' ; 
-
-        doCheck = true ;
-        cygwinConfigureEnableShared = true;
-
-        phases = "unpackPhase patchPhase configurePhase buildPhase installPhase checkPhase fixupPhase distPhase finalPhase";
-  
-      } ;
-
-    aterm = aterm systemPkgs ;
-    sdf2Bundle = sdf2Bundle systemPkgs ;
-  } ;
-
 in jobs
 



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:26:37 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:26:37 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20578 - rob - hydra/jobs
Message-ID: <201002050826.o158Qb9x020931@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:26:37 +0000 (Fri, 05 Feb 2010)
New Revision: 20578

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20578&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
removed parameter

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-05 08:23:04 UTC (rev 20577)
+++ hydra/jobs/strategoxt.nix	2010-02-05 08:26:37 UTC (rev 20578)
@@ -1,5 +1,4 @@
 { nixpkgs ? ../../nixpkgs
-, officialRelease ? false
 , hydraConfig ? ../. 
 , strategoxtTarball
 } :



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:28:09 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:28:09 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20579 - rob - hydra/jobs
Message-ID: <201002050828.o158S9X6020952@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:28:09 +0000 (Fri, 05 Feb 2010)
New Revision: 20579

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20579&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
removed parameter

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-05 08:26:37 UTC (rev 20578)
+++ hydra/jobs/strategoxt.nix	2010-02-05 08:28:09 UTC (rev 20579)
@@ -8,7 +8,6 @@
   jobs = 
     import (hydraConfig + "/job.nix" ) { 
       inputs = { 
-        inherit officialRelease ; 
         inherit strategoxtTarball ;
         inherit hydraConfig ;
         baselineNix = "${hydraConfig}/baseline.nix" ;



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:30:26 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:30:26 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20580 - rob - hydra/jobs
Message-ID: <201002050830.o158UQfx020988@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:30:26 +0000 (Fri, 05 Feb 2010)
New Revision: 20580

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20580&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
removed parameter

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-05 08:28:09 UTC (rev 20579)
+++ hydra/jobs/strategoxt.nix	2010-02-05 08:30:26 UTC (rev 20580)
@@ -1,6 +1,5 @@
 { nixpkgs ? ../../nixpkgs
 , hydraConfig ? ../. 
-, strategoxtTarball
 } :
 
 let
@@ -8,7 +7,6 @@
   jobs = 
     import (hydraConfig + "/job.nix" ) { 
       inputs = { 
-        inherit strategoxtTarball ;
         inherit hydraConfig ;
         baselineNix = "${hydraConfig}/baseline.nix" ;
         inherit nixpkgs;



From R.B.Vermaas at tudelft.nl  Fri Feb  5 09:35:25 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 08:35:25 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20581 - rob - hydra/jobs
Message-ID: <201002050835.o158ZP5E021015@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 08:35:25 +0000 (Fri, 05 Feb 2010)
New Revision: 20581

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20581&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
turn on deb/rpm for strategoxt trunk builds

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-05 08:30:26 UTC (rev 20580)
+++ hydra/jobs/strategoxt.nix	2010-02-05 08:35:25 UTC (rev 20581)
@@ -10,8 +10,8 @@
         inherit hydraConfig ;
         baselineNix = "${hydraConfig}/baseline.nix" ;
         inherit nixpkgs;
-        makeDebs = false;
-        makeRPMs = false;
+        makeDebs = true;
+        makeRPMs = true;
       } ; 
    
       spec = specs.strategoxt ; 



From R.B.Vermaas at tudelft.nl  Fri Feb  5 10:20:35 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 09:20:35 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20582 - rob -
	hydra/meta-environment
Message-ID: <201002050920.o159KZB5021703@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 09:20:35 +0000 (Fri, 05 Feb 2010)
New Revision: 20582

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20582&view=rev

Modified:
   hydra/meta-environment/packages.nix

Log:
aterm max-long patch for aterm25

Changes:

Modified: hydra/meta-environment/packages.nix
===================================================================
--- hydra/meta-environment/packages.nix	2010-02-05 08:35:25 UTC (rev 20581)
+++ hydra/meta-environment/packages.nix	2010-02-05 09:20:35 UTC (rev 20582)
@@ -12,7 +12,6 @@
       attrPrefix = "metaBuildEnv";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/meta-build-env/trunk";
@@ -35,7 +34,6 @@
       packageName = "aterm";
       attrPrefix = "aterm";
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
       
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/aterm/trunk";
@@ -61,6 +59,37 @@
       customEnv = { dontDisableStatic = true; }; 
     };
 
+  aterm25 =
+    pkgs : rec {
+      fullName = "ATerm Library";
+      packageName = "aterm";
+      attrPrefix = "aterm";
+      contactEmail = "meta-users-list at cwi.nl";
+      
+      svn = {
+        trunk = "svn+ssh://svn.cwi.nl/aterm/trunk";
+        branch64 = "svn+ssh://svn.cwi.nl/aterm/branches/64-bit-fixes";
+      };
+
+      buildInputs = [pkgs.pkgconfig];
+      requires = [];
+
+      svnBuildInputs = [pkgs.tetex pkgs.transfig] ++ (autotools pkgs);
+      svnRequires = [metaBuildEnv];
+      patches = [ ./aterm-max-long.patch ] ++ (
+        if isMinGW pkgs then
+          [ ./aterm-mingw-asm.patch ]
+        else [] ) ;
+
+      rpmBuildSupported = true;
+
+      systemSupported = systemSupport pkgs { bsd = false; mingw = true;};
+
+      binArchives =
+        if isMinGW pkgs then [{ inherit requires; }] else [];
+      customEnv = { dontDisableStatic = true; }; 
+    };
+
   sdfLibrary =
     pkgs : rec {
       fullName = "SDF Library";
@@ -68,7 +97,6 @@
       attrPrefix = "sdfLibrary";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/sdf-library/trunk";
@@ -90,7 +118,6 @@
       packageName = "toolbuslib";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/toolbuslib/trunk";
@@ -112,7 +139,6 @@
       packageName = "c-library";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/c-library/trunk";
@@ -134,7 +160,6 @@
       packageName = "error-support" ;
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/error-support/trunk";
@@ -156,7 +181,6 @@
       packageName = "relation-stores";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/relation-stores/trunk";
@@ -178,7 +202,6 @@
       packageName = "rstore-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/rstore-support/trunk";
@@ -200,7 +223,6 @@
       packageName = "config-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/config-support/trunk";
@@ -222,7 +244,6 @@
       packageName = "tide-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/tide-support/trunk";
@@ -244,7 +265,6 @@
       packageName = "pt-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/pt-support/trunk";
@@ -267,7 +287,6 @@
       packageName = "ptable-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/ptable-support/trunk";
@@ -289,7 +308,6 @@
       packageName = "asf-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/asf-support/trunk";
@@ -311,7 +329,6 @@
       packageName = "sdf-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/sdf-support/trunk";
@@ -333,7 +350,6 @@
       packageName = "sglr";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/sglr/trunk";
@@ -359,7 +375,6 @@
       packageName = "asc-support";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/asc-support/trunk";
@@ -384,7 +399,6 @@
       packageName = "pgen";
 
       contactEmail = "meta-users-list at cwi.nl";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       svn = {
         trunk = "svn+ssh://svn.cwi.nl/pgen/trunk";
@@ -506,7 +520,6 @@
       attrPrefix = "sdf2Bundle";
 
       contactEmail = "users at syntax-definition.org";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       license = "LGPL";
       rpmInfo = {
@@ -562,7 +575,6 @@
 
       attrPrefix = "sdf2Bundle";
       contactEmail = "users at syntax-definition.org";
-      notifyAddresses = ["martin.bravenboer at gmail.com"];
 
       bundles = [toolbuslib errorSupport ptSupport asfSupport sdfSupport sglr
           tideSupport ascSupport pgen sdfLibrary



From R.B.Vermaas at tudelft.nl  Fri Feb  5 10:46:08 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 09:46:08 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20583 - rob -
	hydra/strategoxt
Message-ID: <201002050946.o159k8Vt022004@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 09:46:08 +0000 (Fri, 05 Feb 2010)
New Revision: 20583

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20583&view=rev

Modified:
   hydra/strategoxt/packages.nix

Log:
use aterm25 spec

Changes:

Modified: hydra/strategoxt/packages.nix
===================================================================
--- hydra/strategoxt/packages.nix	2010-02-05 09:20:35 UTC (rev 20582)
+++ hydra/strategoxt/packages.nix	2010-02-05 09:46:08 UTC (rev 20583)
@@ -16,7 +16,7 @@
     metaBuildEnv
     sdf2Bundle
     sdf2Bundle24
-    aterm
+    aterm25
     cLibrary
     toolbuslib
     relationStores
@@ -32,6 +32,8 @@
     tideSupport
     asfSupport;
 
+  aterm = aterm25 ;
+
   /**
    * Stratego/XT
    */



From R.B.Vermaas at tudelft.nl  Fri Feb  5 10:57:26 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Fri, 05 Feb 2010 09:57:26 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20584 - rob - hydra/jobs
Message-ID: <201002050957.o159vQbi022097@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-05 09:57:26 +0000 (Fri, 05 Feb 2010)
New Revision: 20584

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20584&view=rev

Modified:
   hydra/jobs/strategoxt-manual.nix

Log:


Changes:

Modified: hydra/jobs/strategoxt-manual.nix
===================================================================
--- hydra/jobs/strategoxt-manual.nix	2010-02-05 09:46:08 UTC (rev 20583)
+++ hydra/jobs/strategoxt-manual.nix	2010-02-05 09:57:26 UTC (rev 20584)
@@ -57,6 +57,11 @@
         + " --with-docbook-xml=${pkgs.docbook5}"
         + " --with-docbook-xsl=${pkgs.docbook_xml_xslt}";
 
+      preConfigure = ''
+        # TeX needs a writable font cache.
+        export VARTEXFONTS=$TMPDIR/texfonts
+      '';
+
       postDist = ''
         ensureDir $out/nix-support
 



From L.C.L.Kats at tudelft.nl  Mon Feb  8 10:24:52 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 09:24:52 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20585 - LennartKats -
 spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.aterm/src/org/spoofax/interpreter/adapter/aterm
 spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.ecj/src/org/spoofax/interpreter/adapter/ecj
 spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core
 spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library
 spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl
 spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego
 spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms
 spoofax/trunk/spoofax/org.spoofax.interpreter.library.jsglr/src/org/spoofax/interpreter/library/jsglr
 spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr
 spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego
 spoofax-imp/trun!
 k/org.strategoxt.imp.nativebundle/src/org/strategoxt/imp/nativebundle
 spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services
 spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego
 strc-java/trunk strc-java/trunk/java
 strc-java/trunk/java/runtime/org/strategoxt
 strc-java/trunk/java/runtime/org/strategoxt/lang/compat
Message-ID: <201002080924.o189OqYu015902@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 09:24:51 +0000 (Mon, 08 Feb 2010)
New Revision: 20585

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20585&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego/IMPParseStrategoFileStrategy.java
   spoofax-imp/trunk/org.strategoxt.imp.nativebundle/src/org/strategoxt/imp/nativebundle/SDFBundleCommand.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/EditorIOAgent.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPOpenFile.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPReadTextFromStream.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/SourceMappings.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/StrategoConsole.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.aterm/src/org/spoofax/interpreter/adapter/aterm/WrappedATermFactory.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.ecj/src/org/spoofax/interpreter/adapter/ecj/ECJFactory.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/IOAgent.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/LoggingIOAgent.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_copy.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fflush.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fgetc.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputc.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputs.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_printnl.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_stream.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_string.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_baf.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_saf.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_taf.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_text.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/GuardedLChoice.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/One.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/Some.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/BasicTermFactory.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/ITermFactory.java
   spoofax/trunk/spoofax/org.spoofax.interpreter.library.jsglr/src/org/spoofax/interpreter/library/jsglr/JSGLR_parse_string_pt.java
   spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/SGLR.java
   strc-java/trunk/.classpath
   strc-java/trunk/java/runtime/org/strategoxt/HybridInterpreter.java
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/NativeCallHelper.java
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/SSL_EXT_call.java
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/SSL_EXT_read_text_from_stream.java
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/SSL_EXT_topdown_fputs.java
   strc-java/trunk/java/spoofax-libs.jar

Log:
Changed IOAgent to use channel-based I/O.

Changes (first 1000 lines of the diffs):

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.aterm/src/org/spoofax/interpreter/adapter/aterm/WrappedATermFactory.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.aterm/src/org/spoofax/interpreter/adapter/aterm/WrappedATermFactory.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.aterm/src/org/spoofax/interpreter/adapter/aterm/WrappedATermFactory.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -7,9 +7,11 @@
  */
 package org.spoofax.interpreter.adapter.aterm;
 
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.io.Writer;
 import java.util.Collection;
 import java.util.WeakHashMap;
 
@@ -199,6 +201,12 @@
     	((WrappedATerm)t).getATerm().writeToTextFile(ous);
     }
 
+    public void unparseToFile(IStrategoTerm t, final Writer out) throws IOException {
+        ByteArrayOutputStream ous = new ByteArrayOutputStream();
+        unparseToFile(t, out);
+        out.write(ous.toString());
+    }
+
     public IStrategoConstructor wrapConstructor(AFun fun) {
         
         IStrategoConstructor c = lookupCtor(fun);

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.ecj/src/org/spoofax/interpreter/adapter/ecj/ECJFactory.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.ecj/src/org/spoofax/interpreter/adapter/ecj/ECJFactory.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.adapter.ecj/src/org/spoofax/interpreter/adapter/ecj/ECJFactory.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -10,6 +10,7 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.io.Writer;
 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.HashMap;
@@ -42,6 +43,7 @@
 import org.spoofax.interpreter.terms.IStrategoTerm;
 import org.spoofax.interpreter.terms.IStrategoTuple;
 import org.spoofax.interpreter.terms.ITermFactory;
+import org.spoofax.interpreter.terms.ITermPrinter;
 import org.spoofax.interpreter.terms.InlinePrinter;
 
 public class ECJFactory implements ITermFactory {
@@ -278,6 +280,12 @@
         ous.write(pp.getString().getBytes());
     }
 
+    public void unparseToFile(IStrategoTerm t, Writer out) throws IOException {
+        ITermPrinter tp = new InlinePrinter();
+        t.prettyPrint(tp);
+        out.write(tp.getString());
+    }
+
     public boolean hasConstructor(String s, int i) {
     	// FIXME also check generic factory
     	return ctorNameToIndexMap.containsKey(s);

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -1,8 +1,11 @@
 package org.spoofax.interpreter.core;
 
-import static java.lang.Math.*;
+import static java.lang.Math.min;
 
+import java.io.IOException;
+import java.io.OutputStreamWriter;
 import java.io.PrintStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.library.IOAgent;
 
@@ -122,10 +125,12 @@
      *            printed, and not any failed frames.
      */
     public final void printStackTrace(boolean onlyCurrent) {
-        PrintStream stream = getIOAgent() == null ? System.err : getIOAgent().getOutputStream(IOAgent.CONST_STDERR);
-        printStackTrace(stream, onlyCurrent);
+        Writer writer = getIOAgent() == null
+                ? new OutputStreamWriter(System.err)
+                : getIOAgent().getWriter(IOAgent.CONST_STDERR);
+        printStackTrace(writer, onlyCurrent);
     }
-
+    
     /**
      * Prints the stack trace to the default error output.
      * 
@@ -134,15 +139,23 @@
      *            printed, and not any failed frames.
      */
     public void printStackTrace(PrintStream stream, boolean onlyCurrent) {
-        int depth = onlyCurrent ? currentDepth : failureDepth;
-        String[] frames = this.frames.clone(); // avoid _most_ race conditions (for UncaughtExceptionHandler)
-        
-        for (int i = 0; i < depth; i++) {
-            if (i == MAX_REPORTED_FRAMES - MAX_REPORTED_FRAMES_TAIL) {
-                stream.println("...truncated...");
-                i = Math.max(i + 1, depth - MAX_REPORTED_FRAMES_TAIL);
+        printStackTrace(new OutputStreamWriter(stream), onlyCurrent);
+    }
+
+    private void printStackTrace(Writer writer, boolean onlyCurrent) {
+        try {
+            int depth = onlyCurrent ? currentDepth : failureDepth;
+            String[] frames = this.frames.clone(); // avoid _most_ race conditions (for UncaughtExceptionHandler)
+            
+            for (int i = 0; i < depth; i++) {
+                if (i == MAX_REPORTED_FRAMES - MAX_REPORTED_FRAMES_TAIL) {
+                    writer.write("...truncated..." + "\n");
+                    i = Math.max(i + 1, depth - MAX_REPORTED_FRAMES_TAIL);
+                }
+                writer.write("\t" + frames[i] + "\n");
             }
-            stream.println("\t" + frames[i]);
+        } catch (IOException e) {
+            // Swallow it like we're PrintStream
         }
     }
 }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/IOAgent.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/IOAgent.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/IOAgent.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -1,18 +1,26 @@
 package org.spoofax.interpreter.library;
 
-import java.io.BufferedInputStream;
-import java.io.BufferedOutputStream;
+import java.io.BufferedReader;
+import java.io.BufferedWriter;
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
+import java.io.InputStreamReader;
 import java.io.OutputStream;
 import java.io.PrintStream;
 import java.io.RandomAccessFile;
+import java.io.Reader;
+import java.io.Writer;
+import java.nio.CharBuffer;
+import java.nio.MappedByteBuffer;
+import java.nio.channels.Channels;
+import java.nio.channels.FileChannel;
+import java.nio.channels.FileChannel.MapMode;
+import java.nio.charset.Charset;
 import java.util.HashMap;
-import java.util.Iterator;
 import java.util.Map;
 
 import org.spoofax.interpreter.core.InterpreterException;
@@ -35,10 +43,24 @@
     
     public final static int CONST_STDERR = 2;
     
-    private final Map<Integer, InputStream> inStreams = new HashMap<Integer, InputStream>();
+    private final static String FILE_ENCODING = "ISO-8859-1";
     
-    private final Map<Integer, PrintStream> outStreams = new HashMap<Integer, PrintStream>();
+    private final static Charset FILE_CHARSET = Charset.forName(FILE_ENCODING);
     
+    private final Map<Integer, FileHandle> openFiles = new HashMap<Integer, FileHandle>();
+    
+    private final Writer stdoutWriter = new PrintStreamWriter(System.out);
+    
+    private final Writer stderrWriter = new PrintStreamWriter(System.err);
+    
+    private final Reader stdinReader = new InputStreamReader(System.in, FILE_CHARSET);
+    
+    private final OutputStream stdout = System.out;
+    
+    private final OutputStream stderr = System.err;
+    
+    private final InputStream stdin = System.in;
+    
     private String workingDir;
     
     private String definitionDir;
@@ -104,67 +126,124 @@
     
     // OPENING, MANIPULATING FILES
     
-    public PrintStream getOutputStream(int fd) {
-        if(fd == CONST_STDOUT) {
-            return System.out;
+    public Writer getWriter(int fd) {
+        if (fd == CONST_STDOUT) {
+            return stdoutWriter;
         } else if (fd == CONST_STDERR) {
-            return System.err;
+            return stderrWriter;
+        } else {
+            FileHandle file = openFiles.get(fd);
+            if (file.writer == null) {
+                assert file.outputStream == null;
+                try {
+                    file.file.setLength(0); // Clear written-to file contents
+                } catch (IOException e) {
+                    // Be forgiving: if this results in an exception, so will writing to it
+                }
+                file.writer = new BufferedWriter(Channels.newWriter(file.file.getChannel(), FILE_ENCODING));
+            }
+            return file.writer;
         }
-        return outStreams.get(fd);
     }
+    
+    public OutputStream getOutputStream(int fd) {
+        if (fd == CONST_STDOUT) {
+            return stdout;
+        } else if (fd == CONST_STDERR) {
+            return stderr;
+        } else {
+            FileHandle file = openFiles.get(fd);
+            if (file.outputStream == null) {
+                assert file.writer == null;
+                try {
+                    file.file.setLength(0); // Clear written-to file contents
+                } catch (IOException e) {
+                    // Be forgiving: if this results in an exception, so will writing to it
+                }
+                file.outputStream = new RandomAccessOutputStream(file.file);
+            }
+            return file.outputStream;
+        }
+    }
 
     public boolean closeRandomAccessFile(int fd) throws InterpreterException {
         if (fd == CONST_STDOUT || fd == CONST_STDERR || fd == CONST_STDIN)
             return true;
         
-        OutputStream stream = outStreams.get(fd);
-        if(stream == null)
+        FileHandle file = openFiles.remove(fd);
+        if(file == null)
             return true; // already closed: be forgiving
         try {
-            stream.close();
+            if (file.writer != null) file.writer.close();
+            if (file.outputStream != null) file.outputStream.close();
+            file.file.close();
         } catch (IOException e) {
             // Ignored
         }
-        inStreams.remove(fd);
-        outStreams.remove(fd);
         return true;
     }
     
     public void closeAllFiles() {
-        Iterator<Integer> fds = outStreams.keySet().iterator();
-        while (fds.hasNext()) {
-            int fd = fds.next();
-            OutputStream stream = outStreams.get(fd);
+        for (FileHandle file : openFiles.values()) {
             try {
-                stream.close();
+                if (file.writer != null) file.writer.close();
+                file.file.close();
             } catch (IOException e) {
                 // Ignored
             }
-            inStreams.remove(fd);
-            fds.remove();
         }
+        openFiles.clear();
     }
 
     public int openRandomAccessFile(String fn, String mode) throws FileNotFoundException, IOException {
-        String m = mode.indexOf('w') >= 0 ? "rw" : "r";
-        if (m.equals("rw")) {
+        boolean writeMode = mode.indexOf('w') >= 0;
+        
+        if (writeMode) {
             File file = new File(getAbsolutePath(getWorkingDir(), fn));
             if (!file.exists()) file.createNewFile();
         }
-        RandomAccessFile file = new RandomAccessFile(getAbsolutePath(getWorkingDir(), fn), m);
+        RandomAccessFile file = new RandomAccessFile(getAbsolutePath(getWorkingDir(), fn), writeMode ? "rw" : "r");
+        openFiles.put(fileCounter, new FileHandle(file));
         
-        inStreams.put(fileCounter, new BufferedInputStream(new RandomAccessInputStream(file)));
-        outStreams.put(fileCounter, new PrintStream(new BufferedOutputStream(new RandomAccessOutputStream(file))));
-        
-        if (m.equals("rw")) file.setLength(0); // HACK: clear written-to file contents
-        
         return fileCounter++;
     }
 
     public InputStream getInputStream(int fd) {
-        return fd == CONST_STDIN ? System.in : inStreams.get(fd);
+        if (fd == CONST_STDIN) {
+            return stdin;
+        } else {
+            FileHandle file = openFiles.get(fd);
+            if (file.inputStream == null)
+                file.inputStream = new RandomAccessInputStream(file.file);
+            return file.inputStream;
+        }
     }
     
+    public Reader getReader(int fd) {
+        if (fd == CONST_STDIN)
+            return stdinReader;
+        FileHandle file = openFiles.get(fd);
+        if (file.reader == null)
+            file.reader = new BufferedReader(Channels.newReader(file.file.getChannel(), FILE_ENCODING));
+        return file.reader;
+    }
+    
+    public String readString(int fd) throws IOException {
+        if (fd == CONST_STDIN) {
+            char[] buffer = new char[2048];
+            StringBuilder result = new StringBuilder();
+            Reader reader = getReader(fd);
+            for (int read = 0; read != -1; read = reader.read(buffer))
+                result.append(buffer, 0, read);
+            return result.toString();
+        } else {
+            FileHandle file = openFiles.get(fd);
+            FileChannel channel = file.file.getChannel();
+            MappedByteBuffer buffer = channel.map(MapMode.READ_ONLY, 0, channel.size());
+            return FILE_CHARSET.decode(buffer).toString();
+        }
+    }
+    
     /**
      * Opens an input stream given a file path.
      * 
@@ -181,6 +260,14 @@
         return openInputStream(fn, false);
     }
     
+    public void printError(String error) {
+        try {
+            getWriter(CONST_STDERR).write(error + "\n");
+        } catch (IOException e) {
+            // Like System.err.println, we swallow excpetions
+        }
+    }
+    
     public OutputStream openFileOutputStream(String fn) throws FileNotFoundException {
         return new FileOutputStream(getAbsolutePath(getWorkingDir(), fn));
     }
@@ -211,4 +298,59 @@
     public boolean mkDirs(String fn) {
         return openFile(fn).mkdirs();
     }
+    
+    /**
+     * An open file handle.
+     * 
+     * @author Lennart Kats <lennart add lclnet.nl>
+     */
+    private static class FileHandle {
+        final RandomAccessFile file;
+        Reader reader;
+        Writer writer;
+        InputStream inputStream;
+        OutputStream outputStream;
+        
+        FileHandle(RandomAccessFile file) {
+            this.file = file;
+        }
+    }
+    
+    /**
+     * A class for writing to a PrintStream.
+     * 
+     * @author Lennart Kats <lennart add lclnet.nl>
+     */
+    private static class PrintStreamWriter extends Writer {
+        
+        private final PrintStream stream;
+        
+        PrintStreamWriter(PrintStream stream) {
+            this.stream = stream;
+        }
+
+        @Override
+        public void close() throws IOException {
+            stream.close();
+        }
+
+        @Override
+        public void flush() throws IOException {
+            stream.flush();
+        }
+
+        @Override
+        public void write(char[] cbuf, int off, int len) throws IOException {
+            if (off == 0 && len == cbuf.length)
+                stream.print(cbuf);
+            else
+                stream.append(CharBuffer.wrap(cbuf, off, len));
+        }
+        
+        @Override
+        public void write(String str, int off, int len) throws IOException {
+            stream.append(str, off, len);
+        }
+        
+    }
 }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/LoggingIOAgent.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/LoggingIOAgent.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/LoggingIOAgent.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -3,7 +3,8 @@
 import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.OutputStream;
-import java.io.PrintStream;
+import java.io.OutputStreamWriter;
+import java.io.Writer;
 
 /**
  * An IO Agent class that logs all console output.
@@ -12,14 +13,10 @@
  */
 public class LoggingIOAgent extends IOAgent {
     
-    private final LoggingOutputStream stdoutLog = new LoggingOutputStream(System.out);
+    private final Writer stdout = new OutputStreamWriter(new LoggingOutputStream(System.out));
     
-    private final LoggingOutputStream stderrLog = new LoggingOutputStream(System.err);
+    private final Writer stderr = new OutputStreamWriter(new LoggingOutputStream(System.err));
     
-    private final PrintStream stdout = new PrintStream(stdoutLog, true);
-    
-    private final PrintStream stderr = new PrintStream(stderrLog, true);
-    
     final ByteArrayOutputStream bytes = new ByteArrayOutputStream();
     
     public String getLog() {
@@ -31,21 +28,19 @@
     }
     
     @Override
-    public PrintStream getOutputStream(int fd) {
+    public Writer getWriter(int fd) {
         switch (fd) {
             case CONST_STDOUT:
-                stderrLog.stream = System.out; // might have changed
                 return stdout;
             case CONST_STDERR:
-                stderrLog.stream = System.err; // might have changed
                 return stderr;
             default:
-                return super.getOutputStream(fd);
+                return super.getWriter(fd);
         }
     }
     
     private class LoggingOutputStream extends OutputStream {
-        OutputStream stream;
+        private final OutputStream stream;
         
         public LoggingOutputStream(OutputStream stream) {
             this.stream = stream;

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_copy.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_copy.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_copy.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -7,12 +7,15 @@
  */
 package org.spoofax.interpreter.library.ssl;
 
-import static org.spoofax.interpreter.core.Tools.*;
+import static org.spoofax.interpreter.core.Tools.isTermString;
 
 import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.nio.channels.FileChannel;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -39,48 +42,53 @@
         if (isSameFile(tvars, agent))
             return true;
         
-        InputStream fis = null;
-        OutputStream fos = null;
+        InputStream in = null;
+        OutputStream out = null;
         
         boolean closeIn = true;
         boolean closeOut = true;
 
         try {
             if (Tools.isTermString(tvars[0])) {
-                fis = agent.openInputStream(Tools.javaString(tvars[0]));
+                in = agent.openInputStream(Tools.javaString(tvars[0]));
             } else if (Tools.isTermAppl(tvars[0]) && Tools.hasConstructor((IStrategoAppl) tvars[0], "stdin")) {
-                fis = agent.getInputStream(IOAgent.CONST_STDIN);
+                in = agent.getInputStream(IOAgent.CONST_STDIN);
                 closeIn = false;
             } else {
                 return false;
             }
             
             if (Tools.isTermString(tvars[1])) {
-                fos =  agent.openFileOutputStream(Tools.javaString(tvars[1]));
+                out = agent.openFileOutputStream(Tools.javaString(tvars[1]));
             } else if (Tools.isTermAppl(tvars[1]) && Tools.hasConstructor((IStrategoAppl) tvars[1], "stdout")) {
-                fos =  agent.getOutputStream(IOAgent.CONST_STDOUT);
+                out = agent.getOutputStream(IOAgent.CONST_STDOUT);
                 closeOut = false;
             } else if (Tools.isTermAppl(tvars[1]) && Tools.hasConstructor((IStrategoAppl) tvars[1], "stderr")) {
-                fos =  agent.getOutputStream(IOAgent.CONST_STDERR);
+                out = agent.getOutputStream(IOAgent.CONST_STDERR);
                 closeOut = false;
             } else {
                 return false;
             }
+            
+            if (in instanceof FileInputStream && out instanceof FileOutputStream) {
+                FileChannel inChannel = ((FileInputStream) in).getChannel();
+                inChannel.transferTo(0, inChannel.size(), ((FileOutputStream) out).getChannel());
+            } else {
+                // TODO: Optimize - use the fancy new Java API for copying files
+                byte[] bs = new byte[1024];
+                int read;
+            
+                read = in.read(bs, 0, 1024);
+                while(read != -1) {
+                    out.write(bs,0, read);
+                    read = in.read(bs, 0, 1024);
+                }
     
-            // TODO: Optimize - use the fancy new Java API for copying files
-            byte[] bs = new byte[1024];
-            int read;
-        
-            read = fis.read(bs, 0, 1024);
-            while(read != -1) {
-                fos.write(bs,0, read);
-                read = fis.read(bs, 0, 1024);
+                if (closeOut) out.close();
+                if (closeIn) in.close();
             }
-
-            if (closeOut) fos.close();
-            if (closeIn) fis.close();
         } catch (IOException e) {
-            agent.getOutputStream(IOAgent.CONST_STDERR).println("SSL_copy: Could not copy file (" + e.getMessage() + "-" + "attempted to copy to " + tvars[1]);
+            agent.printError("SSL_copy: Could not copy file (" + e.getMessage() + "-" + "attempted to copy to " + tvars[1]);
             return false;
         }
         

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fflush.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fflush.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fflush.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -31,11 +31,11 @@
             return false;
         
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
-        OutputStream stream = or.getIOAgent().getOutputStream(Tools.asJavaInt(tvars[0]));
-        if (stream == null) return false;
+        Writer writer = or.getIOAgent().getWriter(Tools.asJavaInt(tvars[0]));
+        if (writer == null) return false;
         
         try {
-            stream.flush();
+            writer.flush();
             return true;
         } catch (IOException e) {
             return false;

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fgetc.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fgetc.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fgetc.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.InputStream;
+import java.io.Reader;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -30,12 +30,12 @@
             return false;
         
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
-        InputStream is = or.getIOAgent().getInputStream(Tools.asJavaInt(tvars[0]));
+        Reader in = or.getIOAgent().getReader(Tools.asJavaInt(tvars[0]));
 
         int r = -1;
         
         try {
-            r = is.read();
+            r = in.read();
         } catch(IOException e) {
             throw new InterpreterException(e);
         }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputc.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputc.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputc.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -33,7 +33,7 @@
 
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         
-        OutputStream s = or.getIOAgent().getOutputStream(Tools.asJavaInt(targs[1]));
+        Writer s = or.getIOAgent().getWriter(Tools.asJavaInt(targs[1]));
         
         try {
             s.write(((IStrategoInt)targs[0]).intValue());

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputs.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputs.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_fputs.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -7,7 +7,8 @@
  */
 package org.spoofax.interpreter.library.ssl;
 
-import java.io.PrintStream;
+import java.io.IOException;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -32,11 +33,13 @@
 
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         
-        // TODO: Don't use a printstream because of its quiet failing behavior and overhead
-        //       (use BufferedOutputStreamWriter instead?)
-        PrintStream ous = or.getIOAgent().getOutputStream(Tools.asJavaInt(targs[1]));
-        ous.print(Tools.javaString(targs[0]));
-        // if (ous.checkError()) return false; // UNDONE: quietly flushes the stream!
+        try {
+            Writer out = or.getIOAgent().getWriter(Tools.asJavaInt(targs[1]));
+            out.write(Tools.javaString(targs[0]));
+        } catch (IOException e) {
+            or.getIOAgent().printError("SSL_fputs: could not put string (" + e.getMessage() + ")");
+            return false;
+        }
         
         env.setCurrent(targs[1]);
         

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_printnl.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_printnl.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_printnl.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -7,7 +7,8 @@
  */
 package org.spoofax.interpreter.library.ssl;
 
-import java.io.PrintStream;
+import java.io.IOException;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -52,20 +53,23 @@
             t.prettyPrint(p);
             sb.append(p.getString());
         }
+        sb.append("\n");
 
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         IOAgent agent = or.getIOAgent();
         
-        if(output.equals("stderr")) {
-            PrintStream stream = agent.getOutputStream(IOAgent.CONST_STDERR);
-            stream.println(sb);
-            // if (stream.checkError()) return false;  // UNDONE: quietly flushes the stream!
-        } else if(output.equals("stdout")) {
-            PrintStream stream = agent.getOutputStream(IOAgent.CONST_STDOUT);
-            stream.println(sb);
-            if (stream.checkError()) return false;
-        } else {
-            throw new InterpreterException("Unknown output : " + output);
+        try {
+            if(output.equals("stderr")) {
+                Writer out = agent.getWriter(IOAgent.CONST_STDERR);
+                out.write(sb.toString());
+            } else if(output.equals("stdout")) {
+                Writer out = agent.getWriter(IOAgent.CONST_STDOUT);
+                out.write(sb.toString());
+            } else {
+                throw new InterpreterException("Unknown output : " + output);
+            }
+        } catch (IOException e) {
+            or.getIOAgent().printError("SSL_println: could not print line (" + e.getMessage() + ")");
         }
         
         return true;

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_stream.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_stream.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_stream.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -14,7 +14,6 @@
 import org.spoofax.interpreter.core.InterpreterException;
 import org.spoofax.interpreter.core.Tools;
 import org.spoofax.interpreter.library.AbstractPrimitive;
-import org.spoofax.interpreter.library.IOAgent;
 import org.spoofax.interpreter.stratego.Strategy;
 import org.spoofax.interpreter.terms.IStrategoTerm;
 
@@ -31,6 +30,7 @@
         if(!Tools.isTermInt(tvars[0]))
             return false;
         
+        // TODO: optimize - use memory-mapped I/O for reading terms?
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         InputStream is = or.getIOAgent().getInputStream(Tools.asJavaInt(tvars[0]));
         if(is == null)
@@ -39,7 +39,7 @@
         try {
             env.setCurrent(env.getFactory().parseFromStream(is));
         } catch(IOException e) {
-            or.getIOAgent().getOutputStream(IOAgent.CONST_STDERR).println("SSL_read_term_from_stream: " + e.getMessage());
+            or.getIOAgent().printError("SSL_read_term_from_stream: " + e.getMessage());
             return false;
         }
         return true;

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_string.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_string.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_read_term_from_string.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -11,7 +11,6 @@
 import org.spoofax.interpreter.core.InterpreterException;
 import org.spoofax.interpreter.core.Tools;
 import org.spoofax.interpreter.library.AbstractPrimitive;
-import org.spoofax.interpreter.library.IOAgent;
 import org.spoofax.interpreter.stratego.Strategy;
 import org.spoofax.interpreter.terms.IStrategoTerm;
 import org.spoofax.interpreter.terms.ParseError;
@@ -20,7 +19,7 @@
     
     private static final String NAME = "SSL_read_term_from_string";
 
-    SSL_read_term_from_string() {
+    public SSL_read_term_from_string() {
         super(NAME, 0, 1);
     }
     
@@ -35,7 +34,7 @@
             IStrategoTerm t = env.getFactory().parseFromString(Tools.javaString(tvars[0]));
             env.setCurrent(t);
         } catch (ParseError e) {
-            SSLLibrary.instance(env).getIOAgent().getOutputStream(IOAgent.CONST_STDERR).println(NAME + ": " + e.getMessage());
+            SSLLibrary.instance(env).getIOAgent().printError(NAME + ": " + e.getMessage());
             return false;
         }
         return true;

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_baf.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_baf.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_baf.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -33,12 +33,12 @@
             return false;
         
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
-        OutputStream os = or.getIOAgent().getOutputStream(Tools.asJavaInt(tvars[0]));
-        if(os == null)
+        Writer out = or.getIOAgent().getWriter(Tools.asJavaInt(tvars[0]));
+        if(out == null)
             return false;
         
         try {
-            env.getFactory().unparseToFile(tvars[1], os);
+            env.getFactory().unparseToFile(tvars[1], out);
         } catch(IOException e) {
             throw new InterpreterException(e);
         }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_saf.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_saf.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_saf.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -33,12 +33,12 @@
             return false;
         
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
-        OutputStream os = or.getIOAgent().getOutputStream(Tools.asJavaInt(tvars[0]));
-        if(os == null)
+        Writer out = or.getIOAgent().getWriter(Tools.asJavaInt(tvars[0]));
+        if(out == null)
             return false;
         
         try {
-            env.getFactory().unparseToFile(tvars[1], os);
+            env.getFactory().unparseToFile(tvars[1], out);
         } catch(IOException e) {
             throw new InterpreterException(e);
         }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_taf.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_taf.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_taf.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -31,12 +31,12 @@
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         int fd = Tools.asJavaInt(targs[0]);
        
-        OutputStream os = or.getIOAgent().getOutputStream(fd);
-        if(os == null)
+        Writer out = or.getIOAgent().getWriter(fd);
+        if(out == null)
             return false;
         
         try {
-            env.getFactory().unparseToFile(targs[1], os);
+            env.getFactory().unparseToFile(targs[1], out);
         } catch(IOException e) {
             throw new InterpreterException(e);
         }

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_text.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_text.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/library/ssl/SSL_write_term_to_stream_text.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -8,7 +8,7 @@
 package org.spoofax.interpreter.library.ssl;
 
 import java.io.IOException;
-import java.io.OutputStream;
+import java.io.Writer;
 
 import org.spoofax.interpreter.core.IContext;
 import org.spoofax.interpreter.core.InterpreterException;
@@ -31,7 +31,7 @@
         SSLLibrary or = (SSLLibrary) env.getOperatorRegistry(SSLLibrary.REGISTRY_NAME);
         int fd = Tools.asJavaInt(targs[0]);
         
-        OutputStream os = or.getIOAgent().getOutputStream(fd);
+        Writer os = or.getIOAgent().getWriter(fd);
         if(os == null)
             return false;
         

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/GuardedLChoice.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/GuardedLChoice.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/GuardedLChoice.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -33,7 +33,7 @@
         return eval(env, 0);
     }
 
-    private IConstruct eval(IContext env, final int n) throws InterpreterException {
+    IConstruct eval(IContext env, final int n) throws InterpreterException {
     	if (n == (children.length - 1)) {
     		Strategy s = children[n].first;
     		s.getHook().push(getHook().pop());

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/One.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/One.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/One.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -45,7 +45,7 @@
         }
     }
 
-    private IConstruct eval(IContext env, final int n, final IStrategoTerm[] list) throws InterpreterException
+    IConstruct eval(IContext env, final int n, final IStrategoTerm[] list) throws InterpreterException
     {
     	final IStrategoTerm old = env.current();
     	if (n >= old.getSubtermCount()) {

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/Some.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/Some.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/stratego/Some.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -45,7 +45,7 @@
         }
     }
 
-    private IConstruct eval(final IContext env, final int n, final boolean hadsome, final IStrategoTerm[] list) throws InterpreterException
+    IConstruct eval(final IContext env, final int n, final boolean hadsome, final IStrategoTerm[] list) throws InterpreterException
     {
     	final IStrategoTerm old = env.current();
     	if (n >= old.getSubtermCount()) {

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/BasicTermFactory.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/BasicTermFactory.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/BasicTermFactory.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -14,6 +14,7 @@
 import java.io.InputStream;
 import java.io.OutputStream;
 import java.io.PushbackInputStream;
+import java.io.Writer;
 import java.util.Collection;
 import java.util.Collections;
 import java.util.HashSet;
@@ -22,7 +23,6 @@
 import java.util.Map;
 import java.util.Set;
 import java.util.WeakHashMap;
-import java.util.concurrent.locks.ReadWriteLock;
 
 import org.spoofax.NotImplementedException;
 
@@ -299,6 +299,12 @@
         ous.write(tp.getString().getBytes());
     }
 
+    public void unparseToFile(IStrategoTerm t, Writer out) throws IOException {
+        ITermPrinter tp = new InlinePrinter();
+        t.prettyPrint(tp);
+        out.write(tp.getString());
+    }
+
     public boolean hasConstructor(String name, int arity) {
     	if (name.length() > MAX_POOLED_STRING_LENGTH)
             throw new UnsupportedOperationException("String too long to be pooled: " + name);

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/ITermFactory.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/ITermFactory.java	2010-02-05 09:57:26 UTC (rev 20584)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/terms/ITermFactory.java	2010-02-08 09:24:51 UTC (rev 20585)
@@ -10,6 +10,7 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.io.Writer;
 
 
 
@@ -19,6 +20,7 @@
     public IStrategoTerm parseFromStream(InputStream inputStream) throws IOException;
     public IStrategoTerm parseFromString(String text);
     public void unparseToFile(IStrategoTerm t, OutputStream ous) throws IOException;

(632 diff lines omitted)


From L.C.L.Kats at tudelft.nl  Mon Feb  8 14:16:33 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 13:16:33 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20586 - LennartKats -
	strc-java/trunk/java/runtime/org/strategoxt/lang
Message-ID: <201002081316.o18DGXWJ015310@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 13:16:33 +0000 (Mon, 08 Feb 2010)
New Revision: 20586

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20586&view=rev

Modified:
   strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java

Log:
Added a workaround that hopefully fixes Sander's crashes when reading imported terms from jar files.

Changes:

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java	2010-02-08 09:24:51 UTC (rev 20585)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java	2010-02-08 13:16:33 UTC (rev 20586)
@@ -1,5 +1,11 @@
 package org.strategoxt.lang;
 
+import java.io.File;
+import java.io.InputStream;
+import java.net.URL;
+import java.util.zip.ZipEntry;
+import java.util.zip.ZipFile;
+
 import org.spoofax.interpreter.terms.IStrategoTerm;
 import org.spoofax.interpreter.terms.ITermFactory;
 
@@ -46,14 +52,8 @@
 	
 	@Override
 	protected IStrategoTerm init() {
-		java.io.InputStream stream = container.getResourceAsStream(path + name);
-		if (stream == null)
-			stream = container.getResourceAsStream("/" + name);
-		if (stream == null)
-			throw new StrategoException(container.getSimpleName()
-					+ ": Could not find imported term file " + name);
 		try {
-			return factory.parseFromStream(stream);
+			return factory.parseFromStream(openStream());
 		} catch (java.io.IOException e) {
 			throw new StrategoException(container.getSimpleName()
 					+ ": Could not read imported term file " + name, e);
@@ -64,14 +64,8 @@
 	}
 	
 	private ATerm initATerm(ATermFactory factory) {
-		java.io.InputStream stream = container.getResourceAsStream(path + name);
-		if (stream == null)
-			stream = container.getResourceAsStream("/" + name);
-		if (stream == null)
-			throw new StrategoException(container.getSimpleName()
-					+ ": Could not find imported term file " + name);
 		try {
-			return factory.readFromFile(stream);
+			return factory.readFromFile(openStream());
 		} catch (java.io.IOException e) {
 			throw new StrategoException(container.getSimpleName()
 					+ ": Could not read imported term file " + name, e);
@@ -80,4 +74,38 @@
 					+ ": Could not read imported term file " + name, e);
 		}
 	}
+
+	private InputStream openStream() {
+		InputStream result = tryOpenStreamFromJar();
+		if (result == null)
+			result = container.getResourceAsStream(path + name);
+		if (result == null)
+			result = container.getResourceAsStream("/" + name);
+		if (result == null)
+			throw new StrategoException(container.getSimpleName()
+					+ ": Could not find imported term file " + name);
+		return result;
+	}
+
+	/**
+	 * Attempt to open resources in JARs using the Java ZipFile API,
+	 * hopefully avoiding JVM classloader failures.
+	 */
+	private InputStream tryOpenStreamFromJar() {
+		try {
+			URL location = container.getProtectionDomain().getCodeSource().getLocation();
+			if (location.getFile().endsWith(".jar")) {
+				File jarFile = new File(location.toURI());
+				ZipFile jar = new ZipFile(jarFile);
+				ZipEntry entry = jar.getEntry(path + name);
+				if (entry == null) entry = jar.getEntry("/" + name);
+				if (entry == null) return null;
+				return jar.getInputStream(entry);
+			} else {
+				return null;
+			}
+		} catch (Exception e) {
+			return null; // be forgiving
+		}
+	}
 }



From L.C.L.Kats at tudelft.nl  Mon Feb  8 17:50:29 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 16:50:29 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20587 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.feature
	org.strategoxt.imp.updatesite
Message-ID: <201002081650.o18GoTQd016060@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 16:50:28 +0000 (Mon, 08 Feb 2010)
New Revision: 20587

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20587&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.updatesite/how-not-to.txt

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-08 13:16:33 UTC (rev 20586)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-08 16:50:28 UTC (rev 20587)
@@ -28,6 +28,10 @@
       <update label="Spoofax/IMP updates" url="http://www.lclnet.nl/update/"/>
    </url>
 
+   <includes
+         id="org.eclipse.pde"
+         version="0.0.0"/>
+
    <plugin
          id="org.strategoxt.imp.metatooling"
          download-size="0"
@@ -223,7 +227,7 @@
          id="org.eclipse.imp.xform"
          download-size="0"
          install-size="0"
-         version="0.1.91"
+         version="0.1.91.qualifier"
          unpack="false"/>
 
 </feature>

Modified: spoofax-imp/trunk/org.strategoxt.imp.updatesite/how-not-to.txt
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.updatesite/how-not-to.txt	2010-02-08 13:16:33 UTC (rev 20586)
+++ spoofax-imp/trunk/org.strategoxt.imp.updatesite/how-not-to.txt	2010-02-08 16:50:28 UTC (rev 20587)
@@ -2,15 +2,15 @@
 
 1.  DON'T strictly follow these steps; failure to do so at any point will result in various forms of fun unexplained or misleading failures at or after deployment time
 2.  DON'T update the versions of all involved plugins and the org.strategoxt.imp.feature project
-4.  DON'T specify the "unpack" attribute in feature.xml; let Eclipse surprise you instead (the little checkbox won't tell you what happens)
-5.  DON'T delete the content.jar and artifacts.jar after cleaning up the update dir.
+3.  DON'T specify the "unpack" attribute in feature.xml; let Eclipse surprise you instead (the little checkbox won't tell you what happens)
+4.  DON'T delete the content.jar and artifacts.jar after cleaning up the update dir
+5.  DON'T open feature.xml in Eclipse and set all versions to those in the projects using the "Versions" button
 6.  There is no number 6
-7.  DON'T open feature.xml in Eclipse and set all versions to those in the projects using the "Versions" button
-8.  DON'T open site.xml in Eclipse and choose "Add Feature" and add the new feature (be sure you DON'T put it in the category so it won't show up)
-9.  Or DON'T pick "Synchronize all" if you made an update site already
-10. DON'T choose "Build All"; if you pick "Build" it will act like its building but won't build all plugins
-11. Especially DON'T invoke your favorite deity through prayer and/or song at this point
-12. If you're using a testing directory for updates, be sure you DON'T adapt site.xml with the new url
-13. Finally, to test it, DON'T use a clean Eclipse installation and DON'T use a clean workspace (Eclipse 3.4+ may do workspace-based caching!)
-14. ???
-15. Profit
\ No newline at end of file
+7.  DON'T open site.xml in Eclipse and choose "Add Feature" and add the new feature (be sure you DON'T put it in the category so it won't show up)
+8.  Or DON'T pick "Synchronize all" if you made an update site already
+9.  DON'T choose "Build All"; if you pick "Build" it will act like its building but won't build all plugins
+10. Especially DON'T invoke your favorite deity through prayer and/or song at this point
+11. If you're using a testing directory for updates, be sure you DON'T adapt site.xml with the new url
+12. Finally, to test it, DON'T use a clean Eclipse installation and DON'T use a clean workspace (Eclipse 3.4+ may do workspace-based caching!)
+13. ???
+14. Profit



From L.C.L.Kats at tudelft.nl  Mon Feb  8 17:51:07 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 16:51:07 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20588 - LennartKats - in
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime:
	parser services
Message-ID: <201002081651.o18Gp73c016175@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 16:51:06 +0000 (Mon, 08 Feb 2010)
New Revision: 20588

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20588&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java

Log:
Exception handling fixes.

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java	2010-02-08 16:50:28 UTC (rev 20587)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java	2010-02-08 16:51:06 UTC (rev 20588)
@@ -229,8 +229,7 @@
 			Debug.startTimer();
 			
 			if (monitor.isCanceled()) return null;
-			ATerm asfix;
-			asfix = parseNoImplode(inputChars, filename);
+			ATerm asfix = parseNoImplode(inputChars, filename);
 			if (monitor.isCanceled()) return null;
 			RootAstNode ast = parser.internalImplode(asfix);
 
@@ -293,9 +292,10 @@
 				// try again without the standard start symbol
 				parser.setStartSymbol(null);
 				return parser.parseNoImplode(inputChars, filename);
+			} else {
+				throw new SGLRException(e.getParser(), e.getMessage(), e);
 			}
 		}
-		return null;
 	}
 
 	private void processMetaFile() {

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java	2010-02-08 16:50:28 UTC (rev 20587)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java	2010-02-08 16:51:06 UTC (rev 20588)
@@ -530,11 +530,11 @@
 			Environment.logException("Internal error evaluating strategy " + function, e);
 			if (descriptor.isDynamicallyLoaded()) StrategoConsole.activateConsole();
 		} catch (RuntimeException e) {
-			runtime.getIOAgent().printError("Internal error evaluating " + function + " (see error log)");
+			if (runtime != null) runtime.getIOAgent().printError("Internal error evaluating " + function + " (see error log)");
 			Environment.logException("Internal error evaluating strategy " + function, e);
 			if (descriptor.isDynamicallyLoaded()) StrategoConsole.activateConsole();
 		} catch (Error e) { // e.g. NoClassDefFoundError due to bad/missing stratego jar
-			runtime.getIOAgent().printError("Internal error evaluating " + function + " (see error log)");
+			if (runtime != null) runtime.getIOAgent().printError("Internal error evaluating " + function + " (see error log)");
 			Environment.logException("Internal error evaluating strategy " + function, e);
 			if (descriptor.isDynamicallyLoaded()) StrategoConsole.activateConsole();
 		}



From L.C.L.Kats at tudelft.nl  Mon Feb  8 17:51:51 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 16:51:51 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20589 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/util
Message-ID: <201002081651.o18GppLr016307@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 16:51:51 +0000 (Mon, 08 Feb 2010)
New Revision: 20589

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20589&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/util/output.str

Log:
Store .packed.esv files as ATerms.

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/util/output.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/util/output.str	2010-02-08 16:51:06 UTC (rev 20588)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/util/output.str	2010-02-08 16:51:51 UTC (rev 20589)
@@ -86,7 +86,7 @@
       fullpath := <conc-strings> (path, "/", filename)
     );
     
-    pp-descriptor-to-string;
+    write-to-string; // pp-descriptor-to-string;
     print-filename(|[path], filename);
     output-text-file'(|[path], filename)
   



From L.C.L.Kats at tudelft.nl  Mon Feb  8 18:03:58 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 17:03:58 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20590 - LennartKats -
	in spoofax-imp/trunk: . org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aster/.externalToolBuilders
	org.strategoxt.imp.editors.aster/META-INF
	org.strategoxt.imp.editors.aster/editor
	org.strategoxt.imp.editors.aster/editor/java
	org.strategoxt.imp.editors.aster/editor/java/org
	org.strategoxt.imp.editors.aster/editor/java/org/strategoxt
	org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp
	org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors
	org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster
	org.strategoxt.imp.editors.aster/syntax
	org.strategoxt.imp.editors.aster/test
	org.strategoxt.imp.editors.aster/trans
	org.strategoxt.imp.editors.stratego/editor
	org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building
Message-ID: <201002081703.o18H3wH7018578@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 17:03:58 +0000 (Mon, 08 Feb 2010)
New Revision: 20590

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20590&view=rev

Added:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.classpath
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.externalToolBuilders/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.externalToolBuilders/Stratego-Attributes build.main.xml.launch
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.project
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.properties
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Builders.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Colorer.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Folding.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Outliner.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Syntax.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes.main.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/Activator.java
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesParseController.java
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesValidator.java
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/plugin.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/Stratego-Attributes.def
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/test/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/test/example.astr
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/check.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/generate.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/stratego_attributes.str
Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/editor/Stratego-Sugar-References.esv
   spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building/DynamicDescriptorBuilder.java

Log:
Started working on an Aster plugin.

Changes (first 1000 lines of the diffs):

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.classpath
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.classpath	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.classpath	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,9 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+
+<classpath>
+	<classpathentry kind="src" path="editor/java"/>
+	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/J2SE-1.5"/>
+	<classpathentry kind="con" path="org.eclipse.pde.core.requiredPlugins"/>
+	<classpathentry kind="lib" path="utils/strategoxt.jar"/>
+	<classpathentry kind="output" path="bin"/>
+</classpath>
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.externalToolBuilders/Stratego-Attributes build.main.xml.launch
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.externalToolBuilders/Stratego-Attributes build.main.xml.launch	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.externalToolBuilders/Stratego-Attributes build.main.xml.launch	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,28 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<launchConfiguration type="org.eclipse.ant.AntLaunchConfigurationType">
+<stringAttribute key="bad_container_name" value=".externalToolBuilders"/>
+<booleanAttribute key="org.eclipse.ant.ui.DEFAULT_VM_INSTALL" value="false"/>
+<stringAttribute key="org.eclipse.debug.core.ATTR_REFRESH_SCOPE" value="${working_set:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;launchConfigurationWorkingSet editPageId=&quot;org.eclipse.ui.resourceWorkingSetPage&quot; factoryID=&quot;org.eclipse.ui.internal.WorkingSetFactory&quot; id=&quot;1260698330169_15&quot; label=&quot;working set&quot; name=&quot;working set&quot;&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Builders.generated.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Colorer.generated.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Folding.generat!
 ed.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Outliner.generated.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.generated.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Syntax.generated.esv&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/lib/editor-common.str&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/editor/java&quot; type=&quot;!
 2&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.mo
.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/build.generated.xml&quot; type=&quot;1&quot;/&gt;&#10;&lt;item factoryID=&quot;org.eclipse.ui.internal.model.ResourceFactory&quot; path=&quot;/org.strategoxt.imp.editors.aster/utils&quot; type=&quot;2&quot;/&gt;&#10;&lt;/launchConfigurationWorkingSet&gt;}"/>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_PATHS">
+<listEntry value="/org.strategoxt.imp.editors.aster/build.main.xml"/>
+</listAttribute>
+<listAttribute key="org.eclipse.debug.core.MAPPED_RESOURCE_TYPES">
+<listEntry value="1"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.debug.ui.ATTR_LAUNCH_IN_BACKGROUND" value="false"/>
+<listAttribute key="org.eclipse.jdt.launching.CLASSPATH">
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#10;&lt;runtimeClasspathEntry containerPath=&quot;org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/java-1.5.0-sun-1.5.0.18&quot; path=&quot;1&quot; type=&quot;4&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#10;&lt;runtimeClasspathEntry id=&quot;org.eclipse.ant.ui.classpathentry.antHome&quot;&gt;&#10;&lt;memento default=&quot;true&quot;/&gt;&#10;&lt;/runtimeClasspathEntry&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&#10;&lt;runtimeClasspathEntry id=&quot;org.eclipse.ant.ui.classpathentry.extraClasspathEntries&quot;&gt;&#10;&lt;memento/&gt;&#10;&lt;/runtimeClasspathEntry&gt;&#10;"/>
+</listAttribute>
+<stringAttribute key="org.eclipse.jdt.launching.CLASSPATH_PROVIDER" value="org.eclipse.ant.ui.AntClasspathProvider"/>
+<booleanAttribute key="org.eclipse.jdt.launching.DEFAULT_CLASSPATH" value="false"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="org.strategoxt.imp.editors.aster"/>
+<stringAttribute key="org.eclipse.jdt.launching.SOURCE_PATH_PROVIDER" value="org.eclipse.ant.ui.AntClasspathProvider"/>
+<stringAttribute key="org.eclipse.ui.externaltools.ATTR_ANT_TARGETS" value="all,"/>
+<stringAttribute key="org.eclipse.ui.externaltools.ATTR_LAUNCH_CONFIGURATION_BUILD_SCOPE" value="${project}"/>
+<stringAttribute key="org.eclipse.ui.externaltools.ATTR_LOCATION" value="${workspace_loc:/org.strategoxt.imp.editors.aster/build.main.xml}"/>
+<booleanAttribute key="org.eclipse.ui.externaltools.ATTR_TRIGGERS_CONFIGURED" value="true"/>
+<stringAttribute key="org.eclipse.ui.externaltools.ATTR_WORKING_DIRECTORY" value="${workspace_loc:/org.strategoxt.imp.editors.aster}"/>
+<stringAttribute key="process_factory_id" value="org.eclipse.ant.ui.remoteAntProcessFactory"/>
+</launchConfiguration>

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.project
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.project	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/.project	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+
+<projectDescription>
+      <name>org.strategoxt.imp.editors.aster</name>
+      <comment></comment>
+      <buildSpec>
+		<buildCommand>
+			<name>org.eclipse.ui.externaltools.ExternalToolBuilder</name>
+			<triggers>full,incremental,</triggers>
+			<arguments>
+				<dictionary>
+					<key>LaunchConfigHandle</key>
+					<value>&lt;project&gt;/.externalToolBuilders/Stratego-Attributes build.main.xml.launch</value>
+				</dictionary>
+			</arguments>
+		</buildCommand>
+        <buildCommand>
+          <name>org.eclipse.jdt.core.javabuilder</name>
+          <arguments>
+          </arguments>
+        </buildCommand>
+        <buildCommand>
+          <name>org.eclipse.pde.ManifestBuilder</name>
+          <arguments>
+          </arguments>
+        </buildCommand>
+        <buildCommand>
+          <name>org.eclipse.pde.SchemaBuilder</name>
+          <arguments>
+          </arguments>
+        </buildCommand>
+      </buildSpec>
+      <natures>
+        <nature>org.eclipse.pde.PluginNature</nature>
+        <nature>org.eclipse.jdt.core.javanature</nature>
+      </natures>
+    </projectDescription>
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,20 @@
+Manifest-Version: 1.0
+Bundle-ManifestVersion: 2
+Bundle-Name: StrategoAttributes Plug-in
+Bundle-SymbolicName: org.strategoxt.imp.editors.aster; singleton:=true
+Bundle-Version: 1.0.0
+Bundle-Activator: org.strategoxt.imp.editors.aster.Activator
+Import-Package: org.osgi.framework;version="1.3.0"
+Require-Bundle: org.eclipse.core.runtime,
+  org.eclipse.core.resources,
+  org.eclipse.imp.runtime,
+  org.eclipse.ui,
+  lpg.runtime,
+  org.eclipse.jface.text,
+  org.eclipse.ui.editors,
+  org.eclipse.ui.workbench.texteditor,
+  org.strategoxt.imp.runtime,
+  org.spoofax.aterm,
+  org.spoofax.jsglr
+Bundle-RequiredExecutionEnvironment: J2SE-1.5
+Export-Package: org.strategoxt.imp.editors.aster

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,280 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+
+<project name="build.generated">
+    
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+    
+        <!-- Initialization -->
+        <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
+        <dirname property="externaldefdir" file="${externaldef}"/>
+        <condition property="externaldefimport" value="-I ${externaldefdir}" else="">
+            <isset property="externaldef"/>
+        </condition>
+        <condition property="externaljarimport" value=":${externaljar}" else="">
+            <isset property="externaljar"/>
+        </condition>
+        <condition property="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter">
+            <isset property="eclipse.running"/>
+        </condition>
+        <condition property="externaljarflags" value="${externaljarflags}" else="">
+            <isset property="externaljarflags"/>
+        </condition>
+        <mkdir dir="${build}"/>
+        <mkdir dir="${src-gen}"/>
+        <mkdir dir="${dist}"/>
+        <mkdir dir="${include}"/>
+        <mkdir dir="${lib}"/>
+
+        <target name="sdf2imp" depends="sdf2table,sdf2imp.eclipse,sdf2imp.standalone"/>
+        
+        <target name="sdf2imp.eclipse" if="eclipse.running" depends="sdf2rtg">
+            <java classname="org.strategoxt.imp.metatooling.building.AntDescriptorBuilder">
+                <arg value="${include}/${esvmodule}.packed.esv"/>
+            </java>
+        </target>
+        
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+            <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
+            <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
+                <arg value="-i"/>
+                <arg value="${basedir}/editor/${esvmodule}.main.esv"/>
+                <arg value="-p"/>
+                <arg value="${include}/${sdfmodule}.tbl"/>
+            </java>
+        </target>
+    
+        <target name="sdf2table" depends="make-permissive">
+            <apply executable="${build.strategoxt.sdf}sdf2table" dest="${include}" failonerror="true">
+                <arg value="-i"/>
+                <srcfile/>
+                <arg value="-o"/>
+                <targetfile/>
+                <arg value="-m"/>
+                <arg value="${sdfmodule}"/>
+                
+                <fileset file="${include}/${sdfmodule}-Permissive.def"/>
+                <mapper type="glob" from="*-Permissive.def" to="*.tbl"/>
+            </apply>
+        </target>
+        
+        <target name="make-permissive" depends="pack-sdf,copy-sdf">
+            <dependset>
+                <srcfileset file="${include}/${sdfmodule}.def"/>
+                <targetfileset file="${include}/${sdfmodule}-Permissive.def"/>
+            </dependset>
+            <available file="${include}/${sdfmodule}-Permissive.def" property="permissive-grammar.available"/>
+            <antcall target="make-permissive.helper"/>
+        </target>
+    
+        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+            <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
+                <arg value="-i"/>
+                <arg value="${include}/${sdfmodule}.def"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}-Permissive.def"/>
+                <arg line="--optimize on"/>
+            </java>
+        </target>
+
+        <target name="utils-files">
+            <mkdir dir="utils"/>
+            <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
+        </target>
+    
+        <target name="pack-sdf" unless="externaldef">
+            <dependset>
+                <srcfileset dir="${syntax}">
+                    <include name="**/*.sdf"/>
+                </srcfileset>
+                <targetfileset file="${include}/${sdfmodule}.def"/>
+            </dependset>
+            <available file="${include}/${sdfmodule}.def" property="pack-sdf.available"/>
+            <antcall target="pack-sdf.helper"/>
+        </target>
+    
+        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+            <java classname="start" failonerror="true">
+                <arg value="org.strategoxt.tools.main-pack-sdf"/>
+                <arg value="-i"/>
+                <arg value="${syntax}/${sdfmodule}.sdf"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}.def"/>
+                <arg value="-I"/>
+                <arg value="${syntax}"/>
+                <arg value="-I"/>
+                <arg value="${lib}"/>
+                <arg line="${build.sdf.imports}"/>
+            </java>
+        </target>
+    
+        <target name="copy-sdf" if="externaldef">
+            <copy file="${externaldef}" tofile="${include}/${sdfmodule}.def" preservelastmodified="true"/>
+        </target>
+    
+        <target name="copy-jar" if="externaljar">
+            <copy file="${externaljar}" todir="${include}" preservelastmodified="true"/>
+        </target>
+    
+        <target name="rtg2sig" if="build.stratego.enabled" depends="sdf2rtg">
+            <dependset>
+                <srcfileset file="${include}/${sdfmodule}.rtg"/>
+                <targetfileset file="${include}/${sdfmodule}.str"/>
+            </dependset>
+            <available file="${include}/${sdfmodule}.str" property="rtg2sig.available"/>
+            <antcall target="rtg2sig.helper"/>
+        </target>
+    
+        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+            <java classname="start" failonerror="true">
+                <arg value="org.strategoxt.tools.main-rtg2sig"/>
+                <arg value="-i"/>
+                <arg value="${include}/${sdfmodule}.rtg"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}.str"/>
+                <arg value="--module"/>
+                <arg value="${sdfmodule}"/>
+            </java>
+        </target>
+        
+        <target name="sdf2rtg" depends="pack-sdf,copy-sdf">
+            <dependset>
+                <srcfileset file="${include}/${sdfmodule}.def"/>
+                <targetfileset file="${include}/${sdfmodule}.rtg"/>
+            </dependset>
+            <available file="${include}/${sdfmodule}.rtg" property="sdf2rtg.available"/>
+            <antcall target="sdf2rtg.helper"/>
+        </target>
+    
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+            <java classname="start" failonerror="true">
+                <arg value="org.strategoxt.tools.main-sdf2rtg"/>
+                <arg value="-i"/>
+                <arg value="${include}/${sdfmodule}.def"/>
+                <arg value="-m"/>
+                <arg value="${sdfmodule}"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}.rtg"/>
+                <arg value="--ignore-missing-cons"/>
+                <arg value="-Xnativepath"/>
+                <arg value="${build.strategoxt.sdf}"/>
+            </java>
+        </target>
+        
+        <target name="ppgen" if="build.stratego.enabled" depends="pack-sdf">
+            <dependset>
+                <srcfileset file="${include}/${sdfmodule}.def"/>
+                <targetfileset file="${include}/${sdfmodule}.pp"/>
+                <targetfileset file="${include}/${sdfmodule}.pp.af"/>
+            </dependset>
+            <available file="${include}/${sdfmodule}.pp" property="ppgen.available"/>
+            <antcall target="ppgen.helper"/>
+        </target>
+    
+        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+            <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
+            <java classname="start" failonerror="false">
+                <arg value="org.strategoxt.tools.main-ppgen"/>
+                <arg value="-i"/>
+                <arg value="${include}/${sdfmodule}.def"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}.pp.af"/>
+                <arg value="-t"/>
+            </java>
+            <java classname="start" failonerror="false">
+                <arg value="org.strategoxt.tools.pp-pp-table"/>
+                <arg value="-i"/>
+                <arg value="${include}/${sdfmodule}.pp.af"/>
+                <arg value="-o"/>
+                <arg value="${include}/${sdfmodule}.pp"/>
+            </java>
+        </target>
+    
+        <!-- Stratego to Java interpreter -->
+        <target name="stratego.ctree" depends="rtg2sig">
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.str"/>
+                </srcfileset>
+                <targetfileset file="${include}/${strmodule}.ctree"/>
+            </dependset>
+            <available file="${include}/${strmodule}.ctree" property="strc-java.available"/>
+            <antcall target="copy-jar"/>
+            <antcall target="stratego.jvm.helper">
+                <param name="build.stratego.outputpath" value="${include}"/>
+                <param name="build.stratego.extraargs" value="-F"/>
+                <param name="build.stratego.extension" value="ctree"/>
+                <param name="build.stratego.compiler" value="strc"/>
+            </antcall>
+        </target>
+    
+        <!-- Stratego to Java compiler -->
+        <target name="stratego.jar" depends="rtg2sig">
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.str"/>
+                </srcfileset>
+                <targetfileset file="${src-gen}/trans/Main.java"/>
+            </dependset>
+            <available file="${src-gen}/trans/Main.java" property="strc-java.available"/>
+            <antcall target="copy-jar"/>
+            <antcall target="stratego.jvm.helper">
+                <param name="build.stratego.outputpath" value="${src-gen}/trans"/>
+                <param name="build.stratego.extraargs" value="-la java-front"/>
+                <param name="build.stratego.extension" value="java"/>
+            </antcall>
+            <javac classpath="utils/strategoxt.jar:${src-gen}${externaljarimport}" srcdir="${src-gen}" includes="trans/**" destdir="${build}" source="1.5" target="1.5" debug="on"/>
+            <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
+        </target>
+            
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+            <java classname="org.strategoxt.strj.Main" failonerror="true">
+                <arg value="-i"/>
+                <arg value="${trans}/${strmodule}.str"/>
+                <arg value="-o"/>
+                <arg value="${build.stratego.outputpath}/${strmodule}.${build.stratego.extension}"/>
+                <arg value="-p"/>
+                <arg value="trans"/>
+                <arg value="--library"/>
+                <arg value="--clean"/>
+                <arg line="${build.stratego.args}"/>
+                <arg line="${build.stratego.extraargs}"/>
+                <arg line="${externaljarflags}"/>
+                <arg line="${externaldefimport}"/>
+            </java>
+            <delete file="${include}/${strmodule}.rtree" failonerror="false"/>
+            <mkdir dir="${build}/trans"/>
+        </target>
+                
+        <!-- Stratego to C-based native executable -->
+        <target name="stratego.c">
+            <antcall target="stratego.c.helper">
+                <param name="build.stratego.outputpath" value="${basedir}/include"/>
+                <param name="build.stratego.extraargs" value=""/>
+                <param name="build.stratego.extension" value=""/>
+                <param name="build.stratego.compiler" value="strc"/>
+            </antcall>
+        </target>
+        
+        <!-- Helper target for calling the stratego compiler -->
+        <target name="stratego.c.helper" depends="rtg2sig" if="build.stratego.enabled">
+            <apply executable="${build.strategoxt.stratego}/${build.stratego.compiler}" dest="${build.stratego.outputpath}" failonerror="true">
+                <arg value="-i"/>
+                <srcfile/>
+                <arg value="-o"/>
+                <targetfile/>
+                <arg line="${build.stratego.args}"/>
+                <arg line="${build.stratego.extraargs}"/>
+                <arg line="${externaldefimport}"/>
+                
+                <fileset file="${trans}/${strmodule}.str"/>
+                <mapper type="glob" from="*.str" to="*.${build.stratego.extension}"/>
+            </apply>
+        </target>
+        
+        <target name="clean" description="clean up">
+            <delete dir="${build}"/>
+            <delete file="${src-gen}/trans/Main.java"/>
+        </target>
+    </project>
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+
+<project name="Stratego-Attributes" default="all">
+        
+        <!-- Key input modules -->
+        <property name="sdfmodule" value="Stratego-Attributes"/>
+        <property name="esvmodule" value="Stratego-Attributes"/>
+        <property name="strmodule" value="stratego_attributes"/>
+    
+        <!-- Project directories -->
+        <property name="trans" location="trans"/>
+        <property name="src-gen" location="editor/java"/>
+        <property name="syntax" location="syntax"/>
+        <property name="include" location="include"/>
+        <property name="lib" location="lib"/>
+        <property name="build" location="bin"/>
+        <property name="dist" location="bin/dist"/>
+        
+        <!-- Imports -->
+        <property name="build.sdf.imports" value=""/>
+        <property name="build.stratego.args" value="--library
+                        -I &quot;${trans}&quot; -I &quot;${basedir}&quot;
+                        -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm"/>
+        
+        <property name="externaldef" location="syntax/${sdfmodule}.def"/>
+        <property name="externaljar" value="lib/aster.jar"/>
+        <property name="externaljarflags" value="-la org.strategoxt.aster"/>
+    
+        <!-- Environment configuration for command-line builds -->
+        <condition property="build.strategoxt.sdf" value="${eclipse.spoofaximp.nativeprefix}" else="">
+            <isset property="eclipse.spoofaximp.nativeprefix"/>
+        </condition>
+        <property name="build.strategoxt.stratego" location="${user.home}/.nix-profile/bin"/>
+    
+        <import file="build.generated.xml"/>
+    
+        <!-- Main target -->
+        <target name="all" depends="spoofaximp.default"/>
+    </project>
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.properties
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.properties	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.properties	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,8 @@
+source.. = editor/java/
+output.. = bin/
+bin.includes = META-INF/,\
+               .,\
+               plugin.xml,\
+               include/,\
+               bin/,\
+               .

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Builders.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Builders.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Builders.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,16 @@
+
+module Stratego-Attributes-Builders
+
+imports Stratego-Attributes-Builders.generated
+
+builders
+                                                                      
+  // This file can be used for custom analysis and builder rules.     
+  // See the imported file for a brief introduction and examples.     
+
+builders
+                                                                                                
+  provider : include/stratego_attributes.ctree                                                  
+  // observer : editor-analyze                                                                     
+  // builder  : "Generate Java code"              = generate-java (openeditor) (realtime)          
+  builder  : "Show ATerm"                      = generate-aterm (openeditor) (realtime) (meta)  
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Colorer.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Colorer.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Colorer.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,37 @@
+module Stratego-Attributes-Colorer
+
+imports Stratego-Attributes-Colorer.generated
+
+colorer Extension
+  
+  environment var:
+    0 128 64
+    255 255 255
+    italic
+    
+  // StrategyDef: 0 128 128 bold
+  // RuleDef:     0 128 128 bold
+  
+  // White background for variables and escapes
+  environment _.StringEscape1 : _ 255 255 255
+  environment _.StringEscape2 : _ 255 255 255
+  environment _.StringEscape3 : _ 255 255 255
+  environment _.StringEscape4 : _ 255 255 255
+  _.ListVar : _ 255 255 255
+  _.Var     : _ 255 255 255
+  _.Wld     : _ 255 255 255
+
+  _.StringEscape1 : gray  
+  _.StringEscape2 : gray  
+  _.StringEscape3 : gray  
+  _.StringEscape4 : gray
+  
+  _.Str     : blue
+  _.QStr    : blue
+  _.QDollar : blue
+  _.QBr     : gray
+
+  QuotedBracket1 : blue
+  QuotedBracket2 : blue
+  QuotedBracket3 : blue
+  QuotedBracket4 : blue
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Folding.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Folding.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Folding.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,8 @@
+module Stratego-Attributes-Folding
+
+imports Stratego-Attributes-Folding.generated
+
+folding
+  
+  // This file can be used for custom folding rules.
+  // See the imported file for a brief introduction and examples.
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Outliner.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Outliner.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Outliner.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,8 @@
+module Stratego-Attributes-Outliner
+
+imports Stratego-Attributes-Outliner.generated
+
+outliner
+  
+  // This file can be used for custom outliner rules.
+  // See the imported file for a brief introduction and examples.
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,19 @@
+module Stratego-Attributes-References
+
+imports Stratego-Attributes-References.generated
+
+references
+                                                                   
+  // This file can be used for custom reference resolving,         
+  // hover help, occurrence highlighting rules.                    
+  // See the imported file for a brief introduction and examples.  
+                                                                   
+
+references
+                        
+  completion proposer : editor-complete
+  completion lexical  : [a-zA-Z\_][a-zA-Z0-9\'\-\_]*[\*]
+  completion trigger  : "."
+                        
+  // reference _         : editor-resolve
+  // hover _             : editor-hover
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Syntax.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Syntax.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-Syntax.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,8 @@
+module Stratego-Attributes-Syntax
+
+imports Stratego-Attributes-Syntax.generated
+
+language
+                                                                   
+  // This file can be used for custom syntax rules.                
+  // See the imported file for a brief introduction and examples.  
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes.main.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes.main.esv	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes.main.esv	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,18 @@
+
+module Stratego-Attributes.main
+
+imports Stratego-Attributes-Builders Stratego-Attributes-Colorer Stratego-Attributes-Folding Stratego-Attributes-Outliner Stratego-Attributes-References Stratego-Attributes-Syntax
+
+language General properties
+                  
+  name          : Stratego-Attributes
+  id            : org.strategoxt.imp.editors.aster
+  extends       : Root
+                  
+  description   : "Spoofax/IMP-generated editor for the Stratego-Attributes language"
+  url           : http://strategoxt.org
+                  
+  extensions    : astr
+  table         : include/Stratego-Attributes.tbl
+  start symbols : Module
+  unmanaged table : Stratego-Attributes*
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/Activator.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/Activator.java	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/Activator.java	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,44 @@
+package org.strategoxt.imp.editors.aster;
+
+import org.eclipse.imp.preferences.PreferencesService;
+import org.eclipse.imp.runtime.PluginBase;
+import org.osgi.framework.BundleContext;
+
+public class Activator extends PluginBase 
+{ 
+  public static final String kPluginID = "StrategoAttributes";
+
+  public static final String kLanguageName = "StrategoAttributes";
+
+  protected static Activator sPlugin;
+
+  public static Activator getInstance()
+  { 
+    if(sPlugin == null)
+      return new Activator();
+    return sPlugin;
+  }
+
+  public Activator () 
+  { 
+    super();
+    sPlugin = this;
+  }
+
+  @Override public void start(BundleContext context) throws Exception
+  { 
+    super.start(context);
+  }
+
+  @Override public String getID()
+  { 
+    return kPluginID;
+  }
+
+  @Override public String getLanguageID()
+  { 
+    return kLanguageName;
+  }
+
+  protected static PreferencesService preferencesService = null;
+}
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesParseController.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesParseController.java	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesParseController.java	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,89 @@
+package org.strategoxt.imp.editors.aster;
+
+import java.io.InputStream;
+import java.io.IOException;
+import org.eclipse.imp.parser.IParseController;
+import org.strategoxt.imp.runtime.Environment;
+import org.strategoxt.imp.runtime.dynamicloading.BadDescriptorException;
+import org.strategoxt.imp.runtime.dynamicloading.Descriptor;
+import org.strategoxt.imp.runtime.dynamicloading.DescriptorFactory;
+import org.strategoxt.imp.runtime.dynamicloading.DynamicParseController;
+
+public class StrategoAttributesParseController extends DynamicParseController 
+{ 
+  public static final String LANGUAGE = new String("Stratego-Attributes");
+
+  private static final String TABLE = "/include/" + LANGUAGE + ".tbl";
+
+  private static final String DESCRIPTOR = "/include/" + LANGUAGE + ".packed.esv";
+
+  private static volatile Descriptor descriptor;
+
+  private static Throwable notLoadingCause;
+
+  public static synchronized Descriptor getDescriptor()
+  { 
+    if(notLoadingCause != null)
+      throw new RuntimeException(notLoadingCause);
+    if(descriptor == null)
+      createDescriptor();
+    return descriptor;
+  }
+
+  private static void createDescriptor()
+  { 
+    try
+    { 
+      InputStream descriptorStream = StrategoAttributesParseController.class.getResourceAsStream(DESCRIPTOR);
+      InputStream table = StrategoAttributesParseController.class.getResourceAsStream(TABLE);
+      if(descriptorStream == null)
+        throw new BadDescriptorException("Could not load descriptor file from " + DESCRIPTOR + " (not found in plugin: " + getPluginLocation() + ")");
+      if(table == null)
+        throw new BadDescriptorException("Could not load parse table from " + TABLE + " (not found in plugin: " + getPluginLocation() + ")");
+      descriptor = DescriptorFactory.load(descriptorStream, table, null);
+      descriptor.setAttachmentProvider(StrategoAttributesParseController.class);
+    }
+    catch(BadDescriptorException exc)
+    { 
+      notLoadingCause = exc;
+      Environment.logException("Bad descriptor for " + LANGUAGE + " plugin", exc);
+      throw new RuntimeException("Bad descriptor for " + LANGUAGE + " plugin", exc);
+    }
+    catch(IOException exc)
+    { 
+      notLoadingCause = exc;
+      Environment.logException("I/O problem loading descriptor for " + LANGUAGE + " plugin", exc);
+      throw new RuntimeException("I/O problem loading descriptor for " + LANGUAGE + " plugin", exc);
+    }
+  }
+
+  private static String getPluginLocation()
+  { 
+    return StrategoAttributesParseController.class.getProtectionDomain().getCodeSource().getLocation().getFile();
+  }
+
+  @Override public IParseController getWrapped()
+  { 
+    if(!isInitialized())
+    { 
+      if(notLoadingCause != null)
+        throw new RuntimeException(notLoadingCause);
+      try
+      { 
+        initialize(this, getDescriptor().getLanguage());
+      }
+      catch(BadDescriptorException exc)
+      { 
+        notLoadingCause = exc;
+        throw new RuntimeException(exc);
+      }
+    }
+    return super.getWrapped();
+  }
+
+  @Override protected void setNotLoadingCause(Throwable value)
+  { 
+    notLoadingCause = value;
+    super.setNotLoadingCause(value);
+  }
+}
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesValidator.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesValidator.java	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/java/org/strategoxt/imp/editors/aster/StrategoAttributesValidator.java	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,12 @@
+package org.strategoxt.imp.editors.aster;
+
+import org.strategoxt.imp.runtime.dynamicloading.Descriptor;
+import org.strategoxt.imp.runtime.services.MetaFileLanguageValidator;
+
+public class StrategoAttributesValidator extends MetaFileLanguageValidator 
+{ 
+  @Override public Descriptor getDescriptor()
+  { 
+    return StrategoAttributesParseController.getDescriptor();
+  }
+}
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/plugin.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/plugin.xml	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/plugin.xml	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,12 @@
+<?xml version="1.0" encoding="UTF-8" ?>
+<?eclipse version="3.0"?>
+
+<plugin>
+       <extension point="org.eclipse.imp.runtime.languageDescription">
+          <language extensions="astr" description="Stratego-Attributes" language="Stratego-Attributes" derivedFrom="DynamicRoot" validator="org.strategoxt.imp.editors.aster.StrategoAttributesValidator" validatorClass="org.strategoxt.imp.editors.aster.StrategoAttributesValidator"></language>
+       </extension>
+       <extension id="org.strategoxt.imp.editors.aster.parser" name="Stratego-Attributes Parser" point="org.eclipse.imp.runtime.parser">
+          <parser class="org.strategoxt.imp.editors.aster.StrategoAttributesParseController" language="Stratego-Attributes">
+          </parser>
+       </extension>    
+    </plugin>
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/Stratego-Attributes.def
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/Stratego-Attributes.def	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/Stratego-Attributes.def	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1 @@
+link /Users/lk/projects/StrategoXT/aster/trunk/syntax/Stratego-Attributes.def
\ No newline at end of file


Property changes on: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/syntax/Stratego-Attributes.def
___________________________________________________________________
Added: svn:special
   + *

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/test/example.astr
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/test/example.astr	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/test/example.astr	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,10 @@
+module example
+
+attributes
+
+  def foo:
+    Bar() -> Baz()
+  
+  def Bar():
+    id.baz  := Qux()
+    id.quux := Quuux()
\ No newline at end of file

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/check.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/check.str	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/check.str	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,49 @@
+module check
+
+imports
+  libstratego-lib
+  include/Stratego-Attributes
+  lib/editor-common
+
+rules
+
+  // Analysis: does a topdown traversal of the tree,
+  // and try to apply the record-entity rule.
+  analyze =
+    topdown(try(record-entity))
+
+  // Records the definition of an entity in a dynamic rule GetEntity.
+  record-entity:
+    Entity(x, body) -> Entity(x, body)
+    with
+      rules(
+        GetEntity :+ x -> x
+      )
+
+rules
+    
+  // Reports an error if a property type is undefined.
+  // This error is reported on the type name 'type'.
+  constraint-error:
+    Property(x, Type(type)) -> (type, $[Type [type] is not defined])
+    where
+      not(!type => "String"); // String and Int are built-in types
+      not(!type => "Int");
+      not(<GetEntity> type) // no entity for this type
+  
+  // Reports an error if an entity is defined more than once.
+  // This constraint is implemented by testing if the "bag" of
+  // all entities x is not a singleton list.
+  constraint-error:
+    Entity(x, _) -> (x, $[Duplicate entity name])
+    where
+      not(<bagof-GetEntity> x => [_])
+  
+  constraint-warning:
+    Entity(x, _) -> (x, $[Entity names must start with a capital])
+    where
+      not(<explode-string; Hd; is-upper> x)
+  
+  constraint-note:
+    Module(x @ "example", _) -> (x, $[This is just an example program in the "entities" language
+                                      (this note is defined in trans/check.str) ])

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/generate.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/generate.str	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/generate.str	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,47 @@
+module generate
+
+imports
+  libstratego-lib
+  libstratego-gpp
+  libstratego-aterm
+  include/Stratego-Attributes
+  lib/editor-common
+
+rules
+
+  to-java:
+    Module(x, d*) ->
+    $[ package [x];
+       
+       [d'*]
+     ]
+    with
+      d'* := <to-java> d*
+  
+  to-java:
+    Entity(x, p*) ->
+    $[ class [x] {
+           [p'*]
+       }
+     ]
+    with
+      p'* := <to-java> p*
+
+  to-java:
+    Property(x, Type(t)) -> $[
+      private [t] [x];
+      
+      public [t] get_[x] {
+          return [x];
+      }
+      
+      public [t] set_[x] ([t] [x]) {
+          this.[x] = [x];    
+      }
+  ]
+  
+  to-java:
+    Type(t) -> t
+
+  to-java:
+    t* -> <map(to-java)> t*

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/stratego_attributes.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/stratego_attributes.str	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/trans/stratego_attributes.str	2010-02-08 17:03:58 UTC (rev 20590)
@@ -0,0 +1,66 @@
+module stratego_attributes
+
+imports
+  libstratego-lib
+  libstratego-gpp
+  libstratego-aterm
+  include/Stratego-Attributes
+  lib/editor-common
+  check
+  generate
+
+rules // Main editor interface (defined by editor/Stratego-Attributes-Builders and -References.esv)
+  
+  // Analyzes the current program, returning a tuple with errors, warnings, and notes;
+  // each a list of (term, message) tuples or simply (message) terms.
+  editor-analyze:
+    (ast, path, project-path) -> (errors, warnings, notes)
+    with
+      // Ensure all dynamic rules are properly scoped
+      try(dr-scope-all-end);
+      dr-scope-all-start
+    with
+      analyze;
+      errors   := <collect-all(constraint-error, conc)> ast;
+      warnings := <collect-all(constraint-warning, conc)> ast;
+      notes    := <collect-all(constraint-note, conc)> ast
+  
+  // Transforms a selection to Java
+  generate-java:
+    (selected, position, ast, path, project-path) -> (filename, result)
+    with
+      filename := <guarantee-extension(|"java")> path;
+      result   := <to-java> selected
+  
+  // Prints the abstract syntax ATerm of a selection.
+  generate-aterm:
+    (selected, position, ast, path, project-path) -> (filename, result)
+    with
+      filename := <guarantee-extension(|"aterm")> path;
+      result   := selected // we just return the input term
+  

(68 diff lines omitted)


From L.C.L.Kats at tudelft.nl  Mon Feb  8 18:09:57 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 08 Feb 2010 17:09:57 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20591 - LennartKats -
	in spoofax-imp/trunk: . org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aster/lib
Message-ID: <201002081709.o18H9vb4019554@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-08 17:09:57 +0000 (Mon, 08 Feb 2010)
New Revision: 20591

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20591&view=rev

Added:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar
Modified:
   spoofax-imp/trunk/Makefile

Log:
Added aster.jar.

Changes:

Modified: spoofax-imp/trunk/Makefile
===================================================================
--- spoofax-imp/trunk/Makefile	2010-02-08 17:03:58 UTC (rev 20590)
+++ spoofax-imp/trunk/Makefile	2010-02-08 17:09:57 UTC (rev 20591)
@@ -3,7 +3,8 @@
       org.strategoxt.imp.editors.editorservice.ant \
       org.strategoxt.imp.editors.sdf.ant \
       org.strategoxt.imp.editors.stratego.ant \
-      org.strategoxt.imp.editors.aterm.ant
+      org.strategoxt.imp.editors.aterm.ant \
+      org.strategoxt.imp.editors.aster.ant
 
 org.strategoxt.imp.generator/lib/sdf2imp.jar : .PHONY
 	$(MAKE) -C org.strategoxt.imp.generator all
@@ -22,6 +23,7 @@
 
 new-libs :
 	$(MAKE) -C org.strategoxt.imp.generator new-libs
+	cp $(ASTER)/trans/java/aster.jar org.strategoxt.imp.editors.aster/lib/aster.jar
 
 org.eclipse.imp/org.eclipse.imp.runtime.patch : .PHONY
 	@if [ "$(ECLIPSE_IMP)" != "" ]; then \

Added: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar
===================================================================
(Binary files differ)


Property changes on: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream



From L.C.L.Kats at tudelft.nl  Tue Feb  9 13:03:28 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 12:03:28 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20592 - LennartKats -
	strc-java/trunk/java/runtime/org/strategoxt/lang
Message-ID: <201002091203.o19C3SVs018461@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 12:03:28 +0000 (Tue, 09 Feb 2010)
New Revision: 20592

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20592&view=rev

Modified:
   strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java

Log:
Fixed the ImportTerm workaround for Class.getResourceAsStream to actually work

Changes:

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java	2010-02-08 17:09:57 UTC (rev 20591)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/ImportTerm.java	2010-02-09 12:03:28 UTC (rev 20592)
@@ -97,8 +97,8 @@
 			if (location.getFile().endsWith(".jar")) {
 				File jarFile = new File(location.toURI());
 				ZipFile jar = new ZipFile(jarFile);
-				ZipEntry entry = jar.getEntry(path + name);
-				if (entry == null) entry = jar.getEntry("/" + name);
+				ZipEntry entry = jar.getEntry(removePrecedingSlash(path) + name);
+				if (entry == null) entry = jar.getEntry(name);
 				if (entry == null) return null;
 				return jar.getInputStream(entry);
 			} else {
@@ -108,4 +108,8 @@
 			return null; // be forgiving
 		}
 	}
+	
+	private static String removePrecedingSlash(String path) {
+		return path.startsWith("/") ? path.substring(1) : path;
+	}
 }



From L.C.L.Kats at tudelft.nl  Tue Feb  9 13:41:10 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 12:41:10 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20593 - LennartKats -
	spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser
Message-ID: <201002091241.o19CfBL5018774@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 12:41:10 +0000 (Tue, 09 Feb 2010)
New Revision: 20593

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20593&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/JSGLRI.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java
   spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/SGLR.java
   spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/Tools.java

Log:
Moved Tools.setTimeout() to a non-static method SGLR.setTimeout()

Changes:

Modified: spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/SGLR.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/SGLR.java	2010-02-09 12:03:28 UTC (rev 20592)
+++ spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/SGLR.java	2010-02-09 12:41:10 UTC (rev 20593)
@@ -43,6 +43,8 @@
     //Performance testing
     private static long parseTime=0;
     private static int parseCount=0;
+    
+    private int timeout;
         
     public Frame startFrame; 
     
@@ -243,7 +245,7 @@
     }
     
     private void initParseTimer() {
-        if (Tools.timeout > 0) {
+        if (timeout > 0) {
             // We use a single shared timer to conserve native threads
             // and a jobId to recognize stale abort events
             synchronized (abortTimer) {
@@ -259,12 +261,22 @@
                             asyncAbort();
                     }
                 }
-            }, Tools.timeout
+            }, timeout
             );
         } else {
             asyncAborted = false;
         }
     }
+    
+    /**
+     * Sets the maximum amount of time to try and parse a file,
+     * before a {@link ParseTimeoutException} is thrown.
+     * 
+     * @param timeout  The maximum time to parse, in milliseconds.
+     */
+    public void setTimeout(int timeout) {
+        this.timeout = timeout;
+    }
 
     private ATerm sglrParse(String startSymbol)
             throws IOException, BadTokenException, TokenExpectedException,

Modified: spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/Tools.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/Tools.java	2010-02-09 12:03:28 UTC (rev 20592)
+++ spoofax/trunk/spoofax/org.spoofax.jsglr/src/org/spoofax/jsglr/Tools.java	2010-02-09 12:41:10 UTC (rev 20593)
@@ -22,7 +22,6 @@
     static boolean logging = false;
     static boolean tracing = false;
     static boolean measuring = false;
-    static int timeout = 0;
     
     private static Measures measures;
     
@@ -98,8 +97,11 @@
      * before a {@link ParseTimeoutException} is thrown.
      * 
      * @param timeout  The maximum time to parse, in milliseconds.
+     * 
+     * @Deprecated Use SGLR.setTimeout instead
      */
+    @Deprecated
     public static void setTimeout(int timeout) {
-        Tools.timeout = timeout;
+        // noop
     }
 }

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/JSGLRI.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/JSGLRI.java	2010-02-09 12:03:28 UTC (rev 20592)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/JSGLRI.java	2010-02-09 12:41:10 UTC (rev 20593)
@@ -33,6 +33,8 @@
 	
 	private Disambiguator disambiguator;
 	
+	private int timeout;
+	
 	// Initialization and parsing
 	
 	public JSGLRI(ParseTable parseTable, String startSymbol,
@@ -80,6 +82,11 @@
 		resetState();
 	}
 	
+	public void setTimeout(int timeout) {
+		this.timeout = timeout;
+		resetState();
+	}
+	
 	@Override
 	protected ATerm doParseNoImplode(char[] inputChars, String filename)
 			throws TokenExpectedException, BadTokenException, SGLRException, IOException {
@@ -92,6 +99,7 @@
 	 */
 	void resetState() {
 		parser = Environment.createSGLR(parseTable);
+		parser.setTimeout(timeout);
 		if (disambiguator != null) parser.setDisambiguator(disambiguator);
 		else disambiguator = parser.getDisambiguator();
 		try {

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java	2010-02-09 12:03:28 UTC (rev 20592)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/SGLRParseController.java	2010-02-09 12:41:10 UTC (rev 20593)
@@ -34,7 +34,6 @@
 import org.spoofax.jsglr.SGLRException;
 import org.spoofax.jsglr.StartSymbolException;
 import org.spoofax.jsglr.TokenExpectedException;
-import org.spoofax.jsglr.Tools;
 import org.strategoxt.imp.runtime.Debug;
 import org.strategoxt.imp.runtime.EditorState;
 import org.strategoxt.imp.runtime.Environment;
@@ -150,14 +149,7 @@
     public EditorState getEditor() {
 		return editor;
 	}
-	
-	// Parsing and initialization
     
-    static {
-    	// if (!Debug.ENABLED)
-    		Tools.setTimeout(PARSE_TIMEOUT);
-    }
-    
     /**
      * Create a new SGLRParseController.
      * 
@@ -173,6 +165,7 @@
     	ParseTable table = Environment.getParseTable(language);
 		parser = new JSGLRI(table, startSymbol, this, tokenManager);
 		parser.setKeepAmbiguities(true);
+		parser.setTimeout(PARSE_TIMEOUT);
 		try {
 			parser.setUseRecovery(true);
 		} catch (NoRecoveryRulesException e) {



From L.C.L.Kats at tudelft.nl  Tue Feb  9 14:07:37 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 13:07:37 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20594 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib
Message-ID: <201002091307.o19D7bgV019529@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 13:07:36 +0000 (Tue, 09 Feb 2010)
New Revision: 20594

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20594&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str	2010-02-09 12:41:10 UTC (rev 20593)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str	2010-02-09 13:07:36 UTC (rev 20594)
@@ -58,13 +58,7 @@
 
   subterm-at(|index):
     _#(t*) -> <index(|<inc> index)> t*
-  {"" /* TODO: pretty-printer
-  // Pretty prints the {sdf-name} language to a string
-  pp-{name}-string =
-    ast2abox(|[<import-term(include/{sdf-name}.generated.pp.af)>,
-               <import-term(include/{sdf-name}.pp.af)>]);
-    box2text-string(|100)*/
-  }
+  
 signature constructors
 
   COMPLETION : String -> Term



From L.C.L.Kats at tudelft.nl  Tue Feb  9 14:08:00 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 13:08:00 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20595 - LennartKats -
	strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix
	strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode
	strc-java/trunk/java/runtime/org/strategoxt/lang/compat/override
Message-ID: <201002091308.o19D801k019540@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 13:08:00 +0000 (Tue, 09 Feb 2010)
New Revision: 20595

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20595&view=rev

Modified:
   strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str
   strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/override/performance-tweaks.str

Log:
Minor performance tweaks.

Changes:

Modified: strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str
===================================================================
--- strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str	2010-02-09 13:07:36 UTC (rev 20594)
+++ strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str	2010-02-09 13:08:00 UTC (rev 20595)
@@ -21,14 +21,10 @@
    * Add an annotation uniquely identifying each {indentpadding} lexical.
    */
   AddPaddedLexicalAnno :
-    appl(prod(_, _, attrs(a*)), _) -> <id> {PaddingId(<new>)}
-    where
-      <one(term(indentpadding()))> a* 
+    appl(prod(_, _, attrs([term(indentpadding())])), _) -> <id> {PaddingId(<new>)}
     
   ImplodePaddedLexical :
-    appl(prod(_, _, attrs(a*)), _) -> AddPadding(imploded) {PaddingContext(<id>)}
-    where
-      <one(term(indentpadding()))> a*
+    appl(prod(_, _, attrs(term(indentpadding()))), _) -> AddPadding(imploded) {PaddingContext(<id>)}
     with
       imploded := <asfix-yield-appl>
 

Modified: strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str
===================================================================
--- strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str	2010-02-09 13:07:36 UTC (rev 20594)
+++ strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str	2010-02-09 13:08:00 UTC (rev 20595)
@@ -34,7 +34,7 @@
    */
   implode-asfix(implode-concrete) =
     ?parsetree(<id>, _)
-    ; topdown(try(AddPaddedLexicalAnno))
+    ; rec rec(all((AddPaddedLexicalAnno <+ id); rec))
     ; ?asfix
     ; rec x({
         ?asfix

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/compat/override/performance-tweaks.str
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/compat/override/performance-tweaks.str	2010-02-09 13:07:36 UTC (rev 20594)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/compat/override/performance-tweaks.str	2010-02-09 13:08:00 UTC (rev 20595)
@@ -37,6 +37,9 @@
   override crush(nul, sum, s) =
     SRTS-EXT-crush(nul, sum, s)
 
+  override topdown(s) =
+    rec rec(s; all(rec))
+
   override foldr(nul, sum) =
     ?[_ | _] < SRTS-EXT-crush(nul, sum, id) + []; nul
 



From L.C.L.Kats at tudelft.nl  Tue Feb  9 15:28:45 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 14:28:45 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20596 - LennartKats -
	strategoxt/trunk/stratego-libraries/lib/spec/term
Message-ID: <201002091428.o19ESj8X020627@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 14:28:45 +0000 (Tue, 09 Feb 2010)
New Revision: 20596

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20596&view=rev

Modified:
   strategoxt/trunk/stratego-libraries/lib/spec/term/string.str

Log:
Added a newterm strategy that might be slightly more efficient when you need a new term that isn't necessarily a string.

Changes:

Modified: strategoxt/trunk/stratego-libraries/lib/spec/term/string.str
===================================================================
--- strategoxt/trunk/stratego-libraries/lib/spec/term/string.str	2010-02-09 13:08:00 UTC (rev 20595)
+++ strategoxt/trunk/stratego-libraries/lib/spec/term/string.str	2010-02-09 14:28:45 UTC (rev 20596)
@@ -51,6 +51,19 @@
   newname = ?prefix; prim("SSL_newname", prefix)
 
   /**
+   * Generates a unique new term.
+   * May not necessarily be a string, depending on the platform.
+   * May be slightly more efficient than a standard 'new.'
+   *
+   * @since 0.18
+   */
+  newterm =
+    if-c-platform(prim("SSL_new"));
+    if-java-platform(SRTS-EXT-newint)
+
+  external SRTS-EXT-newint(|)
+
+  /**
    * Predicate that checks if the supplied term is a string.
    *
    * @type String -> String



From L.C.L.Kats at tudelft.nl  Tue Feb  9 15:29:42 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 14:29:42 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20597 - LennartKats -
	aster/trunk/trans
	spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib
Message-ID: <201002091429.o19ETg0e020640@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 14:29:42 +0000 (Tue, 09 Feb 2010)
New Revision: 20597

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20597&view=rev

Modified:
   aster/trunk/trans/io.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar

Log:
Cleanup.

Changes:

Modified: aster/trunk/trans/io.str
===================================================================
--- aster/trunk/trans/io.str	2010-02-09 14:28:45 UTC (rev 20596)
+++ aster/trunk/trans/io.str	2010-02-09 14:29:42 UTC (rev 20597)
@@ -15,7 +15,7 @@
   input-stratego-file =
     xtc-ensure-file => FILE(file);
     parse-stratego-trm( // TODO: if-java-platform(import-term)
-    | <debug(!"options:")> [ "-i", file
+    | [ "-i", file
       , "--default-syntax", "Stratego-Attributes"
       , "-I", <stratego-attributes-table-path>
       , "-I", <stratego-attributes-in-stratego-table-path>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar
===================================================================
(Binary files differ)



From L.C.L.Kats at tudelft.nl  Tue Feb  9 16:44:31 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 15:44:31 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20598 - LennartKats -
	aster/trunk/trans
	spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib
Message-ID: <201002091544.o19FiVX9021683@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 15:44:31 +0000 (Tue, 09 Feb 2010)
New Revision: 20598

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20598&view=rev

Modified:
   aster/trunk/trans/io.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar

Log:
Eliminated xtc-command call.

Changes:

Modified: aster/trunk/trans/io.str
===================================================================
--- aster/trunk/trans/io.str	2010-02-09 14:29:42 UTC (rev 20597)
+++ aster/trunk/trans/io.str	2010-02-09 15:44:31 UTC (rev 20598)
@@ -65,8 +65,13 @@
     )
 
   output-stratego-file =
-    write-to;
-    xtc-transform(!"pp-stratego", !["--abstract" | <pass-verbose>])
+    with(
+      file   := <xtc-new-file>
+    ; stream := <open-stream> (file, "w")
+    );
+    finally(
+      pp-stratego-stream(|stream), <fclose> stream
+    )
   <+
     pp-format-checker-error(|"Internal error: generated AST is malformed", "Stratego-Sugar.rtg")
 

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar
===================================================================
(Binary files differ)



From L.C.L.Kats at tudelft.nl  Tue Feb  9 17:26:49 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 16:26:49 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20599 - LennartKats -
	aster/trunk/trans
Message-ID: <201002091626.o19GQnI4022462@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 16:26:48 +0000 (Tue, 09 Feb 2010)
New Revision: 20599

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20599&view=rev

Modified:
   aster/trunk/trans/io.str
   aster/trunk/trans/options.str

Log:
Generate .rtrees instead of .strs by default.

Changes:

Modified: aster/trunk/trans/io.str
===================================================================
--- aster/trunk/trans/io.str	2010-02-09 15:44:31 UTC (rev 20598)
+++ aster/trunk/trans/io.str	2010-02-09 16:26:48 UTC (rev 20599)
@@ -3,7 +3,7 @@
 imports
   libstratego-lib
   libstratego-sglr
-  libstratego-xtc  // TODO2: XTC detox
+  libstratego-xtc
   libstrc
 
 strategies
@@ -14,7 +14,7 @@
   
   input-stratego-file =
     xtc-ensure-file => FILE(file);
-    parse-stratego-trm( // TODO: if-java-platform(import-term)
+    parse-stratego-trm(
     | [ "-i", file
       , "--default-syntax", "Stratego-Attributes"
       , "-I", <stratego-attributes-table-path>
@@ -65,13 +65,18 @@
     )
 
   output-stratego-file =
-    with(
-      file   := <xtc-new-file>
-    ; stream := <open-stream> (file, "w")
-    );
-    finally(
-      pp-stratego-stream(|stream), <fclose> stream
-    )
+    if OutputAST then
+      write-to
+    else
+      with(
+        file   := <xtc-new-file>
+      ; stream := <open-stream> (file, "w")
+      );
+      finally(
+        pp-stratego-stream(|stream), <fclose> stream
+      );
+      !FILE(file)
+    end
   <+
     pp-format-checker-error(|"Internal error: generated AST is malformed", "Stratego-Sugar.rtg")
 

Modified: aster/trunk/trans/options.str
===================================================================
--- aster/trunk/trans/options.str	2010-02-09 15:44:31 UTC (rev 20598)
+++ aster/trunk/trans/options.str	2010-02-09 16:26:48 UTC (rev 20599)
@@ -27,15 +27,18 @@
     )
   
   infer-output-option =
-    <get-config> "--multi-output"
+    <get-config> "--multi-output";
+    if all(has-extension(|"rtree")) then
+      rules(OutputAST: _)
+    else
+      if not(all(has-extension(|"str"))) then
+        fatal-err(|"Please specify output files with a .str or .rtree extension")
+      end
+    end
   <+
-    // one(multi-input-option)
     <get-config> "--multi-input";
-    map(
-      has-extension(|"str")
-      < guarantee-extension(|"astr.str")
-      + guarantee-extension(|"str")
-    );
-    <set-config> ("--multi-output", <id>)
+    map(guarantee-extension(|"rtree"));
+    <set-config> ("--multi-output", <id>);
+    rules(OutputAST: _)
   <+
     ![stdout()]



From L.C.L.Kats at tudelft.nl  Tue Feb  9 18:23:47 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 17:23:47 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20600 - LennartKats -
	in strc-java/trunk: . java/runtime/org/strategoxt/lang/compat
	java/runtime/org/strategoxt/lang/terms
Message-ID: <201002091723.o19HNl34023162@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 17:23:47 +0000 (Tue, 09 Feb 2010)
New Revision: 20600

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20600&view=rev

Modified:
   strc-java/trunk/.classpath
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/NativeCallHelper.java
   strc-java/trunk/java/runtime/org/strategoxt/lang/terms/StrategoInt.java

Log:


Changes:

Modified: strc-java/trunk/.classpath
===================================================================
--- strc-java/trunk/.classpath	2010-02-09 16:26:48 UTC (rev 20599)
+++ strc-java/trunk/.classpath	2010-02-09 17:23:47 UTC (rev 20600)
@@ -1,7 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <classpath>
 	<classpathentry kind="src" path="java/runtime"/>
-	<classpathentry kind="src" path="test/basic"/>
 	<classpathentry kind="con" path="org.eclipse.pde.core.requiredPlugins"/>
 	<classpathentry exported="true" kind="lib" path="java/strategoxt.jar" sourcepath="java/lib"/>
 	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/J2SE-1.5"/>

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/compat/NativeCallHelper.java
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/compat/NativeCallHelper.java	2010-02-09 16:26:48 UTC (rev 20599)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/compat/NativeCallHelper.java	2010-02-09 17:23:47 UTC (rev 20600)
@@ -15,7 +15,6 @@
  */
 public class NativeCallHelper {	
 	
-	@Deprecated
 	public int call(String[] commandArgs, File workingDir, PrintStream outStream, PrintStream errorStream)
 			throws InterruptedException, IOException {
 		
@@ -28,7 +27,6 @@
 		return call(commandArgs, null, workingDir, outStream, errorStream);
 	}
 	
-	@Deprecated
 	public int call(String[] commandArgs, String[] environment, File workingDir, PrintStream outStream, PrintStream errorStream)
 			throws InterruptedException, IOException {
 		return call(commandArgs, environment, workingDir, new OutputStreamWriter(outStream), new OutputStreamWriter(errorStream));
@@ -50,7 +48,7 @@
 		return result;
 	}
 
-	public static class StreamCopier extends Thread {
+	private static class StreamCopier extends Thread {
 		private final Reader input;
 		private final Writer output;
 	

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/terms/StrategoInt.java
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/terms/StrategoInt.java	2010-02-09 16:26:48 UTC (rev 20599)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/terms/StrategoInt.java	2010-02-09 17:23:47 UTC (rev 20600)
@@ -71,7 +71,7 @@
     }
 
     public void prettyPrint(ITermPrinter pp) {
-        pp.print("" + intValue());
+        pp.print(String.valueOf(intValue()));
         printAnnotations(pp);
     }
 



From L.C.L.Kats at tudelft.nl  Tue Feb  9 18:27:03 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 09 Feb 2010 17:27:03 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20601 - LennartKats -
	in spoofax-imp/trunk: . org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aster/META-INF
	org.strategoxt.imp.editors.aster/editor
	org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.editors.stratego/editor
	org.strategoxt.imp.feature org.strategoxt.imp.generator
	org.strategoxt.imp.generator/lib
	org.strategoxt.imp.generator/src/sdf2imp/project
	org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/dynamicloading
Message-ID: <201002091727.o19HR3ZL023193@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-09 17:27:03 +0000 (Tue, 09 Feb 2010)
New Revision: 20601

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20601&view=rev

Added:
   spoofax-imp/trunk/org.strategoxt.imp.generator/lib/aster.jar
Removed:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/
Modified:
   spoofax-imp/trunk/Makefile
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/editor/Stratego-Sugar-Outliner.esv
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.generator/Makefile
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/dynamicloading/ContentProposerFactory.java

Log:
- Made the Aster editor part of the standard distribution
- Added Aster support to build.generated.xml
- Removed dependencies on utils-files target to clean up the ant output a bit

Changes:

Modified: spoofax-imp/trunk/Makefile
===================================================================
--- spoofax-imp/trunk/Makefile	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/Makefile	2010-02-09 17:27:03 UTC (rev 20601)
@@ -23,7 +23,6 @@
 
 new-libs :
 	$(MAKE) -C org.strategoxt.imp.generator new-libs
-	cp $(ASTER)/trans/java/aster.jar org.strategoxt.imp.editors.aster/lib/aster.jar
 
 org.eclipse.imp/org.eclipse.imp.runtime.patch : .PHONY
 	@if [ "$(ECLIPSE_IMP)" != "" ]; then \

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/META-INF/MANIFEST.MF	2010-02-09 17:27:03 UTC (rev 20601)
@@ -1,8 +1,8 @@
 Manifest-Version: 1.0
 Bundle-ManifestVersion: 2
-Bundle-Name: StrategoAttributes Plug-in
+Bundle-Name: Aster Plug-in
 Bundle-SymbolicName: org.strategoxt.imp.editors.aster; singleton:=true
-Bundle-Version: 1.0.0
+Bundle-Version: 0.1.0.qualifier
 Bundle-Activator: org.strategoxt.imp.editors.aster.Activator
 Import-Package: org.osgi.framework;version="1.3.0"
 Require-Bundle: org.eclipse.core.runtime,

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -191,6 +192,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
@@ -228,7 +258,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.main.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -23,7 +23,7 @@
                         -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm"/>
         
         <property name="externaldef" location="syntax/${sdfmodule}.def"/>
-        <property name="externaljar" value="lib/aster.jar"/>
+        <property name="externaljar" value="utils/aster.jar"/>
         <property name="externaljarflags" value="-la org.strategoxt.aster"/>
     
         <!-- Environment configuration for command-line builds -->
@@ -36,4 +36,4 @@
     
         <!-- Main target -->
         <target name="all" depends="spoofaximp.default"/>
-    </project>
\ No newline at end of file
+    </project>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/editor/Stratego-Attributes-References.esv	2010-02-09 17:27:03 UTC (rev 20601)
@@ -12,7 +12,7 @@
 references
                         
   completion proposer : editor-complete
-  completion lexical  : [a-zA-Z\_][a-zA-Z0-9\'\-\_]*[\*]
+  completion lexical  : [a-zA-Z\_][a-zA-Z0-9\'\-\_]*\*?
   completion trigger  : "."
                         
   // reference _         : editor-resolve

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -191,6 +191,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -191,6 +191,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -191,6 +191,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -191,6 +191,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/editor/Stratego-Sugar-Outliner.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/editor/Stratego-Sugar-Outliner.esv	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/editor/Stratego-Sugar-Outliner.esv	2010-02-09 17:27:03 UTC (rev 20601)
@@ -8,9 +8,9 @@
   // See the imported file for a brief introduction and examples.
   
   Module
-  _.Rules
-  _.Strategies
-  _.Overlays
+  // _.Rules
+  // _.Strategies
+  // _.Overlays
   _.SDefNoArgs
   _.SDefT
   _.SDef

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-09 17:27:03 UTC (rev 20601)
@@ -230,4 +230,11 @@
          version="0.1.91.qualifier"
          unpack="false"/>
 
+   <plugin
+         id="org.strategoxt.imp.editors.aster"
+         download-size="0"
+         install-size="0"
+         version="0.1.0.qualifier"
+         unpack="false"/>
+
 </feature>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/Makefile
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/Makefile	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/Makefile	2010-02-09 17:27:03 UTC (rev 20601)
@@ -127,6 +127,7 @@
 	baf2trm  -i $< -o $@ # cp $< $@
 
 new-libs :
-	rm -rf $(BRIDGE)/permissive-grammars/trans/make-permissive/bin
-	make jar -C $(BRIDGE)/permissive-grammars/trans/make-permissive
 	cp $(BRIDGE)/permissive-grammars/trans/make-permissive/bin/*.jar lib
+	cp $(ASTER)/trans/java/aster.jar lib
+
+#	make jar -C $(BRIDGE)/permissive-grammars/trans/make-permissive

Copied: spoofax-imp/trunk/org.strategoxt.imp.generator/lib/aster.jar (from rev 20598, spoofax-imp/trunk/org.strategoxt.imp.editors.aster/lib/aster.jar)
===================================================================
(Binary files differ)

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-09 17:27:03 UTC (rev 20601)
@@ -77,7 +77,7 @@
     <?xml version="1.0" encoding="UTF-8"?>
     <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -108,7 +108,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -141,7 +141,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -155,6 +155,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -169,7 +170,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -201,7 +202,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -222,7 +223,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -247,7 +248,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -266,6 +267,35 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
@@ -303,7 +333,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/dynamicloading/ContentProposerFactory.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/dynamicloading/ContentProposerFactory.java	2010-02-09 17:23:47 UTC (rev 20600)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/dynamicloading/ContentProposerFactory.java	2010-02-09 17:27:03 UTC (rev 20601)
@@ -76,7 +76,8 @@
 			if (result.matcher("").matches())
 				throw new PatternSyntaxException("Completion lexical matches the empty string", completionLexical, 0);
 			if (!result.matcher(ContentProposer.COMPLETION_TOKEN).matches())
-				throw new PatternSyntaxException("Completion lexical allow letters and numbers", completionLexical, 0);
+				throw new PatternSyntaxException("Completion lexical must allow letters and numbers (e.g., "
+						+ ContentProposer.COMPLETION_TOKEN + ")", completionLexical, 0);
 			return result;
 		} catch (PatternSyntaxException e) {
 			throw new BadDescriptorException("Illegal completion lexical in editor descriptor", e);



From L.C.L.Kats at tudelft.nl  Wed Feb 10 14:36:54 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 10 Feb 2010 13:36:54 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20602 - LennartKats -
	in strc-java/trunk: tools trans
Message-ID: <201002101336.o1ADasBr005822@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-10 13:36:54 +0000 (Wed, 10 Feb 2010)
New Revision: 20602

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20602&view=rev

Modified:
   strc-java/trunk/tools/strj-jar
   strc-java/trunk/trans/strj.str

Log:
Added some sanity checks.

Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-09 17:27:03 UTC (rev 20601)
+++ strc-java/trunk/tools/strj-jar	2010-02-10 13:36:54 UTC (rev 20602)
@@ -17,15 +17,15 @@
   CLASSPATH=`dirname "$(cd ${0%/*}/.. && echo $PWD/${0##*/})"`/share/strc-java/strategoxt.jar
 fi
 
+if [ ! -e $CLASSPATH ]; then
+  echo Warning: $CLASSPATH not found >&2
+fi
+
 ## PARAMETERS
 
 while P=$1; shift; do
   if [ "$P" == "-cp" ]; then
-    if [ -e $CLASSPATH ]; then
-      CLASSPATH="$1:$CLASSPATH"
-    else
-      CLASSPATH="$1"
-    fi
+    CLASSPATH="$1:$CLASSPATH"
     shift
   elif [ "$P" == "-i" ]; then
     INPUT="$1"

Modified: strc-java/trunk/trans/strj.str
===================================================================
--- strc-java/trunk/trans/strj.str	2010-02-09 17:27:03 UTC (rev 20601)
+++ strc-java/trunk/trans/strj.str	2010-02-10 13:36:54 UTC (rev 20602)
@@ -137,7 +137,8 @@
    // using something like rtg-format-check(true, true|<java-rtg>) is more expensive atm,
    // because of the import-term involved)
    output-java-error =
-      err-msg(|"Internal error: generated Java AST is malformed")
+      with(not(<pp-java5-to-abox> Id("foo") => Id("foo")) | "Internal error: linking against libjava-front failed")
+    ; err-msg(|"Internal error: generated Java AST is malformed")
     ; write-to => FILE(file)
     ; try(<xtc-command(!"format-check")> ["--vis", "-i", file, "--rtg", <xtc-find> "Java-15.rtg" | <pass-verbose>])
     ; log(|Critical(), "Fatal errors encountered in generated code")



From L.C.L.Kats at tudelft.nl  Wed Feb 10 16:57:20 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 10 Feb 2010 15:57:20 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20603 - LennartKats -
	strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix
Message-ID: <201002101557.o1AFvKwm008418@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-10 15:57:20 +0000 (Wed, 10 Feb 2010)
New Revision: 20603

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20603&view=rev

Modified:
   strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str

Log:
Attempt to blindly fix the buildfarm unit tests.

Changes:

Modified: strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str
===================================================================
--- strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str	2010-02-10 13:36:54 UTC (rev 20602)
+++ strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode.str	2010-02-10 15:57:20 UTC (rev 20603)
@@ -34,7 +34,7 @@
    */
   implode-asfix(implode-concrete) =
     ?parsetree(<id>, _)
-    ; rec rec(all((AddPaddedLexicalAnno <+ id); rec))
+    ; rec rec((AddPaddedLexicalAnno <+ id); all(rec))
     ; ?asfix
     ; rec x({
         ?asfix



From L.C.L.Kats at tudelft.nl  Wed Feb 10 17:41:33 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 10 Feb 2010 16:41:33 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20604 - LennartKats -
	in strc-java/trunk/trans: . lib
Message-ID: <201002101641.o1AGfXGH015853@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-10 16:41:33 +0000 (Wed, 10 Feb 2010)
New Revision: 20604

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20604&view=rev

Modified:
   strc-java/trunk/trans/lib/dr-scoping.str
   strc-java/trunk/trans/strj.str

Log:


Changes:

Modified: strc-java/trunk/trans/lib/dr-scoping.str
===================================================================
--- strc-java/trunk/trans/lib/dr-scoping.str	2010-02-10 15:57:20 UTC (rev 20603)
+++ strc-java/trunk/trans/lib/dr-scoping.str	2010-02-10 16:41:33 UTC (rev 20604)
@@ -14,14 +14,13 @@
     ; s
     <+
       prim("SSL_stacktrace_get_all_frame_names")
-    ; if if-verbose3(?true); !true then
+    ; if-verbose3(
         report-failure(
           log(|Error(), ["Compilation failed (", <run-time ; real-to-string(|2)>, " secs)"])
         ; <exit> 1
         )
-      else
-        dr-scope-all-end; fail
-      end
+      )
+    ; dr-scope-all-end; fail
     |}
 
   // TODO: remove these definitions

Modified: strc-java/trunk/trans/strj.str
===================================================================
--- strc-java/trunk/trans/strj.str	2010-02-10 15:57:20 UTC (rev 20603)
+++ strc-java/trunk/trans/strj.str	2010-02-10 16:41:33 UTC (rev 20604)
@@ -29,7 +29,14 @@
     )
   ; <exit> 0
   <+
-    log(|Error(), ["Compilation failed (", <run-time ; real-to-string(|2)>, " secs)"])
+    prim("SSL_stacktrace_get_all_frame_names")
+  ; if-verbose3(
+      report-failure(
+        log(|Error(), ["Compilation failed (", <run-time ; real-to-string(|2)>, " secs)"])
+      ; <exit> 1
+      )
+    )
+  ; log(|Error(), ["Compilation failed (", <run-time ; real-to-string(|2)>, " secs)"])
   ; <exit> 1
   
   strj =



From L.C.L.Kats at tudelft.nl  Wed Feb 10 18:03:30 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 10 Feb 2010 17:03:30 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20605 - LennartKats -
	strc-java/trunk/trans
Message-ID: <201002101703.o1AH3UIZ019063@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-10 17:03:30 +0000 (Wed, 10 Feb 2010)
New Revision: 20605

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20605&view=rev

Modified:
   strc-java/trunk/trans/strj-options.str

Log:
Fixed compilation without -o option.

Changes:

Modified: strc-java/trunk/trans/strj-options.str
===================================================================
--- strc-java/trunk/trans/strj-options.str	2010-02-10 16:41:33 UTC (rev 20604)
+++ strc-java/trunk/trans/strj-options.str	2010-02-10 17:03:30 UTC (rev 20605)
@@ -32,7 +32,7 @@
       strj-options
     )
   //; display-version
-  ; where(output-dirname) // ensure dir exists
+  ; ensure-output-dir-exists
   ; if <get-config> "-o"; base-filename; not(<eq> (<id>, <jify>)); not(<get-config> "-F") then
       <get-config> "-o"
     ; fatal-err(|"Output file name is not a legal Java name")
@@ -41,6 +41,9 @@
       fatal-err-msg(|"No package name specified")
     end
   
+  ensure-output-dir-exists =
+    where(not(<get-config> "-o") + output-dirname)
+  
   strj-options =
     input-option
   <+



From L.C.L.Kats at tudelft.nl  Fri Feb 12 11:57:45 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 10:57:45 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20607 - LennartKats -
	strc-java/trunk/trans
Message-ID: <201002121057.o1CAvjJY015060@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 10:57:44 +0000 (Fri, 12 Feb 2010)
New Revision: 20607

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20607&view=rev

Modified:
   strc-java/trunk/trans/strj-options.str

Log:


Changes:

Modified: strc-java/trunk/trans/strj-options.str
===================================================================
--- strc-java/trunk/trans/strj-options.str	2010-02-12 09:50:46 UTC (rev 20606)
+++ strc-java/trunk/trans/strj-options.str	2010-02-12 10:57:44 UTC (rev 20607)
@@ -32,7 +32,9 @@
       strj-options
     )
   //; display-version
-  ; ensure-output-dir-exists
+  ; if not(<get-config> "-o" + output-dirname) then
+      fatal-err-msg(|"Illegal output directory")
+    end
   ; if <get-config> "-o"; base-filename; not(<eq> (<id>, <jify>)); not(<get-config> "-F") then
       <get-config> "-o"
     ; fatal-err(|"Output file name is not a legal Java name")
@@ -41,9 +43,6 @@
       fatal-err-msg(|"No package name specified")
     end
   
-  ensure-output-dir-exists =
-    where(not(<get-config> "-o") + output-dirname)
-  
   strj-options =
     input-option
   <+



From L.C.L.Kats at tudelft.nl  Fri Feb 12 13:27:01 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 12:27:01 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20608 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.editors.stratego/trans
	org.strategoxt.imp.generator/src/sdf2imp/project
Message-ID: <201002121227.o1CCR1PE016321@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 12:27:00 +0000 (Fri, 12 Feb 2010)
New Revision: 20608

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20608&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-12 12:27:00 UTC (rev 20608)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -257,7 +258,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-12 12:27:00 UTC (rev 20608)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -257,7 +258,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-12 12:27:00 UTC (rev 20608)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -257,7 +258,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-12 12:27:00 UTC (rev 20608)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -257,7 +258,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str	2010-02-12 12:27:00 UTC (rev 20608)
@@ -139,7 +139,7 @@
     if-c-platform(new)
 
   external SRTS-EXT-newint(|)
-    
+  
 rules // Declare globals
 
   declare-globals-top =
@@ -219,7 +219,7 @@
       )
 
   import-library =
-    <pack-stratego-parse-stratego> (IncludeFromPath(<id>), [])
+    <pack-stratego-parse-stratego; to-signatures> (IncludeFromPath(<id>), [])
 
    import-from-cache:
      str -> signatures

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-12 10:57:44 UTC (rev 20607)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-12 12:27:00 UTC (rev 20608)
@@ -300,7 +300,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -319,6 +320,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>



From L.C.L.Kats at tudelft.nl  Fri Feb 12 13:58:43 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 12:58:43 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20609 - LennartKats -
	in strc-java/trunk: test tools
Message-ID: <201002121258.o1CCwh7B016513@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 12:58:43 +0000 (Fri, 12 Feb 2010)
New Revision: 20609

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20609&view=rev

Modified:
   strc-java/trunk/test/Makefile.am
   strc-java/trunk/tools/strj-jar

Log:
Use UTF-8 encoding for Java compilation.

Changes:

Modified: strc-java/trunk/test/Makefile.am
===================================================================
--- strc-java/trunk/test/Makefile.am	2010-02-12 12:27:00 UTC (rev 20608)
+++ strc-java/trunk/test/Makefile.am	2010-02-12 12:58:43 UTC (rev 20609)
@@ -85,7 +85,7 @@
 TESTS=test-tools.sh $(RUNNERFILES)
 
 CLASSPATH=../java/spoofax-libs.jar:../java/bin:../java/strategoxt.jar:.
-JAVACFLAGS=-J-Xmx256m -J-XX:+UseParallelGC -cp $(CLASSPATH) -source 5 -nowarn
+JAVACFLAGS=-J-Xmx256m -J-XX:+UseParallelGC -cp $(CLASSPATH) -source 5 -nowarn -encoding UTF-8
 JAVAC=`if which ecj >/dev/null; then echo ecj; else echo javac; fi`
 
 ../trans/strj : .PURPLEPONY

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-12 12:27:00 UTC (rev 20608)
+++ strc-java/trunk/tools/strj-jar	2010-02-12 12:58:43 UTC (rev 20609)
@@ -7,7 +7,7 @@
 JAR=`if which fastjar &>/dev/null; then echo fastjar; else echo jar; fi`
 JAVAC=`if which ecj &>/dev/null; then echo ecj; else echo javac; fi`
 if [ "$JAVAFLAGS" == "" ]; then
-  JAVACFLAGS="-J-Xmx256m -J-Xms100m -J-server -J-XX:+UseParallelGC"
+  JAVACFLAGS="-J-Xmx256m -J-Xms100m -J-server -J-XX:+UseParallelGC -encoding UTF-8"
 fi
 
 [ "$TEMP" != "" ] || TEMP=/tmp



From L.C.L.Kats at tudelft.nl  Fri Feb 12 14:34:34 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 13:34:34 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20610 - LennartKats -
	strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode
Message-ID: <201002121334.o1CDYYmN016962@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 13:34:33 +0000 (Fri, 12 Feb 2010)
New Revision: 20610

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20610&view=rev

Modified:
   strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str

Log:
Fixed an {indentpadding} regression.

Changes:

Modified: strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str
===================================================================
--- strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str	2010-02-12 12:58:43 UTC (rev 20609)
+++ strategoxt/trunk/stratego-libraries/sglr/lib/stratego/asfix/implode/indent-padding.str	2010-02-12 13:34:33 UTC (rev 20610)
@@ -24,7 +24,7 @@
     appl(prod(_, _, attrs([term(indentpadding())])), _) -> <id> {PaddingId(<new>)}
     
   ImplodePaddedLexical :
-    appl(prod(_, _, attrs(term(indentpadding()))), _) -> AddPadding(imploded) {PaddingContext(<id>)}
+    appl(prod(_, _, attrs([term(indentpadding())])), _) -> AddPadding(imploded) {PaddingContext(<id>)}
     with
       imploded := <asfix-yield-appl>
 



From L.C.L.Kats at tudelft.nl  Fri Feb 12 15:14:40 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 14:14:40 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20611 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002121414.o1CEEe46017476@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 14:14:40 +0000 (Fri, 12 Feb 2010)
New Revision: 20611

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20611&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:


Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-12 13:34:33 UTC (rev 20610)
+++ strc-java/trunk/tools/strj-jar	2010-02-12 14:14:40 UTC (rev 20611)
@@ -14,7 +14,7 @@
 TEMPDIR=$TEMP/strj-jar-`date +'%N'`
 
 if which strj-jar &>/dev/null; then
-  CLASSPATH=`dirname "$(cd ${0%/*}/.. && echo $PWD/${0##*/})"`/share/strc-java/strategoxt.jar
+  CLASSPATH="$(cd ${0%/*}/.. && pwd)"/share/strc-java/strategoxt.jar
 fi
 
 if [ ! -e $CLASSPATH ]; then



From L.C.L.Kats at tudelft.nl  Fri Feb 12 17:57:32 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 16:57:32 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20612 - LennartKats -
	strc-java/trunk/trans
Message-ID: <201002121657.o1CGvWTR019461@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 16:57:31 +0000 (Fri, 12 Feb 2010)
New Revision: 20612

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20612&view=rev

Modified:
   strc-java/trunk/trans/strj-options.str

Log:
buildfix

Changes:

Modified: strc-java/trunk/trans/strj-options.str
===================================================================
--- strc-java/trunk/trans/strj-options.str	2010-02-12 14:14:40 UTC (rev 20611)
+++ strc-java/trunk/trans/strj-options.str	2010-02-12 16:57:31 UTC (rev 20612)
@@ -32,7 +32,7 @@
       strj-options
     )
   //; display-version
-  ; if not(<get-config> "-o" + output-dirname) then
+  ; if not(output-dirname); <get-config> "-o" then
       fatal-err-msg(|"Illegal output directory")
     end
   ; if <get-config> "-o"; base-filename; not(<eq> (<id>, <jify>)); not(<get-config> "-F") then



From L.C.L.Kats at tudelft.nl  Fri Feb 12 18:04:18 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 12 Feb 2010 17:04:18 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20613 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.generator/src/sdf2imp/project
Message-ID: <201002121704.o1CH4Itn019699@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-12 17:04:18 +0000 (Fri, 12 Feb 2010)
New Revision: 20613

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20613&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str

Log:
typo

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-12 17:04:18 UTC (rev 20613)
@@ -225,7 +225,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -244,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-12 17:04:18 UTC (rev 20613)
@@ -225,7 +225,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -244,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-12 17:04:18 UTC (rev 20613)
@@ -225,7 +225,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -244,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-12 17:04:18 UTC (rev 20613)
@@ -225,7 +225,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -244,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-12 17:04:18 UTC (rev 20613)
@@ -225,7 +225,8 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>
+                    <include name="**/*.str"/>>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -244,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-12 16:57:31 UTC (rev 20612)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-12 17:04:18 UTC (rev 20613)
@@ -300,7 +300,7 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
+                    <include name="**/*.str"/>
                     <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>



From R.B.Vermaas at tudelft.nl  Mon Feb 15 12:47:17 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Mon, 15 Feb 2010 11:47:17 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20614 - rob -
	hydra/webdsl
Message-ID: <201002151147.o1FBlHUL012684@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-15 11:47:16 +0000 (Mon, 15 Feb 2010)
New Revision: 20614

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20614&view=rev

Modified:
   hydra/webdsl/tests.nix

Log:
make local path writable

Changes:

Modified: hydra/webdsl/tests.nix
===================================================================
--- hydra/webdsl/tests.nix	2010-02-12 17:04:18 UTC (rev 20613)
+++ hydra/webdsl/tests.nix	2010-02-15 11:47:16 UTC (rev 20614)
@@ -18,6 +18,7 @@
         header "Copying sources"        
         cp -vR ${researchrSrc}/* .
         cp -v ${./application.ini} application.ini
+        chmod -R 755 . 
 
         header "Building"
         webdsl build        



From R.B.Vermaas at tudelft.nl  Mon Feb 15 13:15:09 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Mon, 15 Feb 2010 12:15:09 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20615 - rob -
	strc-java/trunk
Message-ID: <201002151215.o1FCF9wr013183@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-15 12:15:09 +0000 (Mon, 15 Feb 2010)
New Revision: 20615

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20615&view=rev

Modified:
   strc-java/trunk/bootstrap

Log:
dummy commit

Changes:

Modified: strc-java/trunk/bootstrap
===================================================================
--- strc-java/trunk/bootstrap	2010-02-15 11:47:16 UTC (rev 20614)
+++ strc-java/trunk/bootstrap	2010-02-15 12:15:09 UTC (rev 20615)
@@ -14,3 +14,4 @@
 autoxt
 auto-java-front
 autoreconf -ifv
+



From L.C.L.Kats at tudelft.nl  Mon Feb 15 14:24:21 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 15 Feb 2010 13:24:21 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20616 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.feature
	org.strategoxt.imp.generator/src/sdf2imp/services
Message-ID: <201002151324.o1FDOLVx014132@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-15 13:24:20 +0000 (Mon, 15 Feb 2010)
New Revision: 20616

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20616&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-builders-descriptor.str

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -225,7 +225,7 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
+                    <include name="**/*.str"/>
                     <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available">
+        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,7 +80,6 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
-            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -95,7 +94,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available">
+        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -127,7 +126,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available">
+        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -148,7 +147,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -173,7 +172,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available">
+        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -192,41 +191,11 @@
             </java>
         </target>
     
-        <!-- Aster to Stratego -->
-        <target name="stratego.aster">
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
-            <dependset>
-                <srcfileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </srcfileset>
-                <targetfileset file="${trans}/${strmodule}.rtree"/>
-            </dependset>
-            <condition property="aster-output.uptodate">
-                <and>
-                    <isset property="aster-output.available"/>
-                    <available file="${trans}/${strmodule}.rtree"/>
-                </and>
-            </condition>
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
-            <antcall target="stratego.aster.helper"/>
-        </target>
-    
-        <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
-                <arg value="-i"/>
-                <fileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </fileset>
-            </apply>
-        </target>
-    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.str"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +214,6 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -260,7 +228,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available">
+        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,7 +80,6 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
-            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -95,7 +94,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available">
+        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -127,7 +126,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available">
+        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -148,7 +147,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -173,7 +172,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available">
+        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -192,41 +191,11 @@
             </java>
         </target>
     
-        <!-- Aster to Stratego -->
-        <target name="stratego.aster">
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
-            <dependset>
-                <srcfileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </srcfileset>
-                <targetfileset file="${trans}/${strmodule}.rtree"/>
-            </dependset>
-            <condition property="aster-output.uptodate">
-                <and>
-                    <isset property="aster-output.available"/>
-                    <available file="${trans}/${strmodule}.rtree"/>
-                </and>
-            </condition>
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
-            <antcall target="stratego.aster.helper"/>
-        </target>
-    
-        <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
-                <arg value="-i"/>
-                <fileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </fileset>
-            </apply>
-        </target>
-    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.str"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +214,6 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -260,7 +228,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -225,7 +225,7 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
+                    <include name="**/*.str"/>
                     <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -225,7 +225,7 @@
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
-                    <include name="**/*.str"/>>
+                    <include name="**/*.str"/>
                     <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-15 13:24:20 UTC (rev 20616)
@@ -32,6 +32,45 @@
          id="org.eclipse.pde"
          version="0.0.0"/>
 
+   <requires>
+      <import plugin="org.eclipse.core.runtime"/>
+      <import plugin="org.eclipse.core.resources"/>
+      <import plugin="org.junit"/>
+      <import plugin="org.eclipse.swt"/>
+      <import plugin="org.eclipse.jface"/>
+      <import plugin="org.eclipse.jface.text"/>
+      <import plugin="org.eclipse.ui.editors"/>
+      <import plugin="org.eclipse.ui.workbench"/>
+      <import plugin="org.eclipse.ui"/>
+      <import plugin="org.eclipse.ui.ide"/>
+      <import plugin="org.eclipse.ant.core"/>
+      <import plugin="org.eclipse.ui.console"/>
+      <import plugin="org.eclipse.debug.ui"/>
+      <import plugin="org.junit4"/>
+      <import plugin="org.eclipse.compare"/>
+      <import plugin="org.eclipse.core.filesystem"/>
+      <import plugin="org.eclipse.debug.core"/>
+      <import plugin="org.eclipse.help"/>
+      <import plugin="org.eclipse.ltk.core.refactoring"/>
+      <import plugin="org.eclipse.ltk.ui.refactoring"/>
+      <import plugin="org.eclipse.ui.navigator"/>
+      <import plugin="org.eclipse.ui.views"/>
+      <import plugin="org.eclipse.ui.workbench.texteditor"/>
+      <import plugin="org.eclipse.jdt.core"/>
+      <import plugin="org.eclipse.osgi"/>
+      <import plugin="org.eclipse.jdt.ui"/>
+      <import plugin="org.eclipse.pde.ui"/>
+      <import plugin="org.eclipse.ui.forms"/>
+      <import plugin="org.eclipse.search"/>
+      <import plugin="org.eclipse.pde"/>
+      <import plugin="org.eclipse.ui.cheatsheets"/>
+      <import plugin="org.eclipse.pde.core"/>
+      <import plugin="org.eclipse.help.ui"/>
+      <import plugin="org.eclipse.jdt.debug"/>
+      <import plugin="org.eclipse.jdt.launching"/>
+      <import plugin="org.eclipse.core.variables"/>
+   </requires>
+
    <plugin
          id="org.strategoxt.imp.metatooling"
          download-size="0"

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-builders-descriptor.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-builders-descriptor.str	2010-02-15 12:15:09 UTC (rev 20615)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-builders-descriptor.str	2010-02-15 13:24:20 UTC (rev 20616)
@@ -26,8 +26,8 @@
           ~~
           provider: ~provider
           observer: editor-analyze
-          builder: "Generate Java code" = generate-java  (openeditor) (realtime)
-          builder: "Show ATerm"         = generate-aterm (openeditor) (realtime) (meta)
+          builder: "Generate Java code"   = generate-java  (openeditor) (realtime)
+          builder: "Show abstract syntax" = generate-aterm (openeditor) (realtime) (meta)
       ]|
     );
     



From L.C.L.Kats at tudelft.nl  Mon Feb 15 16:34:27 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 15 Feb 2010 15:34:27 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20618 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/wizards
Message-ID: <201002151534.o1FFYR71015650@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-15 15:34:27 +0000 (Mon, 15 Feb 2010)
New Revision: 20618

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20618&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/wizards/NewEditorWizardPage.java

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-15 15:34:19 UTC (rev 20617)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-15 15:34:27 UTC (rev 20618)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available">
+        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,7 +80,6 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
-            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -95,7 +94,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available">
+        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -127,7 +126,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available">
+        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -148,7 +147,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -173,7 +172,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available">
+        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -192,41 +191,11 @@
             </java>
         </target>
     
-        <!-- Aster to Stratego -->
-        <target name="stratego.aster">
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
-            <dependset>
-                <srcfileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </srcfileset>
-                <targetfileset file="${trans}/${strmodule}.rtree"/>
-            </dependset>
-            <condition property="aster-output.uptodate">
-                <and>
-                    <isset property="aster-output.available"/>
-                    <available file="${trans}/${strmodule}.rtree"/>
-                </and>
-            </condition>
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
-            <antcall target="stratego.aster.helper"/>
-        </target>
-    
-        <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
-                <arg value="-i"/>
-                <fileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </fileset>
-            </apply>
-        </target>
-    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +214,6 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -260,7 +228,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-15 15:34:19 UTC (rev 20617)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-15 15:34:27 UTC (rev 20618)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available">
+        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,7 +80,6 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
-            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -95,7 +94,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available">
+        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -127,7 +126,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available">
+        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -148,7 +147,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -173,7 +172,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available">
+        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -192,41 +191,11 @@
             </java>
         </target>
     
-        <!-- Aster to Stratego -->
-        <target name="stratego.aster">
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
-            <dependset>
-                <srcfileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </srcfileset>
-                <targetfileset file="${trans}/${strmodule}.rtree"/>
-            </dependset>
-            <condition property="aster-output.uptodate">
-                <and>
-                    <isset property="aster-output.available"/>
-                    <available file="${trans}/${strmodule}.rtree"/>
-                </and>
-            </condition>
-            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
-            <antcall target="stratego.aster.helper"/>
-        </target>
-    
-        <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
-                <arg value="-i"/>
-                <fileset dir="${basedir}">
-                    <include name="**/*.astr"/>
-                </fileset>
-            </apply>
-        </target>
-    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +214,6 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -260,7 +228,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/wizards/NewEditorWizardPage.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/wizards/NewEditorWizardPage.java	2010-02-15 15:34:19 UTC (rev 20617)
+++ spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/wizards/NewEditorWizardPage.java	2010-02-15 15:34:27 UTC (rev 20618)
@@ -140,21 +140,21 @@
 			ignoreEvents = false;
 			distributeLanguageName();
 		}
-		if (!isInputExtensionsChanged || getInputExtensions().length() == 0
-				|| getInputExtensions().equals(toExtension(getInputProjectName()))) {
+		if (!isInputPackageNameChanged || getInputPackageName().length() == 0
+				|| getInputPackageName().equals(toPackageName(getInputProjectName()))) {
 			ignoreEvents = true;
-			inputExtensions.setText(toExtension(getInputProjectName()));
-			isInputExtensionsChanged = false;
+			inputPackageName.setText(toPackageName(getInputProjectName()));
+			isInputPackageNameChanged = false;
 			ignoreEvents = false;
 		}
 	}
 
 	private void distributeLanguageName() {
-		if (!isInputPackageNameChanged || getInputPackageName().length() == 0
-				|| getInputPackageName().equals(toPackageName(getInputLanguageName()))) {
+		if (!isInputExtensionsChanged || getInputExtensions().length() == 0
+				|| getInputExtensions().equals(toExtension(getInputLanguageName()))) {
 			ignoreEvents = true;
-			inputPackageName.setText(toPackageName(getInputLanguageName()));
-			isInputPackageNameChanged = false;
+			inputExtensions.setText(toExtension(getInputLanguageName()));
+			isInputExtensionsChanged = false;
 			ignoreEvents = false;
 		}
 	}



From L.C.L.Kats at tudelft.nl  Mon Feb 15 16:34:19 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 15 Feb 2010 15:34:19 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20617 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/syntax
Message-ID: <201002151534.o1FFYJeE015647@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-15 15:34:19 +0000 (Mon, 15 Feb 2010)
New Revision: 20617

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20617&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/syntax/ATerm.def

Log:
Fixed ATerm syntax ambiguity (regression)

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/syntax/ATerm.def
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/syntax/ATerm.def	2010-02-15 13:24:20 UTC (rev 20616)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/syntax/ATerm.def	2010-02-15 15:34:19 UTC (rev 20617)
@@ -116,7 +116,7 @@
 	trm:ATerm Annotation 			-> ATerm {cons("annotated")}
 
   lexical syntax
-    ~[]* -> NoAFun %% added for tuple support
+     -> NoAFun %% added for tuple support
 
   context-free syntax
 	"{" annos:{ ATerm ","}+ "}" 		-> Annotation {cons("default")}



From L.C.L.Kats at tudelft.nl  Tue Feb 16 14:00:08 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Tue, 16 Feb 2010 13:00:08 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20619 - LennartKats -
	in spoofax-imp/trunk:
	org.strategoxt.imp.generator/src/sdf2imp/services
	org.strategoxt.imp.runtime
Message-ID: <201002161300.o1GD08Le001298@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-16 13:00:07 +0000 (Tue, 16 Feb 2010)
New Revision: 20619

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20619&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str
   spoofax-imp/trunk/org.strategoxt.imp.runtime/plugin.xml

Log:
Added secondary, control-based shortcut keys for OSX

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str	2010-02-15 15:34:27 UTC (rev 20618)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str	2010-02-16 13:00:07 UTC (rev 20619)
@@ -39,12 +39,14 @@
         
         folding Default folding definitions
           ~
-          ~// Folding rules indicate grammar productions to be foldable,
-          ~// and take one of the following forms, and :
+          ~// Folding rules indicate which syntactic constructs can be folded,
+          ~// and take one of the following forms:
           ~//
-          ~//   - <sort>.<constructor>
-          ~//   - <sort>._,
-          ~//   - _.<constructor>
+          ~//   <sort>.<constructor>
+          ~//
+          ~//   <sort>._
+          ~//
+          ~//   _.<constructor>
           ~
           ~*<id>
       ]|

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/plugin.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/plugin.xml	2010-02-15 15:34:27 UTC (rev 20618)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/plugin.xml	2010-02-16 13:00:07 UTC (rev 20619)
@@ -274,11 +274,21 @@
             schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
             sequence="M1+T"/>
       <key
+            commandId="org.strategoxt.imp.runtime.transformCommand"
+            contextId="org.eclipse.ui.textEditorScope"
+            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
+            sequence="CTRL+T"/>
+      <key
             commandId="org.eclipse.ui.project.buildProject"
             contextId="org.eclipse.ui.contexts.window"
             sequence="M1+M3+B"
             schemeId="org.eclipse.ui.defaultAcceleratorConfiguration" />
       <key
+            commandId="org.eclipse.ui.project.buildProject"
+            contextId="org.eclipse.ui.contexts.window"
+            sequence="CTRL+ALT+B"
+            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration" />
+      <key
             commandId="org.strategoxt.imp.runtime.resolveReferenceCommand"
             contextId="org.eclipse.ui.textEditorScope"
             schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"



From L.C.L.Kats at tudelft.nl  Wed Feb 17 13:29:53 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 12:29:53 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20620 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171229.o1HCTrnY019352@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 12:29:52 +0000 (Wed, 17 Feb 2010)
New Revision: 20620

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20620&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:
added debugging message

Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-16 13:00:07 UTC (rev 20619)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 12:29:52 UTC (rev 20620)
@@ -19,6 +19,7 @@
 
 if [ ! -e $CLASSPATH ]; then
   echo Warning: $CLASSPATH not found >&2
+  echo "(invoked as %0; available as `which strj-jar`) ">&2
 fi
 
 ## PARAMETERS



From L.C.L.Kats at tudelft.nl  Wed Feb 17 13:30:23 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 12:30:23 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20621 - LennartKats -
	in spoofax-imp/trunk/org.strategoxt.imp.generator/src:
	sdf2imp/services syntax
Message-ID: <201002171230.o1HCUNRq019369@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 12:30:23 +0000 (Wed, 17 Feb 2010)
New Revision: 20621

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20621&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/EditorService-pretty.pp
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/FoldingService.sdf

Log:
(disable) annotation is now (disabled)

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str	2010-02-17 12:29:52 UTC (rev 20620)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-folding-descriptor.str	2010-02-17 12:30:23 UTC (rev 20621)
@@ -47,6 +47,15 @@
           ~//   <sort>._
           ~//
           ~//   _.<constructor>
+          ~//
+          ~// To indicate that an element should always be folded, add
+          ~// a (folded) annotation:
+          ~//
+          ~//   _.Imports (folded)
+          ~//
+          ~// To disable a folding rule defined elsewhere, add a (disabled) annotation:
+          ~//
+          ~//   Definition._ (disabled)
           ~
           ~*<id>
       ]|

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/EditorService-pretty.pp
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/EditorService-pretty.pp	2010-02-17 12:29:52 UTC (rev 20620)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/EditorService-pretty.pp	2010-02-17 12:30:23 UTC (rev 20621)
@@ -37,7 +37,7 @@
    AttributeRef         -- _1,
    FoldRuleAll          -- H [ KW["all"] _1 _2 ],
    FoldRule             -- H [ _1 _2 ],
-   Disable              -- KW["(disable)"],
+   Disable              -- KW["(disabled)"],
    Folded               -- KW["(folded)"],
    None                 -- ,
    OutlineRule          -- _1,

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/FoldingService.sdf
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/FoldingService.sdf	2010-02-17 12:29:52 UTC (rev 20620)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/syntax/FoldingService.sdf	2010-02-17 12:30:23 UTC (rev 20621)
@@ -21,6 +21,7 @@
           Node FoldingAnno -> FoldingRule {cons("FoldRule")}
     "all" Node FoldingAnno -> FoldingRule {cons("FoldRuleAll")}
 
-    "(disable)" -> FoldingAnno {cons("Disable")}
-    "(folded)"  -> FoldingAnno {cons("Folded")}
-                -> FoldingAnno {cons("None")}
+    "(disable)"  -> FoldingAnno {cons("Disable"), deprecated("Use (disabled) instead")}
+    "(disabled)" -> FoldingAnno {cons("Disable")}
+    "(folded)"   -> FoldingAnno {cons("Folded")}
+                 -> FoldingAnno {cons("None")}



From L.C.L.Kats at tudelft.nl  Wed Feb 17 15:49:22 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 14:49:22 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20622 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171449.o1HEnMTY021209@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 14:49:22 +0000 (Wed, 17 Feb 2010)
New Revision: 20622

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20622&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:


Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-17 12:30:23 UTC (rev 20621)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 14:49:22 UTC (rev 20622)
@@ -19,7 +19,7 @@
 
 if [ ! -e $CLASSPATH ]; then
   echo Warning: $CLASSPATH not found >&2
-  echo "(invoked as %0; available as `which strj-jar`) ">&2
+  echo "(invoked as $0; available as `which strj-jar`) ">&2
 fi
 
 ## PARAMETERS



From L.C.L.Kats at tudelft.nl  Wed Feb 17 16:30:54 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 15:30:54 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20623 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171530.o1HFUsLJ021871@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 15:30:53 +0000 (Wed, 17 Feb 2010)
New Revision: 20623

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20623&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:
attempt to simplify strj-jar's jar lookup

Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-17 14:49:22 UTC (rev 20622)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 15:30:53 UTC (rev 20623)
@@ -14,7 +14,7 @@
 TEMPDIR=$TEMP/strj-jar-`date +'%N'`
 
 if which strj-jar &>/dev/null; then
-  CLASSPATH="$(cd ${0%/*}/.. && pwd)"/share/strc-java/strategoxt.jar
+  CLASSPATH="$(cd `dirname $0`/.. && pwd)"/share/strc-java/strategoxt.jar
 fi
 
 if [ ! -e $CLASSPATH ]; then



From L.C.L.Kats at tudelft.nl  Wed Feb 17 16:31:59 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 15:31:59 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20624 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171531.o1HFVxUo021882@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 15:31:58 +0000 (Wed, 17 Feb 2010)
New Revision: 20624

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20624&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:


Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-17 15:30:53 UTC (rev 20623)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 15:31:58 UTC (rev 20624)
@@ -14,7 +14,7 @@
 TEMPDIR=$TEMP/strj-jar-`date +'%N'`
 
 if which strj-jar &>/dev/null; then
-  CLASSPATH="$(cd `dirname $0`/.. && pwd)"/share/strc-java/strategoxt.jar
+  CLASSPATH="$(cd `dirname "$0"`/.. && pwd)"/share/strc-java/strategoxt.jar
 fi
 
 if [ ! -e $CLASSPATH ]; then



From L.C.L.Kats at tudelft.nl  Wed Feb 17 16:34:27 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 15:34:27 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20625 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171534.o1HFYRPB021898@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 15:34:27 +0000 (Wed, 17 Feb 2010)
New Revision: 20625

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20625&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:


Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-17 15:31:58 UTC (rev 20624)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 15:34:27 UTC (rev 20625)
@@ -13,9 +13,7 @@
 [ "$TEMP" != "" ] || TEMP=/tmp
 TEMPDIR=$TEMP/strj-jar-`date +'%N'`
 
-if which strj-jar &>/dev/null; then
-  CLASSPATH="$(cd `dirname "$0"`/.. && pwd)"/share/strc-java/strategoxt.jar
-fi
+CLASSPATH="$(cd `dirname "$0"`/.. && pwd)"/share/strc-java/strategoxt.jar
 
 if [ ! -e $CLASSPATH ]; then
   echo Warning: $CLASSPATH not found >&2



From L.C.L.Kats at tudelft.nl  Wed Feb 17 16:36:02 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 15:36:02 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20626 - LennartKats -
	strc-java/trunk/tools
Message-ID: <201002171536.o1HFa22j021915@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 15:36:02 +0000 (Wed, 17 Feb 2010)
New Revision: 20626

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20626&view=rev

Modified:
   strc-java/trunk/tools/strj-jar

Log:


Changes:

Modified: strc-java/trunk/tools/strj-jar
===================================================================
--- strc-java/trunk/tools/strj-jar	2010-02-17 15:34:27 UTC (rev 20625)
+++ strc-java/trunk/tools/strj-jar	2010-02-17 15:36:02 UTC (rev 20626)
@@ -4,8 +4,8 @@
 
 PRINT_CLASSPATH=
 CLASSPATH=strategoxt.jar # override with option -cp
-JAR=`if which fastjar &>/dev/null; then echo fastjar; else echo jar; fi`
-JAVAC=`if which ecj &>/dev/null; then echo ecj; else echo javac; fi`
+JAR=`if type -p fastjar &>/dev/null; then echo fastjar; else echo jar; fi`
+JAVAC=`if type -p ecj &>/dev/null; then echo ecj; else echo javac; fi`
 if [ "$JAVAFLAGS" == "" ]; then
   JAVACFLAGS="-J-Xmx256m -J-Xms100m -J-server -J-XX:+UseParallelGC -encoding UTF-8"
 fi
@@ -17,7 +17,7 @@
 
 if [ ! -e $CLASSPATH ]; then
   echo Warning: $CLASSPATH not found >&2
-  echo "(invoked as $0; available as `which strj-jar`) ">&2
+  echo "(invoked as $0; available as `type -p strj-jar`) ">&2
 fi
 
 ## PARAMETERS



From L.C.L.Kats at tudelft.nl  Wed Feb 17 18:22:38 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 17 Feb 2010 17:22:38 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20627 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.generator/src/sdf2imp/project
	org.strategoxt.imp.generator/src/sdf2imp/services
Message-ID: <201002171722.o1HHMchD023316@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-17 17:22:38 +0000 (Wed, 17 Feb 2010)
New Revision: 20627

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20627&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-outliner-descriptor.str

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-17 17:22:38 UTC (rev 20627)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -191,11 +192,41 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -214,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -228,7 +260,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-17 17:22:38 UTC (rev 20627)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -191,11 +192,41 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -214,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -228,7 +260,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-17 17:22:38 UTC (rev 20627)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -191,11 +192,41 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -214,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -228,7 +260,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-17 17:22:38 UTC (rev 20627)
@@ -2,7 +2,7 @@
 
 <project name="build.generated">
     
-        <target name="spoofaximp.default" depends="sdf2table,ppgen,stratego.ctree,sdf2imp"/>
+        <target name="spoofaximp.default" depends="utils-files,sdf2table,ppgen,stratego.aster,stratego.ctree,sdf2imp"/>
     
         <!-- Initialization -->
         <available file="${trans}/${strmodule}.str" property="build.stratego.enabled"/>
@@ -33,7 +33,7 @@
             </java>
         </target>
         
-        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg,utils-files">
+        <target name="sdf2imp.standalone" unless="eclipse.running" depends="sdf2rtg">
             <echo message="Property eclipse.running is not set; assuming Eclipse is not running"/>
             <java classname="org.strategoxt.imp.generator.sdf2imp" failonerror="true">
                 <arg value="-i"/>
@@ -66,7 +66,7 @@
             <antcall target="make-permissive.helper"/>
         </target>
     
-        <target name="make-permissive.helper" unless="permissive-grammar.available" depends="utils-files">
+        <target name="make-permissive.helper" unless="permissive-grammar.available">
             <java classname="org.strategoxt.permissivegrammars.make_permissive" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${include}/${sdfmodule}.def"/>
@@ -80,6 +80,7 @@
             <mkdir dir="utils"/>
             <copy file="${eclipse.spoofaximp.jars}/make_permissive.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.jars}/sdf2imp.jar" todir="utils" failonerror="false"/>
+            <copy file="${eclipse.spoofaximp.jars}/aster.jar" todir="utils" failonerror="false"/>
             <copy file="${eclipse.spoofaximp.strategojar}" todir="utils" failonerror="false"/>
         </target>
     
@@ -94,7 +95,7 @@
             <antcall target="pack-sdf.helper"/>
         </target>
     
-        <target name="pack-sdf.helper" unless="pack-sdf.available" depends="utils-files">
+        <target name="pack-sdf.helper" unless="pack-sdf.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-pack-sdf"/>
                 <arg value="-i"/>
@@ -126,7 +127,7 @@
             <antcall target="rtg2sig.helper"/>
         </target>
     
-        <target name="rtg2sig.helper" unless="rtg2sig.available" depends="utils-files">
+        <target name="rtg2sig.helper" unless="rtg2sig.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-rtg2sig"/>
                 <arg value="-i"/>
@@ -147,7 +148,7 @@
             <antcall target="sdf2rtg.helper"/>
         </target>
     
-        <target name="sdf2rtg.helper" unless="sdf2rtg.available" depends="utils-files">
+        <target name="sdf2rtg.helper" unless="sdf2rtg.available">
             <java classname="start" failonerror="true">
                 <arg value="org.strategoxt.tools.main-sdf2rtg"/>
                 <arg value="-i"/>
@@ -172,7 +173,7 @@
             <antcall target="ppgen.helper"/>
         </target>
     
-        <target name="ppgen.helper" unless="ppgen.available" depends="utils-files">
+        <target name="ppgen.helper" unless="ppgen.available">
             <!-- Any failures here are ignored; they are only a problem when imported from Stratego -->
             <java classname="start" failonerror="false">
                 <arg value="org.strategoxt.tools.main-ppgen"/>
@@ -191,11 +192,41 @@
             </java>
         </target>
     
+        <!-- Aster to Stratego -->
+        <target name="stratego.aster">
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.available"/>
+            <dependset>
+                <srcfileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </srcfileset>
+                <targetfileset file="${trans}/${strmodule}.rtree"/>
+            </dependset>
+            <condition property="aster-output.uptodate">
+                <and>
+                    <isset property="aster-output.available"/>
+                    <available file="${trans}/${strmodule}.rtree"/>
+                </and>
+            </condition>
+            <available file="${trans}/${strmodule}.rtree" property="aster-output.uptodate"/>
+            <antcall target="stratego.aster.helper"/>
+        </target>
+    
+        <target name="stratego.aster.helper" unless="aster-output.uptodate">
+            <apply executable="java">
+                <arg line="-jar utils/aster.jar"/>
+                <arg value="-i"/>
+                <fileset dir="${basedir}">
+                    <include name="**/*.astr"/>
+                </fileset>
+            </apply>
+        </target>
+    
         <!-- Stratego to Java interpreter -->
         <target name="stratego.ctree" depends="rtg2sig">
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -214,6 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
+                    <include name="**/*.rtree"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -228,7 +260,7 @@
             <jar basedir="${build}" includes="trans/**" destfile="${include}/${strmodule}.jar"/>
         </target>
             
-        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled" depends="utils-files">
+        <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-17 17:22:38 UTC (rev 20627)
@@ -149,14 +149,17 @@
 rules
 
   // Analysis: does a topdown traversal of the tree,
-  // and try to apply the record-entity rule.
-  analyze =
-    topdown(try(record-entity))
+  // and tries to apply the record-entity rule.
+  analyze:
+    t -> t
+    with
+      <topdown(try(record-entity))> t
 
   // Records the definition of an entity in a dynamic rule GetEntity.
   record-entity:
     Entity(x, body) -> Entity(x, body)
     with
+      // For a name 'x', GetEntity will return the original 'x' tree node
       rules(
         GetEntity :+ x -> x
       )

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-outliner-descriptor.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-outliner-descriptor.str	2010-02-17 15:36:02 UTC (rev 20626)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/services/create-outliner-descriptor.str	2010-02-17 17:22:38 UTC (rev 20627)
@@ -40,12 +40,14 @@
         
         outliner Default outliner        
           ~
-          ~// Outliner rules indicate grammar productions to be outlined,
-          ~// and take one of the following forms, and :
+          ~// Outliner rules indicate which syntactic constructs should be shown in the outline
+          ~// and quick outline views, and take one of the following forms:
           ~//
-          ~//   - <sort>.<constructor>
-          ~//   - <sort>._,
-          ~//   - _.<constructor>
+          ~//   <sort>.<constructor>
+          ~//
+          ~//   <sort>._
+          ~//
+          ~//   _.<constructor>
           ~
           ~*<id>
       ]|



From L.C.L.Kats at tudelft.nl  Fri Feb 19 14:24:56 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 19 Feb 2010 13:24:56 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20628 - LennartKats -
	in spoofax-imp/trunk:
	org.strategoxt.imp.generator/src/sdf2imp/project
	org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services
Message-ID: <201002191324.o1JDOuPV028804@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-19 13:24:56 +0000 (Fri, 19 Feb 2010)
New Revision: 20628

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20628&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java

Log:
- Added 'parse-file' and 'parse-string' convenience strategies that use the current project's parse table
- Simplified the content proposal Stratego interface a bit after a taking a fresh look at it while building the Tour

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-17 17:22:38 UTC (rev 20627)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-19 13:24:56 UTC (rev 20628)
@@ -76,13 +76,9 @@
   // (the completion identifier in the AST provides additional context information)
   editor-complete:
     (Type(COMPLETION(prefix)), position, ast, path, project-path) ->
-    [(["String"], ""), (["Int"], "") | proposals]
+    ["String", "Int" | proposals]
     where
-      all-entities := <all-keys-GetEntity>;
-      proposals    := <map(entity-name-to-proposal)> all-entities
-
-  entity-name-to-proposal:
-    x -> ([x], "")
+      proposals := <all-keys-GetEntity>
 };
 
 if not(<file-exists> "trans/generate.str") then
@@ -204,8 +200,20 @@
 <output-text-file(|["lib"], "editor-common.str")>
 ${module lib/editor-common
 
+imports
+  libstratego-lib
+  libstratego-sglr
+
 strategies
 
+  parse-file =
+    parse-file(|<import-term(include/{sdf-name}.tbl)>)
+
+  parse-string =
+    parse-string(|<import-term(include/{sdf-name}.tbl)>)
+  
+strategies
+
   desugar-position(desugar|ast):
     position -> position'
     where

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-17 17:22:38 UTC (rev 20627)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-19 13:24:56 UTC (rev 20628)
@@ -38,6 +38,7 @@
 import org.strategoxt.imp.runtime.parser.ast.ListAstNode;
 import org.strategoxt.imp.runtime.parser.ast.RootAstNode;
 import org.strategoxt.imp.runtime.parser.ast.StringAstNode;
+import org.strategoxt.imp.runtime.stratego.adapter.WrappedAstNodeFactory;
 import org.strategoxt.lang.terms.TermFactory;
 
 /**
@@ -232,22 +233,40 @@
 
 		if (proposals.getTermType() != LIST)
 			return createErrorProposal(error, offset);
-		
+
+		WrappedAstNodeFactory factory = Environment.getTermFactory();
+		IStrategoString emptyString = factory.makeString("");
 		Region offsetRegion = new Region(offset, 0);
 		Set<ICompletionProposal> results = getKeywordProposals(document, currentCompletionPrefix, offsetRegion, offset);
 
 		for (IStrategoList cons = (IStrategoList) proposals; !cons.isEmpty(); cons = cons.tail()) {
 			IStrategoTerm proposal = cons.head();
-			if (proposal.getTermType() != TUPLE || proposal.getSubtermCount() != 2
-					|| termAt(proposal, 0).getTermType() != LIST
-					|| termAt(proposal, 1).getTermType() != STRING)
-				return createErrorProposal(error, offset);
-			IStrategoList newTextParts = termAt(proposal, 0);
-			String newText = proposalPartsToString(newTextParts);
+			String newText;
+			IStrategoList newTextParts;
+			IStrategoString description;
+			
+			if (proposal.getTermType() == STRING) {
+				newTextParts = factory.makeList(proposal);
+				newText = ((IStrategoString) proposal).stringValue();
+				description = emptyString;
+			} else {
+				IStrategoTerm newTextTerm = termAt(proposal, 0);
+				if (proposal.getTermType() != TUPLE || proposal.getSubtermCount() != 2
+						|| (newTextTerm.getTermType() != LIST && termAt(proposal, 0).getTermType() != STRING)
+						|| termAt(proposal, 1).getTermType() != STRING)
+					return createErrorProposal(error, offset);
+				if (newTextTerm.getTermType() == LIST) {
+					newTextParts = (IStrategoList) newTextTerm;
+					newText = proposalPartsToString(newTextParts);
+				} else {
+					newTextParts = factory.makeList(newTextTerm);
+					newText = ((IStrategoString) newTextTerm).stringValue();
+				}
+				description = termAt(proposal, 1);
+			}
 			if (newTextParts.isEmpty() || !newText.startsWith(currentCompletionPrefix))
 				continue;
-			IStrategoString description = termAt(proposal, 1);
-			results.add(new ContentProposal(this, newText, newText, currentCompletionPrefix, offsetRegion, newTextParts, description.stringValue())); 
+			results.add(new ContentProposal(this, newText, newText, currentCompletionPrefix, offsetRegion, newTextParts, description.stringValue()));
 		}
 		
 		return toSortedArray(results);



From L.C.L.Kats at tudelft.nl  Fri Feb 19 14:48:21 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 19 Feb 2010 13:48:21 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20629 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser
Message-ID: <201002191348.o1JDmLBw029144@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-19 13:48:21 +0000 (Fri, 19 Feb 2010)
New Revision: 20629

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20629&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java

Log:
Spoofax/21: Cleaner syntax errors for single-line erroneous fragments

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java	2010-02-19 13:24:56 UTC (rev 20628)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java	2010-02-19 13:48:21 UTC (rev 20629)
@@ -401,10 +401,9 @@
 
 	private void reportSkippedFragment(char[] inputChars, SGLRTokenizer tokenizer, int beginSkipped, int endSkipped) {
 		IToken token = tokenizer.makeErrorToken(beginSkipped, endSkipped);
-		tokenizer.changeTokenKinds(beginSkipped, endSkipped, TokenKind.TK_LAYOUT, TokenKind.TK_ERROR);
-		reportErrorAtTokens(token, token, UNEXPECTED_REGION);
 		int line = token.getLine();
-		int endLine = token.getEndLine() + RegionRecovery.NR_OF_LINES_TILL_SUCCESS; 
+		int endLine = token.getEndLine() + RegionRecovery.NR_OF_LINES_TILL_SUCCESS;
+		boolean reportedErrors = false;
 		for (BadTokenException e : source.getParser().getParser().getCollectedErrors()) {
 			if (e.getLineNumber() >= line && e.getLineNumber() <= endLine) {
 				char[] processedChars = tokenizer.getLexStream().getInputChars();
@@ -412,8 +411,14 @@
 				tokenizer.getLexStream().setInputChars(inputChars);
 				reportError(tokenizer, (Exception) e); // use double dispatch
 				tokenizer.getLexStream().setInputChars(processedChars);
+				reportedErrors = true;
 			}
 		}
+		if (!reportedErrors || tokenizer.getLexStream().getLineNumberOfCharAt(beginSkipped) !=
+				tokenizer.getLexStream().getLineNumberOfCharAt(endSkipped)) {
+			tokenizer.changeTokenKinds(beginSkipped, endSkipped, TokenKind.TK_LAYOUT, TokenKind.TK_ERROR);
+			reportErrorAtTokens(token, token, UNEXPECTED_REGION);
+		}
 	}
 		
 	public void reportError(SGLRTokenizer tokenizer, TokenExpectedException exception) {



From L.C.L.Kats at tudelft.nl  Fri Feb 19 15:01:51 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 19 Feb 2010 14:01:51 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20630 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.feature
	org.strategoxt.imp.updatesite
Message-ID: <201002191401.o1JE1pgk029563@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-19 14:01:51 +0000 (Fri, 19 Feb 2010)
New Revision: 20630

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20630&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml

Log:
New version 0.3.3

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-19 13:48:21 UTC (rev 20629)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-19 14:01:51 UTC (rev 20630)
@@ -2,7 +2,7 @@
 <feature
       id="org.strategoxt.imp"
       label="Spoofax/IMP"
-      version="0.3.2.3"
+      version="0.3.3"
       plugin="org.strategoxt.imp.runtime">
 
    <description url="http://strategoxt.org/Stratego/Spoofax-IMP">
@@ -28,10 +28,6 @@
       <update label="Spoofax/IMP updates" url="http://www.lclnet.nl/update/"/>
    </url>
 
-   <includes
-         id="org.eclipse.pde"
-         version="0.0.0"/>
-
    <requires>
       <import plugin="org.eclipse.core.runtime"/>
       <import plugin="org.eclipse.core.resources"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-19 13:48:21 UTC (rev 20629)
+++ spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-19 14:01:51 UTC (rev 20630)
@@ -3,7 +3,7 @@
    <description name="Spoofax/IMP" url="http://www.lclnet.nl/update">
       Spoofax/IMP update site
    </description>
-   <feature url="features/org.strategoxt.imp_0.3.2.3.jar" id="org.strategoxt.imp" version="0.3.2.3">
+   <feature url="features/org.strategoxt.imp_0.3.3.jar" id="org.strategoxt.imp" version="0.3.3">
       <category name="Spoofax/IMP"/>
    </feature>
    <category-def name="Spoofax/IMP" label="Spoofax/IMP"/>



From L.C.L.Kats at tudelft.nl  Mon Feb 22 10:39:07 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 09:39:07 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20631 - LennartKats -
	spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core
Message-ID: <201002220939.o1M9d7C0018363@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 09:39:07 +0000 (Mon, 22 Feb 2010)
New Revision: 20631

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20631&view=rev

Modified:
   spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java

Log:
Fixed stack traces not showing completely in the console

Changes:

Modified: spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java
===================================================================
--- spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java	2010-02-19 14:01:51 UTC (rev 20630)
+++ spoofax/trunk/spoofax/org.spoofax.interpreter.core/src/java/org/spoofax/interpreter/core/StackTracer.java	2010-02-22 09:39:07 UTC (rev 20631)
@@ -154,6 +154,7 @@
                 }
                 writer.write("\t" + frames[i] + "\n");
             }
+            writer.flush();
         } catch (IOException e) {
             // Swallow it like we're PrintStream
         }



From L.C.L.Kats at tudelft.nl  Mon Feb 22 10:39:17 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 09:39:17 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20632 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser
Message-ID: <201002220939.o1M9dHCc018366@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 09:39:17 +0000 (Mon, 22 Feb 2010)
New Revision: 20632

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20632&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java	2010-02-22 09:39:07 UTC (rev 20631)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ParseErrorHandler.java	2010-02-22 09:39:17 UTC (rev 20632)
@@ -414,9 +414,9 @@
 				reportedErrors = true;
 			}
 		}
+		tokenizer.changeTokenKinds(beginSkipped, endSkipped, TokenKind.TK_LAYOUT, TokenKind.TK_ERROR);
 		if (!reportedErrors || tokenizer.getLexStream().getLineNumberOfCharAt(beginSkipped) !=
 				tokenizer.getLexStream().getLineNumberOfCharAt(endSkipped)) {
-			tokenizer.changeTokenKinds(beginSkipped, endSkipped, TokenKind.TK_LAYOUT, TokenKind.TK_ERROR);
 			reportErrorAtTokens(token, token, UNEXPECTED_REGION);
 		}
 	}



From L.C.L.Kats at tudelft.nl  Mon Feb 22 14:27:59 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 13:27:59 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20633 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego
Message-ID: <201002221327.o1MDRx3i021357@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 13:27:57 +0000 (Mon, 22 Feb 2010)
New Revision: 20633

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20633&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/StrategoConsole.java

Log:
Fixed debug messages not showing up in the Spoofax/IMP console

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/StrategoConsole.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/StrategoConsole.java	2010-02-22 09:39:17 UTC (rev 20632)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/StrategoConsole.java	2010-02-22 13:27:57 UTC (rev 20633)
@@ -1,5 +1,7 @@
 package org.strategoxt.imp.runtime.stratego;
 
+import java.io.IOException;
+import java.io.OutputStream;
 import java.io.OutputStreamWriter;
 import java.io.Writer;
 
@@ -44,7 +46,7 @@
 			IOConsoleOutputStream stream = console.newOutputStream();
 			// A red color doesn't seem to make sense for Stratego
 			// stream.setColor(DebugUIPlugin.getPreferenceColor(IDebugPreferenceConstants.CONSOLE_SYS_ERR_COLOR));
-			lastConsoleErrorWriter = new OutputStreamWriter(stream);
+			lastConsoleErrorWriter = new AutoFlushOutputStreamWriter(stream);
 			lastConsole = console;
 			return lastConsoleErrorWriter;
 		}
@@ -55,7 +57,7 @@
 		if (console == lastConsole && lastConsoleOutputWriter != null) {
 			return lastConsoleOutputWriter;
 		} else {
-			lastConsoleOutputWriter = new OutputStreamWriter(console.newOutputStream());
+			lastConsoleOutputWriter = new AutoFlushOutputStreamWriter(console.newOutputStream());
 			lastConsole = console;
 			return lastConsoleOutputWriter;
 		}
@@ -123,4 +125,34 @@
 		job.schedule();
 	}
 
+	/**
+	 * An OutputStreamWriter that automatically flushes its buffer.
+	 * 
+	 * @author Lennart Kats <lennart add lclnet.nl>
+	 */
+	private static class AutoFlushOutputStreamWriter extends OutputStreamWriter {
+
+		public AutoFlushOutputStreamWriter(OutputStream out) {
+			super(out);
+		}
+		
+		@Override
+		public void write(String str, int off, int len) throws IOException {
+			super.write(str, off, len);
+			super.flush();
+		}
+		
+		@Override
+		public void write(char[] cbuf, int off, int len) throws IOException {
+			super.write(cbuf, off, len);
+			super.flush();
+		}
+		
+		@Override
+		public void write(int c) throws IOException {
+			super.write(c);
+			super.flush();
+		}
+		
+	}
 }



From L.C.L.Kats at tudelft.nl  Mon Feb 22 16:46:52 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 15:46:52 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20634 - LennartKats -
	strategoxt/trunk/strc-core/lib/stratego/strc/pack
Message-ID: <201002221546.o1MFkqsH023246@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 15:46:52 +0000 (Mon, 22 Feb 2010)
New Revision: 20634

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20634&view=rev

Modified:
   strategoxt/trunk/strc-core/lib/stratego/strc/pack/pack-stratego.str

Log:
Fixed imports of the form:
  imports foo.generated
where a file foo.generated.str should be imported and not a file foo.str

Changes:

Modified: strategoxt/trunk/strc-core/lib/stratego/strc/pack/pack-stratego.str
===================================================================
--- strategoxt/trunk/strc-core/lib/stratego/strc/pack/pack-stratego.str	2010-02-22 13:27:57 UTC (rev 20633)
+++ strategoxt/trunk/strc-core/lib/stratego/strc/pack/pack-stratego.str	2010-02-22 15:46:52 UTC (rev 20634)
@@ -146,8 +146,10 @@
    */
   pack-stratego-parse-stratego =
       ?(IncludeFromPath(<id>), includes)
-    ; guarantee-extension(|"str")
-    ; remove-extension => mod
+    ; if has-extension(|"str") then
+        remove-extension
+      end
+    ;  ?mod
     ; <pack-if-prefer-str(
         fetch-elem(
            pack-include-from-dir(|mod)



From L.C.L.Kats at tudelft.nl  Mon Feb 22 18:39:10 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 17:39:10 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20635 - LennartKats -
	strategoxt/trunk/strc-core/lib/stratego/strc/front
	strategoxt/trunk/strc-core/tests/test1 strc-java/trunk/test/strc1
Message-ID: <201002221739.o1MHdBmc024623@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 17:39:05 +0000 (Mon, 22 Feb 2010)
New Revision: 20635

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20635&view=rev

Modified:
   strategoxt/trunk/strc-core/lib/stratego/strc/front/desugar-string-quotations.str
   strategoxt/trunk/strc-core/tests/test1/test112.str
   strc-java/trunk/test/strc1/test112.str

Log:
Escape \ in string quotations

Changes:

Modified: strategoxt/trunk/strc-core/lib/stratego/strc/front/desugar-string-quotations.str
===================================================================
--- strategoxt/trunk/strc-core/lib/stratego/strc/front/desugar-string-quotations.str	2010-02-22 15:46:52 UTC (rev 20634)
+++ strategoxt/trunk/strc-core/lib/stratego/strc/front/desugar-string-quotations.str	2010-02-22 17:39:05 UTC (rev 20635)
@@ -176,7 +176,7 @@
   DesugarQStr :
     QStr(s) -> Anno(Str(s'), Op("Nil", []))
     with
-      s' := <conc-strings> ("\"", s, "\"")
+      s' := <conc-strings> ("\"", <string-replace(|"\\", "\\\\")> s, "\"")
 
   DesugarToQStr :
     QBr(s) -> QStr(s)

Modified: strategoxt/trunk/strc-core/tests/test1/test112.str
===================================================================
--- strategoxt/trunk/strc-core/tests/test1/test112.str	2010-02-22 15:46:52 UTC (rev 20634)
+++ strategoxt/trunk/strc-core/tests/test1/test112.str	2010-02-22 17:39:05 UTC (rev 20635)
@@ -61,5 +61,7 @@
     !${ block {"{"} foo $}$  }; show(|11) =>
 "block { foo }";
 
-    !$[ 1[2]3 ]; show(|12) => "123"
+    !$[ 1[2]3 ]; show(|12) => "123";
+    
+    !$[a\\b]; show(|13); string-length => 4
 

Modified: strc-java/trunk/test/strc1/test112.str
===================================================================
--- strc-java/trunk/test/strc1/test112.str	2010-02-22 15:46:52 UTC (rev 20634)
+++ strc-java/trunk/test/strc1/test112.str	2010-02-22 17:39:05 UTC (rev 20635)
@@ -61,5 +61,7 @@
     !${ block {"{"} foo $}$  }; show(|11) =>
 "block { foo }";
 
-    !$[ 1[2]3 ]; show(|12) => "123"
+    !$[ 1[2]3 ]; show(|12) => "123";
+    
+    !$[a\\b]; show(|13); string-length => 4
 



From L.C.L.Kats at tudelft.nl  Mon Feb 22 18:40:05 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 17:40:05 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20636 - LennartKats -
	strc-java/trunk/java
Message-ID: <201002221740.o1MHe5LC024655@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 17:40:04 +0000 (Mon, 22 Feb 2010)
New Revision: 20636

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20636&view=rev

Modified:
   strc-java/trunk/java/spoofax-libs.jar

Log:


Changes:

Modified: strc-java/trunk/java/spoofax-libs.jar
===================================================================
(Binary files differ)



From L.C.L.Kats at tudelft.nl  Mon Feb 22 18:42:02 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Mon, 22 Feb 2010 17:42:02 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20637 - LennartKats -
	in spoofax-imp/trunk: . org.strategoxt.imp.editors.sdf/editor
	org.strategoxt.imp.editors.sdf/trans
	org.strategoxt.imp.editors.stratego/lib
	org.strategoxt.imp.editors.stratego/trans
	org.strategoxt.imp.generator/src/sdf2imp/project
	org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego
	org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ast
	org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services
	org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego
Message-ID: <201002221742.o1MHg2jJ024672@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-22 17:42:01 +0000 (Mon, 22 Feb 2010)
New Revision: 20637

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20637&view=rev

Added:
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/ProjectPathPrimitive.java
Removed:
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str
Modified:
   spoofax-imp/trunk/Makefile
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/editor/SDF-Builders.esv
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/stratego_sugar.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
   spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego/IMPParseStrategoFileStrategy.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ast/RootAstNode.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/EditorIOAgent.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPImplodeAsfixStrategy.java
   spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPLibrary.java

Log:
Generalized the import handling and caching mechanism of the Stratego analyzer:
wrote two strategies open-import and open-wildcard-import
available for general use in lib/editor-common.generated.str


Changes (first 1000 lines of the diffs):

Modified: spoofax-imp/trunk/Makefile
===================================================================
--- spoofax-imp/trunk/Makefile	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/Makefile	2010-02-22 17:42:01 UTC (rev 20637)
@@ -10,7 +10,7 @@
 	$(MAKE) -C org.strategoxt.imp.generator all
 
 %.ant : .PHONY
-	cd $* && ANT_OPTS="-Xss4m -Xmx512m" CLASSPATH=utils/strategoxt.jar:utils/sdf2imp.jar:utils/make_permissive.jar \
+	cd $* && ANT_OPTS="-Xss8m -Xmx768m" CLASSPATH=utils/strategoxt.jar:utils/sdf2imp.jar:utils/make_permissive.jar \
 	    ant -f build.main.xml -Declipse.spoofaximp.jars=../org.strategoxt.imp.generator/lib \
 	                          -Declipse.spoofaximp.strategojar=utils/strategoxt.jar
 

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/editor/SDF-Builders.esv
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/editor/SDF-Builders.esv	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/editor/SDF-Builders.esv	2010-02-22 17:42:01 UTC (rev 20637)
@@ -16,4 +16,7 @@
     generate-pp-rules (realtime) (openeditor)
 
   builder : "Show abstract syntax signature (for selection)" =
-    generate-rtg (realtime) (openeditor)
\ No newline at end of file
+    generate-rtg (realtime) (openeditor)
+
+  builder : "Show abstract syntax (for selection)" =
+    generate-aterm (realtime) (openeditor) (meta)

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -68,6 +68,11 @@
       fatal-err(|$[Could not generate abstract syntax signatures for this selection.
                    Only productions with {cons()} attributes are supported.])
   
+  generate-aterm:
+    (selected, position, ast, path, project-path) -> (filename, selected)
+    where
+      filename  := <guarantee-extension(|"aterm")> path
+  
   add-context =
     if not(oncetd(?context-free-syntax(_))) then
       if is-list then

Copied: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str (from rev 20630, spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str)
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str	                        (rev 0)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -0,0 +1,154 @@
+module lib/editor-common.generated
+
+imports
+  libstrc
+
+strategies
+
+  parse-file =
+    parse-stratego-file
+  
+strategies
+  
+  /**
+   * Processes an import during semantic analysis.
+   * Ensures proper caching of files and prevents
+   * processing duplicate imports more than once.
+   *
+   * @param resolve-path  Resolves the filesystem path of this import
+   * @param parse-file    Parses a file (optionally removing definition bodies
+   *                      so only signatures are stored in the cache)
+   * @param record-declarations
+   *                      Performs semantic analysis on a tree
+   */
+  open-import(resolve-path, parse-file, record-declarations):
+    import -> import
+    where
+      if not(!import => COMPLETION(_)) then
+        path       := <resolve-path> import;
+        cache-path := <import-cache-path> path;
+        if not(<IsImported> path) then
+          rules(
+            IsImported: path
+          );
+          if <is-newer> (cache-path, path) then
+            file := <ReadFromFile> cache-path
+          else
+            file := <parse-file> path;
+            if <file-exists> path then
+              // Only cache if on filesystem (e.g., ignore libstratego-lib)
+              <WriteToBinaryFile> (cache-path, file)
+            end        
+          end;
+          {| CurrentFile:
+            rules(CurrentFile := path);
+            <record-declarations> file
+          |}
+        end
+      end
+
+  open-wildcard-import(resolve-path, parse-file, record-declarations, is-source-file):
+    import -> import
+    where
+      if not(!import => COMPLETION(_)) then
+        path := <resolve-path> import;
+        readdir;
+        list-loop(
+          if is-source-file then
+            <open-import(resolve-path, parse-file, record-declarations)>
+              $[[path]/[<id>]]
+          <+
+            try(?one-failed)
+          end
+        );
+        not(!one-failed)
+      end
+  
+  import-cache-path:
+    full-path -> cache-path
+    with
+      project-path := <prim("SSL_EXT_projectpath")>;
+      cache-dir    := <file-exists <+ mkdir> $[[project-path]/.cache];
+      full-path'   := <string-replace(|"/", "+"); string-replace(|"\\", "+"); string-replace(|":", "+")> full-path;
+      cache-path   := $[[cache-dir]/[full-path'].sig]
+
+  is-newer:
+    (file1, file2) -> <id>
+    where
+      <gt> (<file-exists; modification-time> file1, <file-exists; modification-time> file2) 
+
+strategies
+
+  desugar-position(desugar|ast):
+    position -> position'
+    where
+      ast'  := <at-position(!<id>{MARKER()}|position)> ast;
+      ast'' := <topdown(repeat(preserve-annos({?x; desugar; not(?x)})))> ast';
+      position' := <position-of-term({?_{a*}; <one(?MARKER())> a*})> ast''
+   
+  at-position(s|position):
+    c#(t*) -> t'
+    where
+      !position => [i | position']
+    where
+      t' := c#(<at-index(at-position(s|position'))> (i, t*))
+
+  at-position(s|position):
+    t -> t'
+    where
+      !position => [];
+      t' := <s> t
+
+  position-of-term(is-term):
+    t -> []
+    where
+      is-term
+  
+  position-of-term(is-term):
+    _#(t*) -> <position-of-term(is-term|0)> t*
+  
+  position-of-term(is-term|start-index):
+    [t | t*] -> position
+    where
+      if i* := <position-of-term(is-term)> t then
+        position := [start-index | i*]
+      else
+        position := <position-of-term(is-term | <inc> start-index)> t*
+      end
+
+  term-at-position(|position):
+    t -> t'
+    where
+      at-position(?t'|position) 
+
+  parent-at-position(|position):
+    t -> t'
+    where
+      !position => [i, _];
+      t' := <subterm-at(|i)> t
+  
+  parent-at-position(|position):
+    t -> <parent-at-position(|position')> t'
+    where
+      !position => [i | position' @ [_, _ | _]];
+      t' := <subterm-at(|i)> t
+
+  subterm-at(|index):
+    _#(t*) -> <index(|<inc> index)> t*
+  
+signature constructors
+
+  COMPLETION : String -> Term
+  UNKNOWN    : Term   -> Term
+  MARKER     : Term
+
+  // Below are copies of the signatures of the terms used in example
+  // trans/{name}.str file. These definitions should also be automatically 
+  // generated in the imported include/{sdf-name}.str module. However,
+  // to ensure that the example transformation doesn't break when the
+  // syntax is changed, we also hard-coded them here.
+          
+  Module   : ID * List(Entity)   -> Module
+  Entity   : ID * List(Property) -> Entity
+  Property : ID * Type           -> Property
+  Type     : ID                  -> Type

Deleted: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -1,77 +0,0 @@
-module lib/editor-common
-
-strategies
-
-  desugar-position(desugar|ast):
-    position -> position'
-    where
-      ast'  := <at-position(!<id>{MARKER()}|position)> ast;
-      ast'' := <topdown(repeat(preserve-annos({?x; desugar; not(?x)})))> ast';
-      position' := <position-of-term({?_{a*}; <one(?MARKER())> a*})> ast''
-   
-  at-position(s|position):
-    c#(t*) -> t'
-    where
-      !position => [i | position']
-    where
-      t' := c#(<at-index(at-position(s|position'))> (i, t*))
-
-  at-position(s|position):
-    t -> t'
-    where
-      !position => [];
-      t' := <s> t
-
-  position-of-term(is-term):
-    t -> []
-    where
-      is-term
-  
-  position-of-term(is-term):
-    _#(t*) -> <position-of-term(is-term|0)> t*
-  
-  position-of-term(is-term|start-index):
-    [t | t*] -> position
-    where
-      if i* := <position-of-term(is-term)> t then
-        position := [start-index | i*]
-      else
-        position := <position-of-term(is-term | <inc> start-index)> t*
-      end
-
-  term-at-position(|position):
-    t -> t'
-    where
-      at-position(?t'|position) 
-
-  parent-at-position(|position):
-    t -> t'
-    where
-      !position => [i, _];
-      t' := <subterm-at(|i)> t
-  
-  parent-at-position(|position):
-    t -> <parent-at-position(|position')> t'
-    where
-      !position => [i | position' @ [_, _ | _]];
-      t' := <subterm-at(|i)> t
-
-  subterm-at(|index):
-    _#(t*) -> <index(|<inc> index)> t*
-  
-signature constructors
-
-  COMPLETION : String -> Term
-  UNKNOWN    : Term   -> Term
-  MARKER     : Term
-
-  // Below are copies of the signatures of the terms used in example
-  // trans/{name}.str file. These definitions should also be automatically 
-  // generated in the imported include/{sdf-name}.str module. However,
-  // to ensure that the example transformation doesn't break when the
-  // syntax is changed, we also hard-coded them here.
-          
-  Module   : ID * List(Entity)   -> Module
-  Entity   : ID * List(Property) -> Entity
-  Property : ID * Type           -> Property
-  Type     : ID                  -> Type

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/analysis.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -4,7 +4,7 @@
   libstratego-lib
   libstrc
   desugar
-  lib/editor-common
+  lib/editor-common.generated
 
 strategies
 
@@ -12,8 +12,8 @@
     (ast, path, project-path) -> ast'
     with
       rules(
+        CurrentFile := $[[project-path]/[path]]
         CurrentDir  := <dirname> $[[project-path]/[path]]
-        CurrentFile := <base-filename> path
         ProjectDir  := project-path
       );
       if <file-exists> $[[project-path]/.disable-global-analysis] then
@@ -41,49 +41,58 @@
 rules // Projections and lookup
 
   signature-of:
-    SDefT(x, s*, t*, s) -> (x, <length> s*, <length> t*)
+    SDefT(x, s*, t*, s) -> (<remove-quote> x, <length> s*, <length> t*)
 
   signature-of:
-    RDecT(x, s*, t*) -> (x, <length> s*, <length> t*)
+    RDecT(x, s*, t*) -> (<remove-quote> x, <length> s*, <length> t*)
 
   signature-of:
-    ExtSDef(x, s*, t*) -> (x, <length> s*, <length> t*) 
+    ExtSDef(x, s*, t*) -> (<remove-quote> x, <length> s*, <length> t*) 
 
   signature-of:
-    CallT(SVar(x), s*, t*) -> (x, <length> s*, <length> t*)
+    CallT(SVar(x), s*, t*) -> (<remove-quote> x, <length> s*, <length> t*)
 
   signature-of-congruence:
-    CallT(SVar(x), s*, []) -> (x, <length> s*) 
+    CallT(SVar(x), s*, []) -> (<remove-quote> x, <length> s*) 
 
   signature-of-congruence:
-    SDefT(x, s*, t*, []) -> (x, <length> s*) 
+    SDefT(x, s*, t*, []) -> (<remove-quote> x, <length> s*) 
 
   signature-of:
-    Var(x) -> (x, 0)
+    Var(x) -> (<remove-quote> x, 0)
 
   signature-of:
-    VarDec(x, t) -> (x, 0)
+    VarDec(x, t) -> (<remove-quote> x, 0)
 
   signature-of:
-    Op(x, t*) -> (x, <length> t*)
+    Op(x, t*) -> (<remove-quote> x, <length> t*)
 
   signature-of:
-    OpDecl(x, t) -> (x, <dec> <occurrences(?ConstType(_))> t) 
+    OpDecl(x, t) -> (<remove-quote> x, <dec> <occurrences(?ConstType(_))> t) 
 
   signature-of:
-    ExtOpDecl(x, t) -> (x, <dec> <occurrences(?ConstType(_))> t)
+    ExtOpDecl(x, t) -> (<remove-quote> x, <dec> <occurrences(?ConstType(_))> t)
     
   signature-of:
-    Overlay(x, t*, _) -> (x, <length> t*)
+    Overlay(x, t*, _) -> (<remove-quote> x, <length> t*)
 
   signature-of:
-    Rec(x, s) -> (x, 0, 0)
+    Rec(x, s) -> (<remove-quote> x, 0, 0)
 
   signature-of:
-    LabeledDynRuleScopeId(x, _) -> x
+    LabeledDynRuleScopeId(x, _) -> <remove-quote> x
 
   signature-of:
-    DynRuleScopeId(x) -> x
+    DynRuleScopeId(x) -> <remove-quote> x
+  
+  remove-quote: 
+    s -> s'
+    with
+      if explode-string => ['\'' | s_tail] then
+        s' := <implode-string> s_tail
+      else
+        s' := s
+      end
 
   is-constructor =
     (?(_, _); DeclareCookie; Declaration <+ declaration-of);
@@ -111,7 +120,7 @@
     with
       sig := <signature-of>;
       if not(cookie := <DeclareCookie> sig) then
-        cookie := <new-cookie>;
+        cookie := <newterm>;
         rules(
           DeclareCookie: sig -> cookie
           Declaration: cookie -> def
@@ -122,7 +131,7 @@
     def -> cookie
     with
       sig := <signature-of>;
-      cookie := <new-cookie>;
+      cookie := <newterm>;
       rules(
         DeclareCookie: sig -> cookie
         Declaration: cookie -> def
@@ -134,10 +143,6 @@
   is-declared =
     one(?_{cookie} + ?SVar(_{cookie}))
 
-  new-cookie =
-    if-java-platform(SRTS-EXT-newint);
-    if-c-platform(new)
-
   external SRTS-EXT-newint(|)
   
 rules // Declare globals
@@ -174,120 +179,72 @@
     with
       x' := x{<declare-definition>}
 
+  open-import(to-signatures):
+    full-path -> ast
+    with
+      ast := <id>
+  
   declare-globals:
     Import(x) -> Import(x)
-    where
-      not(!x => COMPLETION(_))
-    where
-      <IsImported> x
+    with
+      <open-import(resolve-import-path, read-stratego-signatures, declare-globals-top)> x
     <+
-      rules(IsImported: x);
-      <import-library> x;
-      declare-globals-top
-    <+
-      path := <try(resolve-import-path)> $[[x].str];
-      if not(!$[[<CurrentDir>]/[<CurrentFile>]] => path) then
-        (import-from-cache <+ debug(!"not cached:"); import-rtree <+ import-str);
-        declare-globals-top
-      end
-    <+
-      rules(
-        MissingImports :+= x
-        IsImportedFailed: x
-      )
+      rules(IsImportedFailed: x)
 
   declare-globals:
     ImportWildcard(x) -> ImportWildcard(x)
-    where
-      IsImported
+    with
+      <open-wildcard-import(resolve-import-path, read-stratego-signatures, declare-globals-top, has-extension(|"str") + has-extension(|"rtree"))> x
     <+
-      rules(IsImported: ImportWildcard(x));
-      path := <resolve-import-path> x;
-      readdir;
-      dr-ignore-state(
-        list-loop(
-          if has-extension(|"str") then
-            try(<declare-globals> Import($[[path]/[<remove-extension>]]))
-          end
-        )
-      | "MissingImports"
-      )
-    <+
-      rules(
-        MissingImports :+= x
-        IsImportedFailed: x
-      )
+      rules(IsImportedFailed: x)
 
-  import-library =
-    <pack-stratego-parse-stratego; to-signatures> (IncludeFromPath(<id>), [])
-
-   import-from-cache:
-     str -> signatures
-     where
-       cached := <import-cache-path>;
-       <is-newer> (cached, str);
-       signatures := <file-exists; ReadFromFile> cached
-
-   import-rtree:
-     str -> signatures
-     where
-       rtree := <try(resolve-import-path)> <guarantee-extension(|"rtree")>;
-       (<is-newer> (rtree, str) + not(<file-exists> str));
-       signatures := <file-exists; ReadFromFile; to-signatures> rtree
-     with
-       <WriteToBinaryFile> (<import-cache-path>, signatures)        
-
-   import-str:
-     str -> signatures
-     where
-       file-exists;
-       parse-stratego-file; // uses Spoofax/IMP override for .meta support
-       signatures := <to-signatures>
-     with
-       <WriteToBinaryFile> (<import-cache-path>, signatures)        
-
-   to-signatures =
-     basic-desugar-top;
-     topdown(try(remove-stratego-bodies))
-
-   remove-stratego-bodies:
-     SDefT(x, s*, t*, s) -> SDefT(x, s*, t*, s')
-     with
-       s' := <collect-all(?RDecT(_, _, _))> s
-   
-   remove-stratego-bodies:
-     Import(_) -> ()
-   
-   remove-stratego-bodies:
-     ImportWildcard(_) -> ()
-
    resolve-import-path:
      x -> full-path
      where
         // FIXME: fetch true import paths from someplace
-        full-path := <file-exists> $[[<CurrentDir>]/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/trans/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/lib/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/src/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/syntax/[x]]
-     <+ full-path := <file-exists> $[[<ProjectDir>]/src/syntax/[x]]
-     <+ full-path := <file-exists> $[[<CurrentDir>]/../[x]]
-     <+ full-path := <file-exists> $[[<CurrentDir>]/../../[x]]
-     <+ full-path := <file-exists> $[[<CurrentDir>]/../../../[x]]
-     <+ full-path := <file-exists> $[[<CurrentDir>]/../../../../[x]]
+        fetch-library-ast; full-path := x
+     <+ full-path := <file-exists> $[[<ProjectDir>]/[x].str]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/trans/[x].str]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/lib/[x].str]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/lib/[x].rtree]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/src/[x].str]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/syntax/[x].str]
+     <+ full-path := <file-exists> $[[<ProjectDir>]/src/syntax/[x].str]
+     <+ full-path := <file-exists> $[[<CurrentDir>]/[x].str]
+     <+ full-path := <file-exists> $[[<CurrentDir>]/../[x].str]
+     <+ full-path := <file-exists> $[[<CurrentDir>]/../../[x].str]
+     <+ full-path := <file-exists> $[[<CurrentDir>]/../../../[x].str]
+     <+ full-path := <file-exists> $[[<CurrentDir>]/../../../../[x].str]
+  
+  read-stratego-signatures:
+    str -> <to-signatures> file
+    where
+      file := <fetch-library-ast>
+    <+
+      rtree := <guarantee-extension(|"rtree")>;
+      if <is-newer> (rtree, str) + not(<file-exists> str) then
+        file := <file-exists; ReadFromFile> rtree
+      else
+        file := <parse-stratego-file> str
+      end
+  
+  fetch-library-ast:
+    x -> <pack-stratego-parse-stratego> (IncludeFromPath(x), [])
 
-   import-cache-path:
-     full-path -> cache-path
-     with
-       cache-dir  := <file-exists <+ mkdir> $[[<ProjectDir>]/.cache];
-       full-path' := <string-replace(|"/", "+"); string-replace(|"\\", "+"); string-replace(|":", "+")> full-path;
-       cache-path := $[[cache-dir]/[full-path'].sig]
+  to-signatures =
+    basic-desugar-top;
+    topdown(try(remove-stratego-bodies))
 
-  is-newer:
-    (file1, file2) -> <id>
-    where
-      <gt> (<file-exists; modification-time> file1, <file-exists; modification-time> file2) 
+  remove-stratego-bodies:
+    SDefT(x, s*, t*, s) -> SDefT(x, s*, t*, s')
+    with
+      s' := <collect-all(?RDecT(_, _, _))> s
+   
+  remove-stratego-bodies:
+    Import(_) -> ()
+   
+  remove-stratego-bodies:
+    ImportWildcard(_) -> ()
 
   declare-dynrule:
     dec @ RDecT(x, s*, t*) -> RDecT(x', s*, t*)
@@ -296,7 +253,7 @@
     with
       x' := x{<declare-cookie-of>}
     <+
-      cookie := <new-cookie>;
+      cookie := <newterm>;
       x'  := x{cookie};
       s'* := <length> s*;
       t'* := <length> t*;
@@ -472,7 +429,7 @@
   declare-svar:
     dec @ VarDec(x, t) -> VarDec(x', t)
     with
-      cookie := <new-cookie>;
+      cookie := <newterm>;
       x'     := x{cookie};
       rules(
         DeclareCookie: (x, _, _) -> cookie
@@ -547,7 +504,7 @@
         otherwise: // unknown context
           all-signatures' := <filter(not(is-congruence-signature))> all-signatures
       end;
-      proposals := <map(signature-to-proposal)> all-signatures';
+      proposals := <map(signature-to-proposal)> all-signatures'; // DEBUG
       rules(
         ContentProposals := proposals
       )
@@ -567,7 +524,7 @@
     filter(one(string-starts-with(|prefix); not(?"")))
   
   signature-to-proposal:
-    (x, 0) -> ([x | parentheses], "")
+    (x, 0) -> [x | parentheses]
     with
       if is-constructor then
         parentheses := ["()"]
@@ -576,30 +533,33 @@
       end
 
   signature-to-proposal:
-    (x, n) -> ([x, "(", t*, ")"], "")
+    (x, n) -> [x, "(", t*, ")"]
     where
       <gt> (n, 0)
     with
       t* := <separate-by(|", ")> <copy> (n, "t")
 
   signature-to-proposal:
-    (x, 0, 0) -> ([x, ""], "")
+    (x, 0, 0) -> [x, ""]
 
   signature-to-proposal:
-    (x, n, 0) -> ([x, "(", t*, ")"], "")
+    (x, n, 0) -> [x, "(", t*, ")"]
     where
       <gt> (n, 0)
     with
       t* := <separate-by(|", ")> <copy> (n, "s")
 
   signature-to-proposal:
-    (x, n, m) -> ([x, "(", s*, "|", t*, ")"], "")
+    (x, n, m) -> [x, "(", s*, "|", t*, ")"]
     where
       <gt> (m, 0)
     with
       s* := <separate-by(|", ")> <copy> (n, "s");
       t* := <separate-by(|", ")> <copy> (m, "t")
 
+  signature-to-proposal:
+    (x, [DR_DUMMY()], [DR_DUMMY()]) -> x // strategy param (wildcard arity)
+
 rules // Constraints
 
   global-constraint-error:
@@ -716,12 +676,12 @@
     Module(x, _) -> (x, $[Module name should be qualified with a path relative to the import path])
     where
       not(NoAnalysis);
-      <eq> (<base-filename> x, <remove-extension> <CurrentFile>);
-      require(<resolve-import-path> $[[x].str])
+      <eq> (<base-filename> x, <remove-extension> <base-filename> <CurrentFile>);
+      require(<resolve-import-path> x)
 
   constraint-warning:
     Module(x, _) -> (x, $[Module name does not correspond to file name])
     where
-      require(<eq> (<base-filename> x, <remove-extension> <CurrentFile>))
+      require(<eq> (<base-filename> x, <remove-extension> <base-filename> <CurrentFile>))
 
   // TODO: overlapping signatures

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/stratego_sugar.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/stratego_sugar.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/trans/stratego_sugar.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -6,7 +6,8 @@
   libstratego-aterm
   libstrc
   analysis
-  lib/editor-common
+  desugar
+  lib/editor-common.generated
 
 strategies
 
@@ -24,7 +25,7 @@
         errors   := <collect-all(constraint-error, conc)> ast';
         warnings := <collect-all(constraint-warning, conc)> ast'
       else
-        if WarnAnalysis + MissingImports then
+        if WarnAnalysis then
           errors   := <collect-all(constraint-error, conc)> ast';
           warnings := <collect-all(global-constraint-error + constraint-warning, conc)> ast'
         else

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -287,8 +287,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-22 17:42:01 UTC (rev 20637)
@@ -24,7 +24,7 @@
   libstratego-gpp
   libstratego-aterm
   include/{sdf-name}
-  lib/editor-common
+  lib/editor-common.generated
   check
   generate
 
@@ -90,7 +90,7 @@
   libstratego-gpp
   libstratego-aterm
   include/{sdf-name}
-  lib/editor-common
+  lib/editor-common.generated
 
 rules
 
@@ -140,7 +140,7 @@
 imports
   libstratego-lib
   include/{sdf-name}
-  lib/editor-common
+  lib/editor-common.generated
 
 rules
 
@@ -159,7 +159,6 @@
       rules(
         GetEntity :+ x -> x
       )
-
 rules
     
   // Reports an error if a property type is undefined.
@@ -194,11 +193,10 @@
     name     := <trans-module-name>;
     sdf-name := <get-sdf-main-module>;
 
-if not(<file-exists> "lib/editor-common.str") then
 try(<file-exists <+ mkdir> "lib");
 // TODO: regenerate editor-common.str every time, but only if it changed to avoid unecessary builds
-<output-text-file(|["lib"], "editor-common.str")>
-${module lib/editor-common
+<output-text-file(|["lib"], "editor-common.generated.str")>
+${module lib/editor-common.generated
 
 imports
   libstratego-lib
@@ -213,7 +211,76 @@
     parse-string(|<import-term(include/{sdf-name}.tbl)>)
   
 strategies
+  
+  /**
+   * Processes an import during semantic analysis.
+   * Ensures proper caching of files and prevents
+   * processing duplicate imports more than once.
+   *
+   * @param resolve-path  Resolves the filesystem path of this import
+   * @param parse-file    Parses a file (optionally removing definition bodies
+   *                      so only signatures are stored in the cache)
+   * @param record-declarations
+   *                      Performs semantic analysis on a tree
+   */
+  open-import(resolve-path, parse-file, record-declarations):
+    import -> import
+    where
+      if not(!import => COMPLETION(_)) then
+        path       := <resolve-path> import;
+        cache-path := <import-cache-path> path;
+        if not(<IsImported> path) then
+          rules(
+            IsImported: path
+          );
+          if <is-newer> (cache-path, path) then
+            file := <ReadFromFile> cache-path
+          else
+            file := <parse-file> path;
+            if <file-exists> path then
+              // Only cache if on filesystem (e.g., ignore libstratego-lib)
+              <WriteToBinaryFile> (cache-path, file)
+            end        
+          end;
+          ${$| CurrentFile:
+            rules(CurrentFile := path);
+            <record-declarations> file
+          |$}$
+        end
+      end
 
+  open-wildcard-import(resolve-path, parse-file, record-declarations, is-source-file):
+    import -> import
+    where
+      if not(!import => COMPLETION(_)) then
+        path := <resolve-path> import;
+        readdir;
+        list-loop(
+          if is-source-file then
+            <open-import(resolve-path, parse-file, record-declarations)>
+              $[[path]/[<id>]]
+          <+
+            try(?one-failed)
+          end
+        );
+        not(!one-failed)
+      end
+  
+  import-cache-path:
+    full-path -> cache-path
+    with
+      project-path := <prim("SSL_EXT_projectpath")>;
+      cache-dir    := <file-exists <+ mkdir> $[[project-path]/.cache];
+      full-path'   := <string-replace(|"/", "+"); string-replace(|"{"\\\\"}", "+"); string-replace(|":", "+")> full-path;
+      cache-path   := $[[cache-dir]/[full-path'].sig]
+
+  is-newer:
+    (file1, file2) -> <id>
+    where
+      <gt> (<file-exists; modification-time> file1, <file-exists; modification-time> file2) 
+
+strategies
+
   desugar-position(desugar|ast):
     position -> position'
     where
@@ -293,5 +360,4 @@
   Entity   : ID * List(Property) -> Entity
   Property : ID * Type           -> Property
   Type     : ID                  -> Type
-}
-end
\ No newline at end of file
+}
\ No newline at end of file

Modified: spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego/IMPParseStrategoFileStrategy.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego/IMPParseStrategoFileStrategy.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/stratego/IMPParseStrategoFileStrategy.java	2010-02-22 17:42:01 UTC (rev 20637)
@@ -2,6 +2,7 @@
 
 import static org.spoofax.interpreter.terms.IStrategoTerm.STRING;
 
+import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
 
@@ -18,6 +19,7 @@
 import org.strategoxt.imp.runtime.parser.JSGLRI;
 import org.strategoxt.imp.runtime.parser.ast.RootAstNode;
 import org.strategoxt.imp.runtime.services.MetaFile;
+import org.strategoxt.imp.runtime.stratego.IMPImplodeAsfixStrategy;
 import org.strategoxt.lang.Context;
 import org.strategoxt.lang.StrategoException;
 import org.strategoxt.strc.parse_stratego_file_0_0;
@@ -41,6 +43,7 @@
 			try {
 				stream = context.getIOAgent().openInputStream(file);
 				RootAstNode ast = parser.parse(stream, file);
+				ast.setResource(IMPImplodeAsfixStrategy.getResource(new File(file)));
 				return ast.getTerm();
 			} finally {
 				if (stream != null) stream.close();

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ast/RootAstNode.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ast/RootAstNode.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/parser/ast/RootAstNode.java	2010-02-22 17:42:01 UTC (rev 20637)
@@ -7,13 +7,17 @@
 	
 	private final SGLRParseController controller;
 	
-	private final IResource resource;
+	private IResource resource;
 	
 	@Override
 	public IResource getResource() {
 		return resource;
 	}
 	
+	public void setResource(IResource resource) {
+		this.resource = resource;
+	}
+	
 	@Override
 	public SGLRParseController getParseController() {
 		return controller;

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/ContentProposer.java	2010-02-22 17:42:01 UTC (rev 20637)
@@ -249,6 +249,10 @@
 				newTextParts = factory.makeList(proposal);
 				newText = ((IStrategoString) proposal).stringValue();
 				description = emptyString;
+			} else if (proposal.getTermType() == LIST) {
+				newTextParts = (IStrategoList) proposal;
+				newText = proposalPartsToString(newTextParts);
+				description = emptyString;
 			} else {
 				IStrategoTerm newTextTerm = termAt(proposal, 0);
 				if (proposal.getTermType() != TUPLE || proposal.getSubtermCount() != 2

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/services/StrategoObserver.java	2010-02-22 17:42:01 UTC (rev 20637)
@@ -18,7 +18,6 @@
 
 import org.eclipse.core.resources.IMarker;
 import org.eclipse.core.resources.IResource;
-import org.eclipse.core.runtime.IPath;
 import org.eclipse.core.runtime.IProgressMonitor;
 import org.eclipse.core.runtime.IStatus;
 import org.eclipse.core.runtime.NullProgressMonitor;
@@ -483,8 +482,7 @@
 			//       (e.g., overriding Context.lookupPrimitive to throw an OperationCanceledException) 
 			
 			runtime.setCurrent(term);
-			IPath path = resource.getLocation();
-			initRuntimePath(path.removeLastSegments(1));
+			initRuntimePath(resource);
 
 			((LoggingIOAgent) runtime.getIOAgent()).clearLog();
 			boolean success = runtime.invoke(function);
@@ -553,12 +551,14 @@
 		}
 	}
 	
-	private void initRuntimePath(IPath workingDir) {
+	private void initRuntimePath(IResource resource) {
 		assert Thread.holdsLock(getSyncRoot());
 		
 		try {
-			runtime.getIOAgent().setWorkingDir(workingDir.toOSString());
-			((EditorIOAgent) runtime.getIOAgent()).setDescriptor(descriptor);
+			EditorIOAgent io = (EditorIOAgent) runtime.getIOAgent();
+			io.setWorkingDir(resource.getLocation().removeLastSegments(1).toOSString());
+			io.setProjectPath(resource.getProject().getLocation().toOSString());
+			io.setDescriptor(descriptor);
 		} catch (IOException e) {
 			Environment.logException("Could not set Stratego working directory", e);
 			throw new RuntimeException(e);

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/EditorIOAgent.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/EditorIOAgent.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/EditorIOAgent.java	2010-02-22 17:42:01 UTC (rev 20637)
@@ -22,6 +22,8 @@
 	private Descriptor descriptor;
 	
 	private boolean alwaysActivateConsole;
+
+	private String projectPath;
 	
 	public void setDescriptor(Descriptor descriptor) {
 		this.descriptor = descriptor;
@@ -78,4 +80,12 @@
 	public void setAlwaysActivateConsole(boolean alwaysShowConsole) {
 		this.alwaysActivateConsole = alwaysShowConsole;
 	}
+
+	public void setProjectPath(String projectPath) {
+		this.projectPath = projectPath;
+	}
+	
+	public String getProjectPath() {
+		return projectPath;
+	}
 }

Modified: spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPImplodeAsfixStrategy.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPImplodeAsfixStrategy.java	2010-02-22 17:40:04 UTC (rev 20636)
+++ spoofax-imp/trunk/org.strategoxt.imp.runtime/src/org/strategoxt/imp/runtime/stratego/IMPImplodeAsfixStrategy.java	2010-02-22 17:42:01 UTC (rev 20637)

(62 diff lines omitted)


From R.B.Vermaas at tudelft.nl  Tue Feb 23 11:00:54 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Tue, 23 Feb 2010 10:00:54 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20638 - rob - hydra/jobs
Message-ID: <201002231000.o1NA0sud005228@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-23 10:00:54 +0000 (Tue, 23 Feb 2010)
New Revision: 20638

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20638&view=rev

Modified:
   hydra/jobs/strategoxt.nix

Log:
remove tarball from strategoxt-trunk jobset

Changes:

Modified: hydra/jobs/strategoxt.nix
===================================================================
--- hydra/jobs/strategoxt.nix	2010-02-22 17:42:01 UTC (rev 20637)
+++ hydra/jobs/strategoxt.nix	2010-02-23 10:00:54 UTC (rev 20638)
@@ -5,7 +5,7 @@
 let
   specs = import (hydraConfig + "/strategoxt/packages.nix") ; 
   jobs = 
-    import (hydraConfig + "/job.nix" ) { 
+    removeAttrs (import (hydraConfig + "/job.nix" ) { 
       inputs = { 
         inherit hydraConfig ;
         baselineNix = "${hydraConfig}/baseline.nix" ;
@@ -15,7 +15,7 @@
       } ; 
    
       spec = specs.strategoxt ; 
-    } ;
+    }) ["tarball"] ;
 
 in jobs
 



From R.B.Vermaas at tudelft.nl  Wed Feb 24 08:24:24 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 24 Feb 2010 07:24:24 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20639 - rob - hydra
Message-ID: <201002240724.o1O7OO0c032601@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-24 07:24:23 +0000 (Wed, 24 Feb 2010)
New Revision: 20639

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20639&view=rev

Modified:
   hydra/build.nix

Log:
add lib subdirs of deps to PATH on cygwin

Changes:

Modified: hydra/build.nix
===================================================================
--- hydra/build.nix	2010-02-23 10:00:54 UTC (rev 20638)
+++ hydra/build.nix	2010-02-24 07:24:23 UTC (rev 20639)
@@ -66,14 +66,15 @@
    * Build spec using pkgs from a given tarball.
    */
   easyNixBuildFromTarball =  tarball : pkgs : specpkgs : 
+    let buildInputs = specpkgs.buildInputs ++ (map (spec2: easyBuild pkgs spec2) specpkgs.requires);
+    in
     pkgs.releaseTools.nixBuild (
       (if specpkgs ? customEnv then specpkgs.customEnv else {}) // {
       name = specpkgs.packageName;
       src = tarball;
       inherit (pkgs) stdenv;
       cygwinConfigureEnableShared = true; 
-      buildInputs =
-        specpkgs.buildInputs ++ (map (spec2: easyBuild pkgs spec2) specpkgs.requires);
+      inherit buildInputs;
       propagatedBuildInputs =
         (map (spec2: easyBuild pkgs spec2) specpkgs.requires) ++
         (if specpkgs ? propagatedBuildInputs then specpkgs.propagatedBuildInputs else []);
@@ -89,7 +90,13 @@
 
       meta.maintainers = if specpkgs ? notifyAddresses then specpkgs.notifyAddresses else [] ;
 
-    });
+    } // (if pkgs.stdenv.system == "i686-cygwin" then 
+            { preConfigure = ''
+                export PATH=$PATH:${concatStringsSep ":" (map (p: "${p}/lib") buildInputs)}
+              ''; 
+            } 
+          else {}
+         ));
 
   svnInputFromInputs = spec :
     builtins.getAttr ((spec pkgsDefault).attrPrefix + "Checkout") inputs;



From R.B.Vermaas at tudelft.nl  Wed Feb 24 08:26:09 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 24 Feb 2010 07:26:09 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20640 - rob - hydra
Message-ID: <201002240726.o1O7Q98T032656@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-24 07:26:09 +0000 (Wed, 24 Feb 2010)
New Revision: 20640

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20640&view=rev

Modified:
   hydra/build.nix

Log:
typo

Changes:

Modified: hydra/build.nix
===================================================================
--- hydra/build.nix	2010-02-24 07:24:23 UTC (rev 20639)
+++ hydra/build.nix	2010-02-24 07:26:09 UTC (rev 20640)
@@ -92,7 +92,7 @@
 
     } // (if pkgs.stdenv.system == "i686-cygwin" then 
             { preConfigure = ''
-                export PATH=$PATH:${concatStringsSep ":" (map (p: "${p}/lib") buildInputs)}
+                export PATH=$PATH:${pkgs.lib.concatStringsSep ":" (map (p: "${p}/lib") buildInputs)}
               ''; 
             } 
           else {}



From R.B.Vermaas at tudelft.nl  Wed Feb 24 10:11:25 2010
From: R.B.Vermaas at tudelft.nl (Rob Vermaas)
Date: Wed, 24 Feb 2010 09:11:25 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20641 - rob - in hydra:
	meta-environment strategoxt
Message-ID: <201002240911.o1O9BP79001794@proliant.st.ewi.tudelft.nl>

Author: rob
Date: 2010-02-24 09:11:25 +0000 (Wed, 24 Feb 2010)
New Revision: 20641

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20641&view=rev

Modified:
   hydra/meta-environment/packages.nix
   hydra/strategoxt/packages.nix

Log:
use aterm25 and sdf2bundle24 for everything

Changes:

Modified: hydra/meta-environment/packages.nix
===================================================================
--- hydra/meta-environment/packages.nix	2010-02-24 07:26:09 UTC (rev 20640)
+++ hydra/meta-environment/packages.nix	2010-02-24 09:11:25 UTC (rev 20641)
@@ -589,7 +589,7 @@
       buildInputs = [pkgs.pkgconfig pkgs.getopt];
       propagatedBuildInputs = [pkgs.getopt];
 
-      requires = [aterm];
+      requires = [aterm25];
 
       svnBuildInputs = buildInputs ++ (autotools pkgs);
       svnRequires = requires;

Modified: hydra/strategoxt/packages.nix
===================================================================
--- hydra/strategoxt/packages.nix	2010-02-24 07:26:09 UTC (rev 20640)
+++ hydra/strategoxt/packages.nix	2010-02-24 09:11:25 UTC (rev 20641)
@@ -14,7 +14,6 @@
    */
   inherit (import ../meta-environment/packages.nix)
     metaBuildEnv
-    sdf2Bundle
     sdf2Bundle24
     aterm25
     cLibrary
@@ -33,6 +32,7 @@
     asfSupport;
 
   aterm = aterm25 ;
+  sdf2Bundle = sdf2Bundle24;
 
   /**
    * Stratego/XT



From L.C.L.Kats at tudelft.nl  Wed Feb 24 11:18:39 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 24 Feb 2010 10:18:39 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20642 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.feature org.strategoxt.imp.updatesite
Message-ID: <201002241018.o1OAId49005174@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-24 10:18:38 +0000 (Wed, 24 Feb 2010)
New Revision: 20642

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20642&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml

Log:
0.3.3.1 release

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-24 09:11:25 UTC (rev 20641)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-24 10:18:38 UTC (rev 20642)
@@ -212,8 +212,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-24 09:11:25 UTC (rev 20641)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-24 10:18:38 UTC (rev 20642)
@@ -2,7 +2,7 @@
 <feature
       id="org.strategoxt.imp"
       label="Spoofax/IMP"
-      version="0.3.3"
+      version="0.3.3.1"
       plugin="org.strategoxt.imp.runtime">
 
    <description url="http://strategoxt.org/Stratego/Spoofax-IMP">

Modified: spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-24 09:11:25 UTC (rev 20641)
+++ spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-24 10:18:38 UTC (rev 20642)
@@ -3,8 +3,12 @@
    <description name="Spoofax/IMP" url="http://www.lclnet.nl/update">
       Spoofax/IMP update site
    </description>
-   <feature url="features/org.strategoxt.imp_0.3.3.jar" id="org.strategoxt.imp" version="0.3.3">
+   <feature url="features/org.strategoxt.imp_0.3.3.1.jar" id="org.strategoxt.imp" version="0.3.3.1">
       <category name="Spoofax/IMP"/>
    </feature>
-   <category-def name="Spoofax/IMP" label="Spoofax/IMP"/>
+   <category-def name="Spoofax/IMP" label="Spoofax/IMP">
+      <description>
+         Spoofax/IMP IDE metatooling environment
+      </description>
+   </category-def>
 </site>



From L.C.L.Kats at tudelft.nl  Wed Feb 24 16:01:29 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Wed, 24 Feb 2010 15:01:29 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20643 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.sdf/trans
	org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.editors.stratego/lib
	org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building
Message-ID: <201002241501.o1OF1Tie024308@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-24 15:01:29 +0000 (Wed, 24 Feb 2010)
New Revision: 20643

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20643&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str
   spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building/DynamicDescriptorBuilder.java

Log:


Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-24 15:01:29 UTC (rev 20643)
@@ -212,8 +212,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-24 15:01:29 UTC (rev 20643)
@@ -212,8 +212,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-24 15:01:29 UTC (rev 20643)
@@ -212,8 +212,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/trans/sdf.str	2010-02-24 15:01:29 UTC (rev 20643)
@@ -3,25 +3,9 @@
 imports
   libstratego-lib
   libstratego-sdf
+  libstratego-sglr
   libstrc
 
-signature constructors
-
-  reject              : Term
-  context-free-syntax : Term -> Term
-  sort                : Term -> Term
-  term                : Term -> Term
-  default             : Term -> Term
-  iter-star           : Term -> Term
-  iter-plus           : Term -> Term
-  unquoted            : Term -> Term
-  attrs               : Term -> Term
-  appl                : Term * Term -> Term
-  iter-star-sep       : Term * Term -> Term
-  iter-plus-sep       : Term * Term -> Term
-  prod                : Term * Term * Term -> Term
-  
-
 rules
 
   // TODO: Report actual SDF errors

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-24 15:01:29 UTC (rev 20643)
@@ -212,8 +212,8 @@
         </target>
     
         <target name="stratego.aster.helper" unless="aster-output.uptodate">
-            <apply executable="java">
-                <arg line="-jar utils/aster.jar"/>
+            <apply executable="java" failonerror="true">
+                <arg line="-Xss8m -Xmx768m -client -jar utils/aster.jar"/>
                 <arg value="-i"/>
                 <fileset dir="${basedir}">
                     <include name="**/*.astr"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/lib/editor-common.generated.str	2010-02-24 15:01:29 UTC (rev 20643)
@@ -1,12 +1,16 @@
 module lib/editor-common.generated
 
 imports
-  libstrc
+  libstratego-lib
+  libstratego-sglr
 
 strategies
 
   parse-file =
-    parse-stratego-file
+    parse-file(|<import-term(include/Stratego-Sugar.tbl)>)
+
+  parse-string =
+    parse-string(|<import-term(include/Stratego-Sugar.tbl)>)
   
 strategies
   
@@ -143,8 +147,8 @@
   MARKER     : Term
 
   // Below are copies of the signatures of the terms used in example
-  // trans/{name}.str file. These definitions should also be automatically 
-  // generated in the imported include/{sdf-name}.str module. However,
+  // trans/stratego_sugar.str file. These definitions should also be automatically 
+  // generated in the imported include/Stratego-Sugar.str module. However,
   // to ensure that the example transformation doesn't break when the
   // syntax is changed, we also hard-coded them here.
           

Modified: spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building/DynamicDescriptorBuilder.java
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building/DynamicDescriptorBuilder.java	2010-02-24 10:18:38 UTC (rev 20642)
+++ spoofax-imp/trunk/org.strategoxt.imp.metatooling/src/org/strategoxt/imp/metatooling/building/DynamicDescriptorBuilder.java	2010-02-24 15:01:29 UTC (rev 20643)
@@ -240,6 +240,7 @@
 		IResource includeDir = project.findMember("include");
 		IResource editorDir = project.findMember("editor");
 		IResource buildFile = project.findMember("build.generated.xml");
+		IResource editorCommonFile = project.findMember("lib/build.generated.xml");
 		IResource cacheDir = project.findMember(".cache");
 
 		if (!(includeDir instanceof IContainer && editorDir instanceof IContainer))
@@ -259,6 +260,7 @@
 		}
 		
 		if (cacheDir != null && cacheDir.exists()) cacheDir.setDerived(true);
+		if (editorCommonFile != null && editorCommonFile.exists()) editorCommonFile.setDerived(true);
 	}
 	
 	public IResource getTargetDescriptor(IResource mainDescriptor) {



From L.C.L.Kats at tudelft.nl  Fri Feb 26 15:58:18 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Fri, 26 Feb 2010 14:58:18 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20644 - LennartKats -
	strc-java/trunk/java/runtime/org/strategoxt/lang/compat/sglr
Message-ID: <201002261458.o1QEwIuB006378@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-26 14:58:18 +0000 (Fri, 26 Feb 2010)
New Revision: 20644

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20644&view=rev

Modified:
   strc-java/trunk/java/runtime/org/strategoxt/lang/compat/sglr/STRSGLR_anno_location.java

Log:
Fixed exception in WebDSL/44 that could occur when adding annotations to ambiguous branches.

Changes:

Modified: strc-java/trunk/java/runtime/org/strategoxt/lang/compat/sglr/STRSGLR_anno_location.java
===================================================================
--- strc-java/trunk/java/runtime/org/strategoxt/lang/compat/sglr/STRSGLR_anno_location.java	2010-02-24 15:01:29 UTC (rev 20643)
+++ strc-java/trunk/java/runtime/org/strategoxt/lang/compat/sglr/STRSGLR_anno_location.java	2010-02-26 14:58:18 UTC (rev 20644)
@@ -185,7 +185,7 @@
 					args = args.tail();
 				}
 
-				t = makeTreeAmb(((IStrategoTerm[]) newArgs.toArray()));
+				t = makeTreeAmb(newArgs.toArray(new IStrategoTerm[newArgs.size()]));
 			} else {
 				System.err.println(NAME + ": unhandled tree - " + t);
 			}



From L.C.L.Kats at tudelft.nl  Sun Feb 28 12:11:27 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Sun, 28 Feb 2010 11:11:27 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20645 - LennartKats -
	in spoofax-imp/trunk: org.eclipse.imp
	org.strategoxt.imp.editors.aterm
	org.strategoxt.imp.editors.editorservice
	org.strategoxt.imp.editors.sdf org.strategoxt.imp.editors.stratego
	org.strategoxt.imp.feature org.strategoxt.imp.updatesite
Message-ID: <201002281111.o1SBBRKa018367@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-28 11:11:27 +0000 (Sun, 28 Feb 2010)
New Revision: 20645

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20645&view=rev

Modified:
   spoofax-imp/trunk/org.eclipse.imp/org.eclipse.imp.runtime.patch
   spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
   spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml

Log:
Bugfix release: avoid rebuilding Stratego component in build.generated.xml every time

Changes:

Modified: spoofax-imp/trunk/org.eclipse.imp/org.eclipse.imp.runtime.patch
===================================================================
--- spoofax-imp/trunk/org.eclipse.imp/org.eclipse.imp.runtime.patch	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.eclipse.imp/org.eclipse.imp.runtime.patch	2010-02-28 11:11:27 UTC (rev 20645)
@@ -200,7 +200,7 @@
  import org.eclipse.imp.editor.internal.ProblemMarkerManager;
  import org.eclipse.imp.editor.internal.ToggleBreakpointsAdapter;
  import org.eclipse.imp.help.IMPHelp;
-@@ -257,6 +258,16 @@
+@@ -257,6 +258,20 @@
          setInsertMode(SMART_INSERT);
          fProblemMarkerManager= new ProblemMarkerManager();
      }
@@ -209,6 +209,10 @@
 +        return fServiceControllerManager;
 +    }
 +    
++    public LanguageServiceManager getLanguageServiceManager() { // LK
++        return fLanguageServiceManager;
++    }
++    
 +    public void updateColoring(Region region) { // LK
 +        PresentationController presentation = fServiceControllerManager.getPresentationController();
 +		presentation.damage(region);
@@ -217,7 +221,7 @@
  
      public Object getAdapter(Class required) {
          if (IContentOutlinePage.class.equals(required)) {
-@@ -697,7 +708,8 @@
+@@ -697,7 +712,8 @@
          IFile file= EditorInputUtils.getFile(editorInput);
          IPath filePath= EditorInputUtils.getPath(editorInput);
          try {
@@ -227,7 +231,7 @@
  
              fLanguageServiceManager.getParseController().initialize(filePath, srcProject, fAnnotationCreator);
          } catch (ModelException e) {
-@@ -1491,6 +1503,7 @@
+@@ -1491,6 +1507,7 @@
              ContentAssistant ca= new ContentAssistant();
              ca.setContentAssistProcessor(fServiceControllerManager.getCompletionProcessor(), IDocument.DEFAULT_CONTENT_TYPE);
              ca.setInformationControlCreator(getInformationControlCreator(sourceViewer));
@@ -235,7 +239,7 @@
              return ca;
          }
  
-@@ -1771,7 +1784,8 @@
+@@ -1771,7 +1788,8 @@
                  if (fServiceControllerManager.getPresentationController() != null) {
  //                  System.out.println("Scheduling repair for damage to region " + damage.getOffset() + ":" + damage.getLength() + " in doc of length " + fDocument.getLength());
                      fServiceControllerManager.getPresentationController().damage(damage);
@@ -245,7 +249,7 @@
  //                      System.out.println("** Forcing repair for hyperlink damage to region " + damage.getOffset() + ":" + damage.getLength() + " in doc of length " + fDocument.getLength());
                          fServiceControllerManager.getPresentationController().update(fLanguageServiceManager.getParseController(), fProgressMonitor);
                      }
-@@ -1845,6 +1859,7 @@
+@@ -1845,6 +1863,7 @@
      }
  
      public IParseController getParseController() {
@@ -325,6 +329,19 @@
  
      public static Font sourceFont;
  
+Index: org.eclipse.imp.runtime/src/org/eclipse/imp/preferences/PreferenceInitializer.java
+===================================================================
+--- org.eclipse.imp.runtime/src/org/eclipse/imp/preferences/PreferenceInitializer.java	(revision 22255)
++++ org.eclipse.imp.runtime/src/org/eclipse/imp/preferences/PreferenceInitializer.java	(working copy)
+@@ -42,7 +42,7 @@
+         if (fontData != null && fontData.length > 0)
+             PreferenceConverter.setDefault(store, PreferenceConstants.P_SOURCE_FONT, fontData);
+ 
+-        store.setDefault(PreferenceConstants.P_TAB_WIDTH, 8);
++        store.setDefault(PreferenceConstants.P_TAB_WIDTH, 4); // LK: sane default tab width
+         store.setDefault(PreferenceConstants.P_DUMP_TOKENS, false);
+         store.setDefault(PreferenceConstants.EDITOR_MATCHING_BRACKETS, true);
+ 
 Index: org.eclipse.imp.runtime/META-INF/MANIFEST.MF
 ===================================================================
 --- org.eclipse.imp.runtime/META-INF/MANIFEST.MF	(revision 22255)

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aterm/build.generated.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -226,7 +226,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.editorservice/build.generated.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -226,7 +226,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.sdf/build.generated.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -226,7 +226,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.stratego/build.generated.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -226,7 +226,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +245,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>

Modified: spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.feature/feature.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -2,7 +2,7 @@
 <feature
       id="org.strategoxt.imp"
       label="Spoofax/IMP"
-      version="0.3.3.1"
+      version="0.3.3.2"
       plugin="org.strategoxt.imp.runtime">
 
    <description url="http://strategoxt.org/Stratego/Spoofax-IMP">

Modified: spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-26 14:58:18 UTC (rev 20644)
+++ spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-28 11:11:27 UTC (rev 20645)
@@ -3,7 +3,7 @@
    <description name="Spoofax/IMP" url="http://www.lclnet.nl/update">
       Spoofax/IMP update site
    </description>
-   <feature url="features/org.strategoxt.imp_0.3.3.1.jar" id="org.strategoxt.imp" version="0.3.3.1">
+   <feature url="features/org.strategoxt.imp_0.3.3.2.jar" id="org.strategoxt.imp" version="0.3.3.2">
       <category name="Spoofax/IMP"/>
    </feature>
    <category-def name="Spoofax/IMP" label="Spoofax/IMP">



From L.C.L.Kats at tudelft.nl  Sun Feb 28 13:27:29 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Sun, 28 Feb 2010 12:27:29 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20646 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project
Message-ID: <201002281227.o1SCRTXb019011@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-28 12:27:29 +0000 (Sun, 28 Feb 2010)
New Revision: 20646

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20646&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str

Log:
missing file update

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 11:11:27 UTC (rev 20645)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 12:27:29 UTC (rev 20646)
@@ -301,7 +301,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.atr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -320,7 +320,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>



From L.C.L.Kats at tudelft.nl  Sun Feb 28 13:30:24 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Sun, 28 Feb 2010 12:30:24 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20647 - LennartKats -
	spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project
Message-ID: <201002281230.o1SCUOMu019056@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-28 12:30:24 +0000 (Sun, 28 Feb 2010)
New Revision: 20647

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20647&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str

Log:
typo

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 12:27:29 UTC (rev 20646)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 12:30:24 UTC (rev 20647)
@@ -301,7 +301,7 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.atr"/>
+                    <include name="**/*.astr"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>



From L.C.L.Kats at tudelft.nl  Sun Feb 28 19:15:55 2010
From: L.C.L.Kats at tudelft.nl (Lennart Kats)
Date: Sun, 28 Feb 2010 18:15:55 +0000
Subject: [Stratego-commits] SVN commit: StrategoXT - 20648 - LennartKats -
	in spoofax-imp/trunk: org.strategoxt.imp.editors.aster
	org.strategoxt.imp.generator/src/sdf2imp/project
	org.strategoxt.imp.updatesite
Message-ID: <201002281815.o1SIFtu8022676@proliant.st.ewi.tudelft.nl>

Author: LennartKats
Date: 2010-02-28 18:15:55 +0000 (Sun, 28 Feb 2010)
New Revision: 20648

You can view the changes in this commit at:
   https://svn.strategoxt.org/viewvc/StrategoXT?rev=20648&view=rev

Modified:
   spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
   spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
   spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml

Log:
Released 0.3.3.2: fixed another regression that caused unnecessary Stratego builds, and added a new <delete> command to make sure the include/yourlang.rtree never causes problems on OSX systems.

Changes:

Modified: spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-28 12:30:24 UTC (rev 20647)
+++ spoofax-imp/trunk/org.strategoxt.imp.editors.aster/build.generated.xml	2010-02-28 18:15:55 UTC (rev 20648)
@@ -226,7 +226,8 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
+                    <exclude name="lib/editor-common.generated.str"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -245,7 +246,8 @@
             <dependset>
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
-                    <include name="**/*.rtree"/>
+                    <include name="**/*.astr"/>
+                    <exclude name="lib/editor-common.generated.str"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -261,6 +263,7 @@
         </target>
             
         <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+            <delete file="${include}/${strmodule}.rtree" failonerror="false"/>
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 12:30:24 UTC (rev 20647)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-build-xml.str	2010-02-28 18:15:55 UTC (rev 20648)
@@ -302,6 +302,7 @@
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
                     <include name="**/*.astr"/>
+                    <exclude name="lib/editor-common.generated.str"/>
                 </srcfileset>
                 <targetfileset file="${include}/${strmodule}.ctree"/>
             </dependset>
@@ -321,6 +322,7 @@
                 <srcfileset dir="${basedir}">
                     <include name="**/*.str"/>
                     <include name="**/*.astr"/>
+                    <exclude name="lib/editor-common.generated.str"/>
                 </srcfileset>
                 <targetfileset file="${src-gen}/trans/Main.java"/>
             </dependset>
@@ -336,6 +338,7 @@
         </target>
             
         <target name="stratego.jvm.helper" unless="strc-java.available" if="build.stratego.enabled">
+            <delete file="${include}/${strmodule}.rtree" failonerror="false"/>
             <java classname="org.strategoxt.strj.Main" failonerror="true">
                 <arg value="-i"/>
                 <arg value="${trans}/${strmodule}.str"/>

Modified: spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-28 12:30:24 UTC (rev 20647)
+++ spoofax-imp/trunk/org.strategoxt.imp.generator/src/sdf2imp/project/create-example-trans.str	2010-02-28 18:15:55 UTC (rev 20648)
@@ -194,7 +194,6 @@
     sdf-name := <get-sdf-main-module>;
 
 try(<file-exists <+ mkdir> "lib");
-// TODO: regenerate editor-common.str every time, but only if it changed to avoid unecessary builds
 <output-text-file(|["lib"], "editor-common.generated.str")>
 ${module lib/editor-common.generated
 

Modified: spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml
===================================================================
--- spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-28 12:30:24 UTC (rev 20647)
+++ spoofax-imp/trunk/org.strategoxt.imp.updatesite/site.xml	2010-02-28 18:15:55 UTC (rev 20648)
@@ -3,7 +3,7 @@
    <description name="Spoofax/IMP" url="http://www.lclnet.nl/update">
       Spoofax/IMP update site
    </description>
-   <feature url="features/org.strategoxt.imp_0.3.3.2.jar" id="org.strategoxt.imp" version="0.3.3.2">
+   <feature url="features/org.strategoxt.imp_0.3.3.2.jar" id="org.strategoxt.imp" version="0.3.3.2"> 
       <category name="Spoofax/IMP"/>
    </feature>
    <category-def name="Spoofax/IMP" label="Spoofax/IMP">



